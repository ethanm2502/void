!function(){var t={4940:function(e,a,t){var i={"./apiParamsInitialization.js":9167,"./gameParameters.js":4560,"./httpResponse.js":7682,"./messageHelper.js":5667,"./notificationType.js":6515,"./notificationsName.js":8180,"./resources.js":8513};function r(e){e=s(e);return t(e)}function s(e){if(t.o(i,e))return i[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=4940},9084:function(e,a,t){var i={"./chatBarController.js":5825,"./chatController.js":2586,"./detailsController.js":7097,"./dialogController.js":7850,"./dialogHeaderController.js":5002,"./dialogMessagesController.js":9205,"./dialogsController.js":7542,"./friendsController.js":6664,"./linkCardController.js":1206,"./linkCardMessagesController.js":9596,"./playTogetherController.js":2335,"./userConversationInfoController.js":9976};function r(e){e=s(e);return t(e)}function s(e){if(t.o(i,e))return i[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=9084},9083:function(e,a,t){var i={"./abuseReportDirective.js":8613,"./addFriendsDirective.js":2070,"./backBtnDirective.js":1803,"./chatAvatarHeadshotDirective.js":8395,"./chatBarDirective.js":6626,"./chatBaseDirective.js":9752,"./chatGameIconDirective.js":1974,"./chatPlaceholderDirective.js":4630,"./confirmNegativeActionDirective.js":4167,"./confirmRemoveMemberDirective.js":6818,"./conversationTitleDirective.js":7449,"./conversationTitleEditorDirective.js":7486,"./detailsDirective.js":6715,"./detailsScrollbarDirective.js":6983,"./dialogDirective.js":5585,"./dialogHeaderDirective.js":2359,"./dialogLazyLoadDirective.js":4835,"./dialogMinimizeDirective.js":9300,"./displayMessageDirective.js":7730,"./friendsLazyLoadDirective.js":31,"./groupSelectDirective.js":9458,"./lazyLoadDirective.js":4684,"./linkCardDirective.js":3657,"./minimizeItemDirective.js":3889,"./removeFocusDirective.js":8828,"./repeatDoneDirective.js":3717,"./selectFriendsDirective.js":9775,"./selectFriendsResizeDirective.js":3252,"./systemMessageDirective.js":2287,"./togglePopoverDirective.js":9262,"./userConversationInfoDirective.js":189};function r(e){e=s(e);return t(e)}function s(e){if(t.o(i,e))return i[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=9083},2883:function(e,a,t){var i={"./chatClientStorageUtilityService.js":235,"./chatService.js":7417,"./chatUtilityService.js":4031,"./conversationUtilityService.js":5767,"./cookieService.js":2768,"./dialogAttributesService.js":512,"./gameLayoutService.js":6796,"./gameService.js":2436,"./gameUtility.js":9816,"./libraryInitializationService.js":2731,"./messageService.js":7523,"./messageUtility.js":3355,"./pinGameLayoutService.js":6737,"./pinGameService.js":8034,"./playTogetherLayoutService.js":3254,"./playTogetherService.js":1062,"./presenceLayoutService.js":4411,"./storageService.js":5404,"./systemMessagesService.js":5898,"./usersService.js":7482};function r(e){e=s(e);return t(e)}function s(e){if(t.o(i,e))return i[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=2883},4850:function(e,a,t){var i={"./directives/templates/addFriends.html":4742,"./directives/templates/chatAbuseReport.html":5707,"./directives/templates/chatAvatarHeadshot.html":6492,"./directives/templates/chatBar.html":5307,"./directives/templates/chatBase.html":1254,"./directives/templates/chatDialog.html":5244,"./directives/templates/chatGameIcon.html":5016,"./directives/templates/chatGroupDialog.html":3578,"./directives/templates/chatPlaceholder.html":7999,"./directives/templates/confirmNegativeAction.html":5430,"./directives/templates/conversationTitle.html":6125,"./directives/templates/conversationTitleEditor.html":1108,"./directives/templates/createChatGroup.html":8061,"./directives/templates/details.html":6203,"./directives/templates/dialogHeader.html":185,"./directives/templates/dialogMinimize.html":2553,"./directives/templates/displayMessage.html":4040,"./directives/templates/gamesList.html":3400,"./directives/templates/linkCard.html":4148,"./directives/templates/selectFriends.html":5015,"./directives/templates/systemMessage.html":2674,"./directives/templates/userConversationInfo.html":4174};function r(e){e=s(e);return t(e)}function s(e){if(t.o(i,e))return i[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=4850},726:function(e){function s(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function n(e){return e.split("/").pop().replace(".html","")}var a={importFilesUnderPath:function(e){e.keys().forEach(e)},templateCacheGenerator:function(e,a,i,r){return e.module(a,[]).run(["$templateCache",function(t){i&&i.keys().forEach(function(e){var a=s(n(e));t.put(a,i(e))}),r&&r.keys().forEach(function(e){var a=s(n(e));t.put(a,r(e).replace(/<\/?script[^>]*>/gi,""))})}])}};e.exports=a},5862:function(e,a,t){"use strict";var i=t(792),r=t(5734),s=t.n(r),n=["robloxApp","monospaced.elastic","modal","ui.bootstrap.popover","toast","thumbnails"],o="contacts";try{s().module(o),n.push(o)}catch(e){}r=s().module("chat",n).config(["msdElasticConfig","languageResourceProvider",function(e,a){e.append="\n",i.Lang.ChatResources&&a.setLanguageKeysFromFile(i.Lang.ChatResources)}]);a.Z=r},9167:function(e,a,t){"use strict";t.r(a);var i=t(792),t=t(5862),i={chatApiParams:{pageNumberOfUnreadConversations:1,pageSizeOfUnreadConversations:30,pageNumberOfConversations:1,pageSizeOfConversations:30,pageSizeOfDisplayMessages:1,pageSizeOfUnreadMessages:30,pageSizeOfGetMessages:30,startIndexOfFriendList:0,pageSizeOfFriendList:50,loadMoreUnreadConversations:!1,loadMoreConversations:!1,loadMoreFriends:!1},dialogParams:{loadMoreMessages:!0,sendingMessage:!1,sendMessageHasError:!1,loadMoreFriends:!1,startIndexOfFriendList:0,pageSizeOfFriendList:50,pageSizeOfGetMessages:30,smallestPageSizeOfGetMessages:3},gameUrls:{multiGetPlaceDetails:"/v1/games/multiget-place-details",GetGamesSorts:"/v1/games/sorts?model.gameSortsContext=ChatSorts",GetGamesList:"/v1/games/list",getGamesByUniverseIds:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.gamesApi,"/v1/games"):"/v1/games",multiGetPlayabilityStatus:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.gamesApi,"/v1/games/multiget-playability-status"):"/v1/games/multiget-playability-status"},chatUrls:{setConversationUniverse:"/v2/set-conversation-universe",resetConversationUniverse:"/v2/reset-conversation-universe",getConversations:"/v2/get-conversations"},apiSets:{multiGetAvatarHeadshots:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.thumbnailsApi,"/v1/users/avatar-headshot?size=48x48&format=png"):"/v1/users/avatar-headshot?size=48x48&format=png",retryable:!0,withCredentials:!0},multiGetContacts:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.contactsApi,"/v1/user/get-tags"):"/v1/user/get-tags",retryable:!0,withCredentials:!0},multiGetPresence:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.presenceApi,"/v1/presence/users"):"/v1/presence/users",retryable:!0,withCredentials:!0},getMetaData:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.chatApi,"/v2/metadata"):"/v2/metadata",retryable:!1,withCredentials:!0},getContactsMetadata:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.contactsApi,"/v1/contacts/metadata"):"/v1/contacts/metadata",retryable:!0,withCredentials:!0}}};t.Z.constant("apiParamsInitialization",i),a.default=i},4560:function(e,a,t){"use strict";t.r(a);var i={reasonProhibitedMessage:{None:"None",Playable:"Playable",AnonymousAccessProhibited:"AnonymousAccessProhibited",AssetUnapproved:"AssetUnapproved",IncorrectAssetType:"IncorrectAssetType",IncorrectAssetConfiguration:"IncorrectAssetConfiguration",PlaceHasNoUniverse:"PlaceHasNoUniverse",UniverseDoesNotHaveARootPlace:"This game has no root place.",UniverseRootPlaceIsNotAPlace:"UniverseRootPlaceIsNotAPlace",UniverseRootPlaceIsNotActive:"UniverseRootPlaceIsNotActive",InsufficientPermissionCopylocked:"InsufficientPermissionCopylocked",InsufficientPermissionFriendsOnly:"This game is friends only.",InsufficientPermissionGroupOnly:"Group members only.",InsufficientPermissionOwnerOnly:"InsufficientPermissionOwnerOnly",InsufficientPermissionMembershipLevel:"InsufficientPermissionMembershipLevel",InsufficientPermissionRoleSet:"InsufficientPermissionRoleSet",PermissionDenied:"PermissionDenied",RequiredValueNotSet:"RequiredValueNotSet",AssetUnavailable:"AssetUnavailable",DeviceRestricted:"DeviceRestricted",UnderReview:"This game is under moderation review.",PurchaseRequired:"PurchaseRequired",AccountRestricted:"AccountRestricted",PlaceHasNoPublishedVersion:"This place has no published version."},sortNames:{myRecent:"MyRecent"},maxRowsOfMyRecentGames:1,gameIconMultiGetLimit:30,gameUrl:"/games/{placeId}/robloxgame"};t(5862).Z.constant("gameParameters",i),a.default=i},7682:function(e,a,t){"use strict";t.r(a);var i={sendMessageErrorCode:{textTooLong:"TextTooLong"}};t(5862).Z.constant("httpResponse",i),a.default=i},5667:function(e,a,t){"use strict";t.r(a);var i=t(5862),t={linkCardTypes:{gameCard:"gameCard",catalogItemCard:"catalogItemCard",libraryItemCard:"libraryItemCard"},messageRegexs:{gameCard:new RegExp(/\/games\/(\d+)/)},gameCardRegexs:{privateServerLinkCode:new RegExp(/privateServerLinkCode=(\S+)/)},urlRegex:new RegExp(/(https?:\/\/(?:www\.|(?!www)|(?:web\.))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|web\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www)|(?:web\.))[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9]\.[^\s]{2,})/),onlyNewLineRegex:new RegExp(/^[\r|\n|\s]+$/),removeNewLineRegex:new RegExp(/^\n+|\n+$/g),emojiRegex:new RegExp(/\u200D|\uFE0F|(?:[\xA9\xAE\u2122\u23E9-\u23EF\u23F3\u23F8-\u23FA\u24C2\u25B6\u2600-\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDE51\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F\uDE80-\uDEFF]|\uD83E[\uDD00-\uDDFF])/g),zwjRegex:new RegExp(/\u200D/),emojiRepRegex:new RegExp(/\uFE0F/),senderTypes:{user:"User",system:"System"},messageTypes:{plainText:{name:"PlainText"},link:{name:"Link"},eventBased:{name:"EventBased",setConversationUniverse:"SetConversationUniverse"}}};i.Z.constant("messageHelper",t),a.default=t},6515:function(e,a,t){"use strict";t.r(a);var i={newMessage:"NewMessage",newMessageBySelf:"NewMessageBySelf",newConversation:"NewConversation",addedToConversation:"AddedToConversation",removedFromConversation:"RemovedFromConversation",participantAdded:"ParticipantAdded",participantLeft:"ParticipantLeft",friendshipDestroyed:"FriendshipDestroyed",friendshipCreated:"FriendshipCreated",presenceOffline:"UserOffline",presenceOnline:"UserOnline",conversationTitleModerated:"ConversationTitleModerated",chatEnabled:"ChatEnabled",chatDisabled:"ChatDisabled",conversationTitleChanged:"ConversationTitleChanged",participantTyping:"ParticipantTyping",conversationUniverseChanged:"ConversationUniverseChanged",userTagUpdate:"UserTagUpdate"};t(5862).Z.constant("notificationType",i),a.default=i},8180:function(e,a,t){"use strict";t.r(a);var i={ChatNotifications:"ChatNotifications",FriendshipNotifications:"FriendshipNotifications",PresenceNotifications:"PresenceNotifications",ChatPrivacySettingNotifications:"ChatPrivacySettingNotifications",UserTagNotifications:"UserTagChangeNotification",VoiceNotifications:"VoiceNotifications"};t(5862).Z.constant("notificationsName",i),a.default=i},8513:function(e,a,t){"use strict";t.r(a);var i=t(792),t=t(5862),i={templates:{chatBaseTemplate:"chat-base",chatBarTemplate:"chat-bar",abuseReportTemplate:"chat-abuse-report",dialogTemplate:"chat-dialog",groupDialogTemplate:"chat-group-dialog",dialogMinimizeTemplate:"dialog-minimize",chatPlaceholderTemplate:"chat-placeholder",confirmNegativeActionTemplate:"confirm-negative-action",userConversationInfoTemplate:"user-conversation-info",selectFriendsTemplate:"select-friends",createChatGroupTemplate:"create-chat-group",conversationTitleTemplate:"conversation-title",conversationTitleEditorTemplate:"conversation-title-editor",detailsTemplate:"details",addFriendsTemplate:"add-friends",aliasTemplate:"alias",toastTemplate:"toast",linkCard:"link-card",gamesList:"games-list",dialogHeader:"dialog-header",systemMessage:"system-message",displayMessage:"display-message",chatAvatarHeadshot:"chat-avatar-headshot",chatGameIcon:"chat-game-icon"},eventStreamParams:{actions:{click:"click",hover:"hover",render:"render"},properties:{},clickPlayFromLinkCardInChat:"clickBtnFromLinkCardInChat",clickLinkCardInChat:"clickLinkCardInChat",clickPlayButtonInPlayTogether:"clickPlayButtonInPlayTogether",clickJoinButtonInPlayTogether:"clickJoinButtonInPlayTogether",clickBuyButtonInPlayTogether:"clickBuyButtonInPlayTogether",clickViewDetailsButtonInPlayTogether:"clickViewDetailsButtonInPlayTogether",openGameListInPlayTogether:"openGameListInPlayTogether",pinGameInPlayTogether:"pinGameInPlayTogether",unpinGameInPlayTogether:"unpinGameInPlayTogether",pinGameInLinkCard:"pinGameInLinkCard",unpinGameInLinkCard:"unpinGameInLinkCard",loadGameLinkCardInChat:"loadGameLinkCardInChat",context:{gamePlayFromLinkCard:"PlayGameFromLinkCard",gamePlayFromPlayTogether:"PlayGameFromPlayTogether"}},urlParamNames:{startConversationWithUserId:"startConversationWithUserId",conversationId:"conversationId"},events:{openGameList:"openGameList"},hoverPopoverParams:{isOpen:!1,triggerSelector:"",hoverPopoverSelector:""},performanceMeasurements:{messageSend:"MessageSend",messageReceive:"MessageReceive"},chatDataLSNamePrefix:i.CurrentUser?"Roblox.Chat.".concat(i.CurrentUser.userId):"Roblox.Chat"};t.Z.constant("resources",i),a.default=i},5825:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(s,e,a,i){s.cancelSearch=function(){s.chatViewModel.searchTerm="",s.chatLibrary.chatLayout.searchFocus=!1},s.saveChatBarLayoutInCookie=function(){var e={collapsed:s.chatLibrary.chatLayout.collapsed};a.updateStorage(a.storageDictionary.chatBarLayout,e,s.chatLibrary.cookieOption)},s.toggleChatContainer=function(){s.chatLibrary.chatLayout.collapsed=!s.chatLibrary.chatLayout.collapsed,s.updateUnreadConversationCount(),s.chatLibrary.chatLayout.chatBarInitialized=!0,s.saveChatBarLayoutInCookie()},s.isChatDisconnected=function(){var e=s.chatLibrary.chatLayout,a=e.isChatEnabledByPrivacySetting,t=e.errorMaskEnable,e=e.pageDataLoading;return a===i.chatEnabledByPrivacySettingTypes.enabled&&(t||e)},s.isChatEmpty=function(){var e=s.chatLibrary.chatLayout,a=e.isChatEnabledByPrivacySetting,t=e.chatLandingEnabled,e=i.chatEnabledByPrivacySettingTypes;return t||a!==e.enabled},s.search=function(e){var a=s.chatViewModel.searchTerm;if(!a)return!0;var t=e.name,i=e.contact,e=e.participants,r=a.toLowerCase(),a=!1;return e&&e.length&&(a=e.some(function(e){var a=e.displayName,e=e.name;return a&&-1<a.toLowerCase().indexOf(r)||-1<e.toLowerCase().indexOf(r)})),a||-1!==t.toLowerCase().indexOf(r)||i&&-1!==i.toLowerCase().indexOf(r)}}i.$inject=["$scope","$log","chatClientStorageUtilityService","chatUtility"],t.Z.controller("chatBarController",i),a.default=i},2586:function(e,a,t){"use strict";t.r(a);var N=t(792),i=t(5734),R=t.n(i),t=t(5862);function s(a,e){var t,i=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)),i}function B(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var a,t;a=i,e=r[t=e],t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function r(d,t,i,r,n,g,o,u,p,s,e,l,c,y,a,h,m,v,b,f,L,I,D,T,C,S,P,M){function U(){var e=i.innerWidth()-p.chatLayout.widthOfChat-p.chatLayout.widthOfDialogMinimize,a=p.chatLayout.widthOfDialog+p.chatLayout.spaceOfDialog;d.chatLibrary.chatLayout.availableNumberOfDialogs=Math.floor(e/a),d.chatLibrary.chatLayout.numberOfDialogs=d.chatLibrary.dialogIdList.length,d.chatLibrary.chatLayout.numberOfMinimizedDialogs=d.chatLibrary.minimizedDialogIdList.length,g.debug(" -------------numberOfDialogs = -------------- ".concat(d.chatLibrary.chatLayout.numberOfDialogs)),g.debug(" -------------availableNumberOfDialogs = -------------- ".concat(d.chatLibrary.chatLayout.availableNumberOfDialogs))}function O(e){var a;d.chatLibrary.dialogDict[e.layoutId]&&(a=e.layoutId,d.chatLibrary.dialogDict[a]&&(d.chatLibrary.dialogDict[a].isUpdated=!0,d.chatLibrary.dialogDict[a].updateStatus=p.dialogStatus.REFRESH)),!d.chatLibrary.dialogDict[e.layoutId]&&e.displayMessage&&e.displayMessage.content&&d.launchDialog(e.layoutId,!0)}d.dialogsOverflowWindow=function(){var e=i.innerWidth();return d.chatLibrary.chatLayout.numberOfDialogs>=d.chatLibrary.chatLayout.availableNumberOfDialogs&&e>p.chatLayout.thresholdMobile},d.getMessageForConversations=function(e){0<e.length&&o.multiGetLatestMessages(e,p.chatApiParams.pageSizeOfDisplayMessages).then(function(e){e&&0<e.length&&R().forEach(e,function(e){var a,t=e.chatMessages,i=0<t.length?t[0]:{};d.chatLibrary.conversationsDict[e.conversationId]&&(a=d.chatLibrary.conversationsDict[e.conversationId].layoutId,(e=d.chatUserDict[a]).hasUnreadMessages=e.hasUnreadMessages||c.hasUnreadMessages(e,t),d.chatLibrary.isRespectingMessageTypeEnabled?(u.categorizeMessageType(d.chatLibrary,t,e),e.displayMessage=u.getDisplayMessageForUser(t)):(p.sanitizeMessage(i),e.displayMessage=u.buildDisplayMessage(i)),u.resetConversationUnreadStatus(d.chatUserDict[a],t),u.formatTimestampInConversation(d.chatUserDict[a]))})},function(){g.debug("----- multiGetLatestMessages request is failed ! ------")})},d.updateUnreadConversationCount=function(){o.getUnreadConversationCount().then(function(e){e&&(e=e.count,d.chatViewModel.unreadConversationCount=e,t.document.title=0<e?"(".concat(e,") ").concat(d.chatLibrary.currentTabTitle):d.chatLibrary.currentTabTitle)},function(){g.debug("----- getUnreadConversationCount request is failed ! ------"),t.document.title=d.chatLibrary.currentTabTitle})};function k(e){var a=[];a.push(e),o.getConversations(a).then(function(e){e&&(d.buildChatUserListByUnreadConversations(e),d.getPlaceDetailsForNewPlaceIds(e))})}function E(e,a,t){u.appendMessages(d.chatLibrary,a,e),v.fetchDataForLinkCard(e,d.chatLibrary),c.hasUnreadMessages(a,e),e={status:!1,userId:e[0].senderTargetId},d.updateConverationTypingStatus(a.id,e),d.updateChatViewModel(a,!0),O(a),t||(t=a.layoutId,a=p.activeType.NEWMESSAGE,d.chatLibrary.dialogDict[t]&&(d.chatLibrary.dialogDict[t].markAsActive=!0,d.chatLibrary.dialogDict[t].activeType=a),0<(a=p.getDataForMarkingSeen(d.chatUserDict)).length&&o.markAsSeen(a))}function w(e,a){var t,i,r,s=d.getLayoutId(e,p.dialogType.CHAT);R().isUndefined(d.chatUserDict[s])?k(e):(e=s,s=null,t=a,i=[],r=d.chatUserDict[e],e=null,t||(e=(new Date).getTime()),o.getMessagesByPageSize(r,s,p.dialogParams.smallestPageSizeOfGetMessages,i,function(e){E(i,r,t),e&&(e=(new Date).getTime()-e,o.sendPerformanceData(I.performanceMeasurements.messageReceive,e))},e))}d.resetDialogLayout=function(t){var e,a;t&&(e=B({},p.dialogLayout),a=B({},p.dialogLayoutResetConstant),R().forEach(e,function(e,a){R().isUndefined(t[a])&&(t[a]=B({},e))}),R().forEach(a,function(e,a){t[a]=B({},e)}))},d.retrieveDialogStatus=function(){if(R().isDefined(d.preSetChatLibrary)&&R().isDefined(d.preSetChatLibrary.dialogIdList)){var e=B({},d.preSetChatLibrary.dialogIdList);if(0===e.length)return d.preSetChatLibrary.dialogDict={},d.preSetChatLibrary.dialogsLayout={},s.removeFromStorage(s.storageDictionary.dialogDict,d.chatLibrary.cookieOption),s.removeFromStorage(s.storageDictionary.dialogsLayout,d.chatLibrary.cookieOption),!1;var t=d.preSetChatLibrary.dialogDict,i=d.preSetChatLibrary.dialogsLayout;R().forEach(e,function(e,a){e===p.newGroup.layoutId||d.chatUserDict[e]||(d.preSetChatLibrary.dialogIdList.splice(a,1),delete t[e],delete i[e]),d.resetDialogLayout(i[e])}),d.chatLibrary.dialogIdList=d.preSetChatLibrary.dialogIdList,R().forEach(t,function(e,a){e.isUpdated||(e.isUpdated=!0),a===p.newGroup.layoutId&&(d.chatUserDict[p.newGroup.layoutId]=d.newGroup),d.chatLibrary.dialogDict[a]=e,i[a]&&(d.chatLibrary.dialogsLayout[a]=i[a])})}};function G(){return t.innerWidth>=p.chatLayout.thresholdChatBarOpen&&!d.chatLibrary.isTakeOverOn&&!R().element("#GamesPageLeftColumn").length}var F;d.setup=function(){d.chatUserDict={},d.dialogType=B({},p.dialogType),d.memberStatus=B({},p.memberStatus),d.userPresenceTypes=B({},p.userPresenceTypes),d.newGroup=B({},h.newGroup),d.selectedFriendIds=[],d.chatLibrary=B({},m.chatLibrary),R().isDefined(N.RealTime)&&(F=N.RealTime.Factory.GetClient())},d.initializePresetData=function(){d.preSetChatLibrary={},s.isStorageDefined(s.storageDictionary.dialogIdList)&&s.isStorageDefined(s.storageDictionary.dialogDict)?d.preSetChatLibrary={dialogIdList:s.getFromStorage(s.storageDictionary.dialogIdList),dialogDict:s.getFromStorage(s.storageDictionary.dialogDict),dialogsLayout:s.isStorageDefined(s.storageDictionary.dialogsLayout)?s.getFromStorage(s.storageDictionary.dialogsLayout):{}}:d.preSetChatLibrary={dialogIdList:[],dialogDict:{},dialogsLayout:{}},s.isStorageDefined(s.storageDictionary.chatBarLayout)&&(d.preSetChatLibrary.chatBarLayout=s.getFromStorage(s.storageDictionary.chatBarLayout)),d.chatApiParams=B({},p.chatApiParams)},d.initializeChatBar=function(){d.chatLibrary.chatLayout.chatBarInitialized||(G()&&!d.preSetChatLibrary.chatBarLayout?d.chatLibrary.chatLayout.collapsed=!1:d.preSetChatLibrary.chatBarLayout?d.chatLibrary.chatLayout.collapsed=d.preSetChatLibrary.chatBarLayout.collapsed:G()||(d.chatLibrary.chatLayout.collapsed=!0),d.chatLibrary.chatLayout.chatBarInitialized=!0),l.logSinglePerformanceMark(p.performanceMarkLabels.chatPageDataLoaded)};function A(e,a){var t=d.chatLibrary.layoutIdList.indexOf(e);a&&-1<t?d.chatLibrary.layoutIdList.splice(t,1):!a&&t<0&&d.chatLibrary.layoutIdList.push(e)}function x(e){return d.chatLibrary.userConversationsDict[e]||null}d.removeFriend=function(e){var a,t=(t=x(e))||d.getLayoutId(e,p.dialogType.FRIEND),i=d.chatUserDict[t];i&&i.isConversation?(a=d.chatUserDict[t].id,d.chatLibrary.conversationsDict[a].remove=!0):!i||-1<(i=d.chatLibrary.chatLayoutIds.indexOf(t))&&(d.chatLibrary.chatLayoutIds.splice(i,1),delete d.chatUserDict[t],A(t,!0)),-1<d.chatViewModel.friendsHasConversation.indexOf(e)&&(e=d.chatViewModel.friendsHasConversation.indexOf(e),d.chatViewModel.friendsHasConversation.splice(e,1)),-1<d.chatLibrary.chatLayoutIds.indexOf(t)&&d.closeDialog(t),0===d.chatLibrary.chatLayoutIds.length&&(d.chatLibrary.chatLayout.chatLandingEnabled=!0)};d.getAllFriends=function(){M.getFriendsPresence().then(function(e){d.getFriendsInfo(e)},function(e){console.debug(e)})},d.updateDialogList=function(e,a){for(U();d.chatLibrary.chatLayout.numberOfDialogs+d.chatLibrary.chatLayout.numberOfMinimizedDialogs>=d.chatLibrary.chatLayout.maxOpenDialogs;){var t=d.chatLibrary.dialogIdList[0];d.closeDialog(t),U()}if(d.dialogsOverflowWindow())for(;d.chatLibrary.dialogIdList.length>=d.chatLibrary.chatLayout.availableNumberOfDialogs;){var i=d.chatLibrary.dialogIdList.pop();if(R().isUndefined(i))break;d.chatLibrary.dialogDict[i].isUpdated=!0,d.chatLibrary.dialogDict[i].updateStatus=p.dialogStatus.MINIMIZE;i=d.chatLibrary.minimizedDialogIdList.indexOf(e);-1<i&&(d.chatLibrary.dialogsLayout[e].collapsed&&(d.chatLibrary.dialogsLayout[e].collapsed=!1),d.chatLibrary.minimizedDialogIdList.splice(i,1),delete d.chatLibrary.minimizedDialogData[e])}d.chatLibrary.dialogIdList.indexOf(e)<0&&d.chatLibrary.dialogIdList.push(e);var r=B({},p.dialogInitValue);R().isDefined(a)&&a&&(r.autoOpen=!0),d.chatLibrary.dialogDict[e]=r},d.getUserConversations=function(){o.getUserConversations(d.chatApiParams.pageNumberOfConversations,d.chatApiParams.pageSizeOfConversations,d.chatLibrary.friendsDict).then(function(e){l.logSinglePerformanceMark(p.performanceMarkLabels.chatConversationsLoaded);var a=[],t=d.chatLibrary.friendsDict;return e&&0<e.length&&(a=C.getUserIdsNotInFriendsDict(e,t),d.buildChatUserListByConversations(e,!1),d.chatApiParams.pageNumberOfConversations++,d.retrieveDialogStatus()),!e||e.length<d.chatApiParams.pageSizeOfConversations?(d.chatApiParams.loadMoreConversations=!1,d.chatApiParams.pageNumberOfConversations=1,e&&0===e.length&&(d.chatLibrary.chatLayout.chatLandingEnabled=!0),d.getAllFriends()):(d.chatLibrary.chatLayout.pageDataLoading&&(d.chatLibrary.chatLayout.pageDataLoading=!1),d.chatApiParams.loadMoreConversations=!0),d.chatLibrary.chatLayout.urlParseInitialized||window&&window.location&&(g.debug("--- -initialzeUrlParser- ---"),(e=window.location.search)&&-1<e.indexOf("?")&&(e=e.substr(1)).split("&").forEach(function(e){var a=e.split("="),e=a[0],t=decodeURIComponent(a[1]);switch(e){case p.urlParamNames.startConversationWithUserId:d.startSpecificConversationFromUserId(t);break;case p.urlParamNames.conversationId:d.chatLibrary.chatLayout.urlParseInitialized=!0,d.startSpecificConversationFromConvId(t)}})),S.getUserContacts(a,t),T.getUserInfo(a,t)},function(e){console.debug(e)})},d.updateConversationTitle=function(t,i){var e=[t];o.getConversations(e).then(function(e){e&&R().forEach(e,function(e){var a;e.id===t&&(a=d.chatLibrary.conversationsDict[t]?d.chatLibrary.conversationsDict[t].layoutId:d.getLayoutId(t,p.dialogType.CHAT),a=d.chatUserDict[a],p.updateConversationTitle(a,e.title),d.chatLibrary.userId!==i&&(a.actorUsername=d.chatLibrary.friendsDict[i].name,u.buildSystemMessage(p.notificationType.conversationTitleChanged,a)))})},function(){g.debug(" -------- getConversations request failed ------ ")})},d.resetTypingStatusAsReceiver=function(e,a){g.debug("--------- resetTypingStatusAsReceiver has been called-----------");var t=e.typing,i=e.typing.userTypingDict[a],r=e.typing.userIds.indexOf(a);e.typing.userIds.splice(r),e.typing.isTypingFromSender=!1,i.status=!1,i.lastTimeReceiveTypingEvent=null,n.cancel(i.lastTimeReceiveTimer),delete e.typing.userTypingDict[a],n.cancel(t.lastTimeReceiveTimer)},d.typingStatusForReceiverExpirationInterval=function(e,a,t){e.typing.userIds.indexOf(t)<0&&e.typing.userIds.push(t);var i=a||(new Date).getTime(),a=e.typing.userTypingDict[t];a.lastTimeReceiveTypingEvent||(a.lastTimeReceiveTypingEvent=i),(i-a.lastTimeReceiveTypingEvent>d.chatLibrary.typingInChatForReceiverExpirationMs||!a.status)&&d.resetTypingStatusAsReceiver(e,t)},d.updateConverationTypingStatus=function(e,a){var t=d.chatLibrary.conversationsDict[e]?d.chatLibrary.conversationsDict[e].layoutId:d.getLayoutId(e),i=d.chatUserDict[t],e=a.status,r=a.userId,s=d.chatLibrary.dialogsLayout[t];s&&(s.typing.userTypingDict[r]||(s.typing.userTypingDict[r]={}),s.typing.isTypingFromSender=e,(t=s.typing.userTypingDict[r]).status=e,u.refreshTypingStatus(i,r,e,s),e&&!t.lastTimeReceiveTimer?(g.debug("--------- start a new timer-----------".concat(r)),d.typingStatusForReceiverExpirationInterval(s,null,r),t.lastTimeReceiveTimer=n(function(){return d.typingStatusForReceiverExpirationInterval(s,null,r)},d.chatLibrary.typingInChatForReceiverExpirationMs)):!e&&t.lastTimeReceiveTimer&&(g.debug("--------- cancel timer-----------".concat(r)),d.resetTypingStatusAsReceiver(s,r)))},d.fetchPlaceDetailsIntoPlacesLibrary=function(e,t){e&&0<e.length&&v.multiGetPlaceDetails(e).then(function(e){v.buildPlacesLibrary(d.chatLibrary,e);var a=d.chatLibrary.placesLibrary;R().forEach(t,function(e){v.buildButtonLayoutPerConversation(e,a)})})},d.handleChatNotifications=function(a){g.debug("--------- this is ChatNotifications subscription -----------".concat(a.Type));try{var e,t,i,r,s=a.Type,n=a.ConversationId;switch(s){case p.notificationType.newMessage:w(n);break;case p.notificationType.newMessageBySelf:w(n,!0);break;case p.notificationType.newConversation:case p.notificationType.addedToConversation:case p.notificationType.participantAdded:case p.notificationType.participantLeft:k(n);break;case p.notificationType.removedFromConversation:d.chatLibrary.conversationsDict[n].remove||(r=d.chatLibrary.conversationsDict[n].layoutId,d.chatLibrary.conversationsDict[n].remove=!0,d.closeDialog(r));break;case p.notificationType.conversationTitleChanged:var o=a.ActorTargetId;d.updateConversationTitle(n,o);break;case p.notificationType.participantTyping:var l={status:a.IsTyping,userId:a.UserId};d.updateConverationTypingStatus(n,l);break;case p.notificationType.conversationUniverseChanged:d.chatLibrary.conversationsDict[n]&&(e=a.RootPlaceId,i=a.UniverseId,o=a.ActorTargetId,r=d.chatLibrary.conversationsDict[n].layoutId,t=d.chatUserDict[r],l=d.chatLibrary.placesLibrary&&d.chatLibrary.placesLibrary[e]?d.chatLibrary.placesLibrary[e].placeName:"",r=d.chatLibrary.placesLibrary&&d.chatLibrary.placesLibrary[e]?d.chatLibrary.placesLibrary[e].encodedPlaceName:"",i={rootPlaceId:e,universeId:i,actorUsername:d.chatLibrary.friendsDict[o].name,userId:a.ActorTargetId,placeName:l,encodedPlaceName:r},l=[e],r=[t],d.fetchPlaceDetailsIntoPlacesLibrary(l,r),f.setPinGameData(t,i),e&&o!==d.chatLibrary.userId&&!d.chatLibrary.isRespectingMessageTypeEnabled&&u.buildSystemMessage(p.notificationType.conversationUniverseChanged,t))}}catch(e){var c="ChatNotifications:".concat(a.Type,": ");e&&e.message&&(c+=e.message),y.fireEvent(d.chatLibrary.googleAnalyticsEvent.category,d.chatLibrary.googleAnalyticsEvent.action,c)}},d.handleFriendshipNotifications=function(a){g.debug("--------- this is FriendshipNotifications subscription -----------".concat(a.Type));try{switch(a.Type){case p.notificationType.friendshipDestroyed:var e=a.EventArgs;R().forEach(e,function(e){e!==d.chatLibrary.userId&&d.$digest(d.removeFriend(e))}),M.getFriendsPresence(!0).then(function(e){d.getFriendsInfo(e)},function(e){console.debug(e)}),i.triggerHandler("Roblox.Friends.CountChanged");break;case p.notificationType.friendshipCreated:M.getFriendsPresence(!0).then(function(e){d.getFriendsInfo(e)},function(e){console.debug(e)}),i.triggerHandler("Roblox.Friends.CountChanged")}}catch(e){var t="FriendshipNotifications:".concat(a.Type,": ");e&&e.message&&(t+=e.message),y.fireEvent(d.chatLibrary.googleAnalyticsEvent.category,d.chatLibrary.googleAnalyticsEvent.action,t)}},d.handleUserTagNotifications=function(e){e.Type===p.notificationType.userTagUpdate&&S.getUserContacts(Object.keys(d.chatLibrary.friendsDict),d.chatLibrary.friendsDict,S.options.skipCache)},d.buildPlayTogetherInConversationFromPresence=function(e,i,r){R().forEach(e,function(e){var a=d.chatUserDict[e],t=[i];b.sortPlayTogetherIds(a,r),d.fetchPlaceDetailsIntoPlacesLibrary(t,[a]),d.chatLibrary.dialogDict[e]&&(a.pinGame&&i===a.pinGame.rootPlaceId&&r.userId!==d.chatLibrary.userId&&(a.recentUserIdFromPresence=r.userId,a.recentPlaceIdFromPresence=i,u.buildSystemMessage(p.notificationType.presenceOnline,a)),!(e=d.chatLibrary.dialogsLayout[e]).togglePopoverParams.isOpen&&!a.placeForShown&&a.playTogetherIds&&0<a.playTogetherIds.length&&(e.togglePopoverParams.isOpen=!0)),b.setPlaceForShown(a)})},d.releasePlayerFromActivePlaceLists=function(e,r){R().forEach(e,function(e){var t=d.chatUserDict[e],i=[];R().forEach(t.playTogetherDict,function(e,a){var t;a=parseInt(a),-1<e.playerIds.indexOf(r)&&(t=e.playerIds.indexOf(r),e.playerIds.splice(t,1),0===e.playerIds.length&&i.push(a))}),i&&0<i.length&&R().forEach(i,function(e){var a=t.playTogetherIds.indexOf(e);t.playTogetherIds.splice(a,1),delete t.playTogetherDict[e]}),b.setPlaceForShown(t),t.pinGame&&t.pinGame.rootPlaceId&&(e=t.pinGame.rootPlaceId,v.updateButtonLayoutPerConversation(t,e))})},d.vanishRootPlaceIdFromPlayTogether=function(r,s,e){R().forEach(e,function(e){var t=d.chatUserDict[e],i=[];R().forEach(t.playTogetherDict,function(e,a){a=parseInt(a),s===a&&1===e.playerIds.length&&-1<e.playerIds.indexOf(r)&&i.push(a)}),i&&0<i.length&&R().forEach(i,function(e){var a=t.playTogetherIds.indexOf(e);t.playTogetherIds.splice(a,1),delete t.playTogetherDict[e]})})},d.updatePresenceInFriendDict=function(e){d.chatLibrary.friendsDict[e.userId].userPresenceType=e.userPresenceType,d.chatLibrary.friendsDict[e.userId].presenceData=e,d.chatLibrary.friendsDict[e.userId].presence=e},d.updatePresenceStatus=function(e){for(var a=0;a<e.length;a++){var t=e[a],i=t.userId;d.chatLibrary.friendsDict[i]||(d.chatLibrary.friendsDict[i]={});var r,s=t.userPresenceType,n=d.chatLibrary.friendsDict[i].presence,o=null;s===L.status.inGame?(r=t.rootPlaceId,n&&s===n.userPresenceType&&r===n.rootPlaceId||(o=d.chatLibrary.layoutIdsDictPerUserId[i],n&&n.rootPlaceId&&d.vanishRootPlaceIdFromPlayTogether(i,n.rootPlaceId,o),d.updatePresenceInFriendDict(t),r&&d.buildPlayTogetherInConversationFromPresence(o,r,t))):n&&s===n.userPresenceType||(d.updatePresenceInFriendDict(t),n&&n.userPresenceType===L.status.inGame&&(o=d.chatLibrary.layoutIdsDictPerUserId[i],d.releasePlayerFromActivePlaceLists(o,i)))}},d.listenToPresenceServiceInWeb=function(){document.addEventListener("Roblox.Presence.Update",function(e){null!=e&&e.detail&&r(function(){d.updatePresenceStatus(e.detail)},0)})},d.unsubscribeRealTimeForChat=function(){F.Unsubscribe(p.notificationsName.ChatNotifications,d.handleChatNotifications),F.Unsubscribe(p.notificationsName.FriendshipNotifications,d.handleFriendshipNotifications)},d.handleChatPrivacySetting=function(a){g.debug("--------- this is ChatPrivacySettingNotifications subscription -----------".concat(a.Type));try{switch(a.Type){case p.notificationType.chatEnabled:d.chatLibrary.chatLayout.isChatEnabledByPrivacySetting=d.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled,d.handleSignalRSuccess(!0),d.initializeRealTimeSubscriptionsForChat();break;case p.notificationType.chatDisabled:d.chatLibrary.chatLayout.isChatEnabledByPrivacySetting=d.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.disabled,d.unsubscribeRealTimeForChat()}}catch(e){var t="ChatPrivacySettingNotifications:".concat(a.Type,": ");e&&e.message&&(t+=e.message),y.fireEvent(d.chatLibrary.googleAnalyticsEvent.category,d.chatLibrary.googleAnalyticsEvent.action,t)}},d.initializeRealTimeSubscriptionsForChatPrivacySetting=function(){R().isDefined(F)&&F.Subscribe(p.notificationsName.ChatPrivacySettingNotifications,d.handleChatPrivacySetting)},d.initializeRealTimeSubscriptionsForChat=function(){R().isDefined(F)&&(l.logSinglePerformanceMark(p.performanceMarkLabels.chatSignalRInitializing),F.SubscribeToConnectionEvents(d.handleSignalRSuccess,d.handleSignalRSuccess,d.handleSignalRError,p.notificationsName.ChatNotifications),F.Subscribe(p.notificationsName.ChatNotifications,d.handleChatNotifications),F.Subscribe(p.notificationsName.FriendshipNotifications,d.handleFriendshipNotifications),F.Subscribe(p.notificationsName.UserTagNotifications,d.handleUserTagNotifications),d.listenToPresenceServiceInWeb())},d.handleSignalRSuccess=function(e){if(g.debug(" -------- Signal R is connected ------ "),d.chatLibrary.chatLayout.errorMaskEnable&&d.$apply(function(){d.chatLibrary.chatLayout.errorMaskEnable=!1}),d.chatLibrary.timer&&r.cancel(d.chatLibrary.timer),e||l.logSinglePerformanceMark(p.performanceMarkLabels.chatSignalRSucceeded),d.chatLibrary.chatLayout.pageInitializing)d.chatLibrary.chatLayout.pageInitializing=!1;else try{e&&(d.initializePresetData(),d.initializeChat())}catch(e){var a="handleSignalRSuccess: ";e&&e.message&&(a+=e.message),y.fireEvent(d.chatLibrary.googleAnalyticsEvent.category,d.chatLibrary.googleAnalyticsEvent.action,a)}},d.handleSignalRError=function(){g.debug(" -------- Signal R is disconnected ------ "),d.chatLibrary.timer=r(function(){d.chatLibrary.chatLayout.errorMaskEnable=!0},parseInt(d.chatLibrary.signalRDisconnectionResponseInMilliseconds))},d.onResize=function(){if(d.chatLibrary.chatLayout.numberOfDialogs>d.chatLibrary.chatLayout.availableNumberOfDialogs)for(;d.chatLibrary.dialogIdList.length>d.chatLibrary.chatLayout.availableNumberOfDialogs;){g.debug(" -------------overflow ------ $scope.chatLibrary.dialogIdList.length ------------- ".concat(d.chatLibrary.dialogIdList.length));var e=d.chatLibrary.dialogIdList.pop();if(R().isUndefined(e))break;e&&d.chatLibrary.dialogDict[e]&&(d.chatLibrary.dialogDict[e].isUpdated=!0,d.chatLibrary.dialogDict[e].updateStatus=p.dialogStatus.MINIMIZE)}else if(d.chatLibrary.chatLayout.numberOfDialogs<d.chatLibrary.chatLayout.availableNumberOfDialogs)for(;d.chatLibrary.dialogIdList.length<d.chatLibrary.chatLayout.availableNumberOfDialogs;){g.debug(" -------------fit ------ $scope.chatLibrary.dialogIdList.length ------------- ".concat(d.chatLibrary.dialogIdList.length));var a,e=d.chatLibrary.minimizedDialogIdList.pop();if(R().isUndefined(e))break;e&&d.chatLibrary.minimizedDialogData[e]&&(delete d.chatLibrary.minimizedDialogData[e],d.chatLibrary.dialogIdList.push(e),a=B({},p.dialogInitValue),d.chatLibrary.dialogDict[e]=a)}d.chatLibrary.chatLayout.resizing=!1},d.getLayoutId=function(e,a){switch(a){case p.dialogType.FRIEND:return"friend_".concat(e);case p.dialogType.NEWGROUPCHAT:return p.newGroup.dialogType;case p.dialogType.CHAT:case p.dialogType.GROUPCHAT:case p.dialogType.ADDFRIENDS:default:return"conv_".concat(e)}},d.formatUserDataByType=function(e){e.type===p.participantType.user&&(e.userId=e.targetId,e.id=e.targetId)},d.getUserInfoForConversation=function(r){var s;r.initiator&&d.formatUserDataByType(r.initiator),r.participants&&(r.userIds=[],r.candidatePlayerIds=[],s=[],r.participants.forEach(function(e){d.formatUserDataByType(e);var a,t=e.userId,i=e.name;switch(r.dialogType){case d.dialogType.GROUPCHAT:r.userIds.push(t),t!==d.chatLibrary.userId&&(r.playerIds&&r.playerIds.indexOf(t)<0||!r.playerIds)&&r.candidatePlayerIds.push(t);break;case d.dialogType.CHAT:t!==d.chatLibrary.userId&&(r.userIds.push(t),r.displayUserId=t,r.username=i,(r.playerIds&&r.playerIds.indexOf(t)<0||!r.playerIds)&&r.candidatePlayerIds.push(t));break;default:r.userIds.push(t)}t!==d.chatLibrary.userId&&d.buildPlayTogetherListForEachConveration(e,r),d.chatLibrary.friendsDict[t]||(s.push(t),a=e.name,e=e.displayName,d.chatLibrary.friendsDict[t]={id:t,name:a,displayName:e,nameForDisplay:null!==N.DisplayNames&&void 0!==N.DisplayNames&&N.DisplayNames.Enabled()?e:a}),!r.isGroupChat&&d.chatViewModel.friendsHasConversation.indexOf(t)<0&&d.chatViewModel.friendsHasConversation.push(t),d.chatLibrary.layoutIdsDictPerUserId[t]||(d.chatLibrary.layoutIdsDictPerUserId[t]=[]),d.chatLibrary.layoutIdsDictPerUserId[t].indexOf(r.layoutId)<0&&d.chatLibrary.layoutIdsDictPerUserId[t].push(r.layoutId)}),0<s.length&&T.getUserInfo(s,d.chatLibrary.friendsDict).then(function(e){e&&(s.forEach(function(e){e=d.chatLibrary.friendsDict[e];d.buildPlayTogetherListForEachConveration(e,r),d.getPlaceDetailsForNewPlaceIds([r])}),S.getUserContacts(s,d.chatLibrary.friendsDict,S.options.noCache))}),b.setPlaceForShown(r))},d.buildPlayTogetherListForEachConveration=function(e,a){if(!d.chatLibrary.friendsDict)return!1;e=d.chatLibrary.friendsDict[e.id];e&&e.presence&&e.presence.userPresenceType===L.status.inGame&&b.sortPlayTogetherIds(a,e.presence)},d.updateChatViewModel=function(i,e){switch(i.isGroupChat||i.dialogType!==p.dialogType.CHAT||i.participants.forEach(function(e){var a,t=e.targetId;t!==d.chatLibrary.userId&&(a=d.getLayoutId(t,p.dialogType.FRIEND),-1<(e=d.chatLibrary.chatLayoutIds.indexOf(a))&&(d.chatLibrary.chatLayoutIds.splice(e,1),delete d.chatUserDict[a]),A(a,!0),d.chatLibrary.userConversationsDict[t]=i.layoutId)}),i.dialogType){case d.dialogType.GROUPCHAT:case d.dialogType.CHAT:i.name=i.title,d.chatLibrary.allConversationLayoutIdsDict[i.id]=i.layoutId;break;default:R().isDefined(i.Username)&&(i.name=i.Username)}d.chatUserDict[i.layoutId]=i;var a=d.chatLibrary.chatLayoutIds.indexOf(i.layoutId);-1<a&&d.chatLibrary.chatLayoutIds.splice(a,1),i.isConversation&&(e?(e=d.chatLibrary.chatLayoutIds[0],d.chatUserDict[e],d.chatLibrary.chatLayoutIds.unshift(i.layoutId)):d.chatLibrary.chatLayoutIds.push(i.layoutId)),A(i.layoutId),i.isConversation&&!d.chatLibrary.conversationsDict[i.id]&&(d.chatLibrary.conversationsDict[i.id]=B({},p.conversationInitStatus),d.chatLibrary.conversationsDict[i.id].layoutId=i.layoutId)},d.filterFriends=function(e){var a=[];e=p.sortFriendList(d.chatLibrary,e),d.chatLibrary.friendIds=[],d.chatLibrary.friendLayoutIds=[],e.forEach(function(e){var a;e=e,d.chatLibrary.friendIds.indexOf(e.id)<0&&d.chatLibrary.friendIds.push(e.id),d.chatLibrary.friendsDict[e.id]||(a=B({},e),d.chatLibrary.friendsDict[e.id]=a),d.chatViewModel.friendsHasConversation.indexOf(e.id)<0&&(a=d.getLayoutId(e.id,p.dialogType.FRIEND),e.layoutId=a,e.isConversation=!1,e.dialogType=p.dialogType.FRIEND,d.chatLibrary.friendLayoutIds.indexOf(a)<0&&d.chatLibrary.friendLayoutIds.push(a),d.updateChatViewModel(e,!1),d.chatLibrary.chatLayout.chatLandingEnabled&&(d.chatLibrary.chatLayout.chatLandingEnabled=!1),d.buildPlayTogetherListForEachConveration(e,e),b.setPlaceForShown(e))}),d.getPlaceDetailsForNewPlaceIds(e),d.chatLibrary.chatLayoutIds.forEach(function(e){d.chatUserDict[e].isConversation&&a.push(e)});e=a.concat(d.chatLibrary.friendLayoutIds);d.chatLibrary.chatLayoutIds=e},d.updateConversationInLocalStorage=function(e){var a={pageNumber:1,pageSize:d.chatApiParams.pageSizeOfConversations},t=D.getStorageName(D.chatDataName.getUserConversations,a),a=D.getChatDataFromLocalStorage(t);a&&((a=a.data).unshift(e),D.saveChatDataToLocalStorage(t,a))},d.buildChatUserListByUnreadConversations=function(e,a){e.forEach(function(e){e.isGroupChat=p.conversationType.multiUserConversation===e.conversationType,u.formatTimestampInConversation(e);var a,t=d.getLayoutId(e.id,p.dialogType.CHAT);d.chatUserDict[t]?(a=d.chatUserDict[t],e.hasUnreadMessages&&e.chatMessages&&0<e.chatMessages.length&&(a.hasUnreadMessages=!0,d.chatLibrary.dialogDict[t]&&-1<d.chatLibrary.dialogIdList.indexOf(t)&&(u.processMessages(d.chatLibrary,a,e.chatMessages,d.chatLibrary.friendsDict),v.fetchDataForLinkCard(e.chatMessages,d.chatLibrary)),d.chatLibrary.isRespectingMessageTypeEnabled?a.displayMessage=u.getDisplayMessageForUser(e.chatMessages):(p.sanitizeMessage(e.chatMessages[0]),a.displayMessage=u.buildDisplayMessage(e.chatMessages[0])),d.updateChatViewModel(a,!0)),a.participants=e.participants,d.getUserInfoForConversation(a),O(a)):(d.updateConversationInLocalStorage(e),e.layoutId=t,e.isConversation=!0,e.dialogType=e.isGroupChat?p.dialogType.GROUPCHAT:p.dialogType.CHAT,d.getUserInfoForConversation(e),d.updateChatViewModel(e,!0),O(e))})},d.getPlaceDetailsForNewPlaceIds=function(e){var a,r=[],s=[];e.forEach(function(t){var e,i=d.chatLibrary.placesLibrary;t.pinGame&&(e=t.pinGame.rootPlaceId,!p.isPlaceDetailQualifiedInLibrary(i,e)&&r.indexOf(e)<0&&r.push(e)),t.playTogetherIds&&0<t.playTogetherIds.length&&t.playTogetherIds.forEach(function(e){!p.isPlaceDetailQualifiedInLibrary(i,e)&&r.indexOf(e)<0&&r.push(e);var a=t.id;t.placeButtonLayout&&t.placeButtonLayout[e]||!(s.indexOf(a)<0)||s.push(a)})}),0<r.length?d.fetchPlaceDetailsIntoPlacesLibrary(r,e):0<s.length&&(a=d.chatLibrary.placesLibrary,R().forEach(e,function(e){-1<s.indexOf(e.id)&&v.buildButtonLayoutPerConversation(e,a)}))},d.isConversationExistedInViewModel=function(e){if(e&&e.layoutId){e=e.layoutId;return d.chatUserDict&&d.chatUserDict[e]}return!1},d.buildChatUserListByConversations=function(e,t){var i=[];e.forEach(function(e){var a=d.getLayoutId(e.id,e.dialogType);i.push(e.id),e.layoutId=a,e.isConversation=!0,d.getUserInfoForConversation(e),d.isConversationExistedInViewModel(e)||d.updateChatViewModel(e,t)}),d.getMessageForConversations(i),d.getPlaceDetailsForNewPlaceIds(e)},d.openConversation=function(e,i){var r=d.chatLibrary.dialogRequestedToOpenParams.layoutId,s=d.chatLibrary.dialogRequestedToOpenParams.autoPop;d.chatUserDict[r]&&d.chatUserDict[r].isConversation?d.updateDialogList(r,s):(e=e||d.chatUserDict[r].id,i=void 0===i||"boolean"!=typeof i||i,o.startOneToOneConversation(e).then(function(e){var a=d.chatLibrary.chatLayoutIds.indexOf(r);d.chatLibrary.chatLayoutIds.splice(a,1),delete d.chatUserDict[r],A(r,!0);var t=d.getLayoutId(e.id,p.dialogType.CHAT);e.layoutId=t,e.isConversation=!0,e.dialogType=p.dialogType.CHAT,e.chatMessages=[],e.isGroupChat=e.conversationType===p.conversationType.multiUserConversation,d.getUserInfoForConversation(e),v.buildButtonLayoutPerConversation(e,d.chatLibrary.placesLibrary),d.updateChatViewModel(e,i),d.updateDialogList(t,s),e.pinGame&&(a=e.pinGame.rootPlaceId,d.fetchPlaceDetailsIntoPlacesLibrary([a],[e])),p.updateFocusedDialog(d.chatLibrary,t),u.formatTimestampInConversation(e)},function(){g.debug(" ---- startOneToOneConversation ---- failed!")}))},d.destroyDialogLayout=function(e){e="#".concat(e);R().element(e).empty()},d.deleteLayoutIdFromDialogList=function(e){for(var a=d.chatLibrary.dialogIdList,t=[],i=0;i<a.length;i++)a[i]===e&&t.push(i);if(0<t.length){for(var r=t.length-1;0<=r;r--)d.chatLibrary.dialogIdList.splice(t[r],1);delete d.chatLibrary.dialogDict[e]}},d.expandGameListInConversation=function(e){e=d.chatUserDict[e];d.chatLibrary.playTogetherLibrary&&d.chatLibrary.playTogetherLibrary[e.id]&&(d.chatLibrary.playTogetherLibrary[e.id].layout.activeGamesList.isCollapsed=!0)},d.launchDialog=function(e,a){d.chatLibrary.dialogRequestedToOpenParams.layoutId=e,d.chatLibrary.dialogRequestedToOpenParams.autoPop=a,d.chatLibrary.dialogIdList.indexOf(e)<0&&e===p.newGroup.layoutId?(d.updateDialogList(e,a),d.chatUserDict[p.newGroup.layoutId]=d.newGroup):d.chatLibrary.dialogIdList.indexOf(e)<0&&d.chatUserDict[e]?(d.openConversation(),d.expandGameListInConversation(e),a||p.updateFocusedDialog(d.chatLibrary,e)):-1<d.chatLibrary.dialogIdList.indexOf(e)&&d.chatLibrary.dialogsLayout[e]&&((a=d.chatLibrary.dialogsLayout[e]).focusMeEnabled=!0,p.updateFocusedDialog(d.chatLibrary,e),a.collapsed&&(a.collapsed=!1,p.updateDialogsPosition(d.chatLibrary)))},d.closeDialog=function(e){var a=d.chatUserDict[e];a&&(t=p.getScrollBarSelector(a),t=R().element(t));var t;R().element("#chat-main");d.chatLibrary.chatLayout.focusedLayoutId===e&&p.updateFocusedDialog(d.chatLibrary,null),d.deleteLayoutIdFromDialogList(e),a&&a.dialogType===p.dialogType.NEWGROUPCHAT&&(a.selectedUserIds=[],a.selectedUsersDict={},a.numberOfSelected=0),t&&0<t.length&&t.mCustomScrollbar("destroy"),d.$broadcast("Roblox.Chat.MarkDialogInactive",{layoutId:e}),a&&(t=a.id,d.chatLibrary.conversationsDict[t]&&d.chatLibrary.conversationsDict[t].remove?(-1<(t=d.chatLibrary.chatLayoutIds.indexOf(e))&&a&&(d.chatLibrary.chatLayoutIds.splice(t,1),delete d.chatUserDict[e],R().equals(d.chatUserDict,{})&&(d.chatLibrary.chatLayout.chatLandingEnabled=!0)),A(e,!0)):u.processMessages(d.chatLibrary,a,null)),d.destroyDialogLayout(e),0<d.chatLibrary.minimizedDialogIdList.length&&(a=d.chatLibrary.minimizedDialogIdList.shift(),delete d.chatLibrary.minimizedDialogData[a],d.chatLibrary.dialogIdList.push(a),d.chatLibrary.dialogDict[a].isUpdated=!0,d.chatLibrary.dialogDict[a].updateStatus=p.dialogStatus.REPLACE),s.updateStorage(s.storageDictionary.dialogIdList,d.chatLibrary.dialogIdList,d.chatLibrary.cookieOption),s.updateStorage(s.storageDictionary.dialogDict,d.chatLibrary.dialogDict,d.chatLibrary.cookieOption),d.chatLibrary.dialogsLayout&&d.chatLibrary.dialogsLayout[e]&&(d.chatLibrary.dialogsLayout[e].collapsed=!1),delete d.chatLibrary.dialogsLayout[e],s.updateStorage(s.storageDictionary.dialogsLayout,d.chatLibrary.dialogsLayout,d.chatLibrary.cookieOption)},d.validLayoutId=function(e,a){if(d.chatUserDict[e])return!0;switch(a){case p.dialogType.FRIEND:d.chatApiParams.loadMoreFriends?d.getAllFriends():d.chatLibrary.chatLayout.urlParseInitialized=!0;break;case p.dialogType.CHAT:default:d.chatApiParams.loadMoreConversations?d.getUserConversations():d.chatLibrary.chatLayout.urlParseInitialized=!0}return!1},d.startSpecificConversationFromUserId=function(e){var a=x(e),t=p.dialogType.CHAT;a||(a=d.getLayoutId(e,p.dialogType.FRIEND),t=p.dialogType.FRIEND),d.validLayoutId(a,t)?(d.chatLibrary.chatLayout.urlParseInitialized=!0,d.launchDialog(a,!0)):(d.chatLibrary.dialogRequestedToOpenParams.layoutId=a,d.chatLibrary.dialogRequestedToOpenParams.autoPop=!0,d.openConversation(e,!1))},d.startSpecificConversationFromConvId=function(e){var a=d.getLayoutId(e,p.dialogType.CHAT);g.debug("--attempting to open specific conversation on load: ".concat(e,"--")),d.validLayoutId(a,p.dialogType.CHAT)&&(d.chatLibrary.chatLayout.urlParseInitialized=!0,d.launchDialog(a))},d.openSettingsPage=function(){window.location.href=a.getAbsoluteUrl(p.linksLibrary.settingLink)},d.getAvatars=function(e){e&&0<e.length&&T.getAvatarHeadshots(e,d.chatLibrary.friendsDict)},d.getFriendsInfo=function(e){var r;d.chatLibrary.chatLayout.pageDataLoading&&(d.chatLibrary.chatLayout.pageDataLoading=!1),null!=e&&e.length&&(r=[],R().forEach(e,function(e){var a=e,t=a.id;r.push(t),a.id=parseInt(t,10),a.userId=parseInt(t,10);var i=a.name,e=a.displayName;a.nameForDisplay=null!==N.DisplayNames&&void 0!==N.DisplayNames&&N.DisplayNames.Enabled()?e:i,d.chatLibrary.friendsDict[t]||(d.chatLibrary.friendsDict[t]=a)}),d.filterFriends(e),d.getAvatars(r))},d.initializeChat=function(){d.chatUserDict&&d.chatLibrary||d.setup(),l.logSinglePerformanceMark(p.performanceMarkLabels.chatConversationsLoading),d.updateUnreadConversationCount(),d.getUserConversations()},d.initializeEvents=function(){R().element(t).bind("resize",function(){var e;!d.chatLibrary.chatLayout.resizing&&(0<d.chatLibrary.dialogIdList.length||0<d.chatLibrary.minimizedDialogIdList.length)&&(d.chatLibrary.chatLayout.resizing=!0,U(),d.dialogsOverflowWindow()||(e=i.innerWidth(),d.chatLibrary.chatLayout.numberOfDialogs<d.chatLibrary.chatLayout.availableNumberOfDialogs&&e>p.chatLayout.thresholdMobile)?(g.debug(" ------- need to resize -------------- "),d.onResize()):d.chatLibrary.chatLayout.resizing=!1)}),d.$on("Roblox.Chat.destroyChatCookie",function(){s.removeFromStorage(s.storageDictionary.dialogIdList,d.chatLibrary.cookieOption),s.removeFromStorage(s.storageDictionary.dialogDict,d.chatLibrary.cookieOption),s.removeFromStorage(s.storageDictionary.dialogsLayout,d.chatLibrary.cookieOption),s.removeFromStorage(s.storageDictionary.chatBarLayout,d.chatLibrary.cookieOption),s.removeFromStorage(s.storageDictionary.chatFriendsListReloadTime),e.removeLocalStorage(d.chatLibrary.dialogLocalStorageName),D.clearLocalStorage()}),d.$on("Roblox.Chat.LoadUnreadConversationCount",function(){d.updateUnreadConversationCount()}),i.bind("Roblox.Chat.StartChat",function(e,a){d.startSpecificConversationFromUserId(a.userId)})},d.initializeServices=function(e){o.setParams(),u.setParams(e),v.setParams(N.EnvironmentUrls.chatApi,N.EnvironmentUrls.gamesApi),D.setStorageParams(e)},d.initializeLayoutLibrary=function(){var e=P.thumbnailTypes,a=P.avatarHeadshotSize;d.chatLibrary.layoutLibrary={thumbnailTypes:e,avatarHeadshotSize:a}},d.initializeChatLibrary=function(e){var a=N.EnvironmentUrls.domain;d.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes=p.chatEnabledByPrivacySettingTypes,d.chatLibrary.chatLayout.isChatEnabledByPrivacySetting=e.isChatEnabledByPrivacySetting,d.chatLibrary.chatLayout.languageForPrivacySettingUnavailable=e.languageForPrivacySettingUnavailable,d.chatLibrary.chatLayout.playTogetherGameCardsEnabled=e.isPlayTogetherForGameCardsEnabled,d.chatLibrary.cookieOption={domain:a,path:"/",expires:null},d.chatLibrary.currentTabTitle=t.document.title,d.chatLibrary.dialogLocalStorageName=m.dialogLocalStorageNamePrefix+a,d.chatLibrary.domain=a,d.chatLibrary.isUserUnder13=N.CurrentUser.isUnder13,d.chatLibrary.maxConversationTitleLengthInput=e.maxConversationTitleLength,d.chatLibrary.partyChromeDisplayTimeStampInterval=e.partyChromeDisplayTimeStampInterval,d.chatLibrary.quotaOfGroupChatMembers=e.numberOfMembersForPartyChrome-1,d.chatLibrary.screenHeight=window.screen?window.screen.height:0,d.chatLibrary.signalRDisconnectionResponseInMilliseconds=e.signalRDisconnectionResponseInMilliseconds,d.chatLibrary.typingInChatAsSenderThrottleMs=e.typingInChatFromSenderThrottleMs,d.chatLibrary.typingInChatForReceiverExpirationMs=e.typingInChatForReceiverExpirationMs,d.chatLibrary.userId=parseInt(N.CurrentUser.userId),d.chatLibrary.username=N.CurrentUser.name;a=y.eventActions.Chat;a+=": ".concat(y.getUserAgent()),d.chatLibrary.googleAnalyticsEvent={category:y.eventCategories.JSErrors,action:a},d.chatLibrary.senderTypesForUnknownMessageTypeError=e.senderTypesForUnknownMessageTypeError,d.chatLibrary.eventStreamParams=B({},p.eventStreamParams),d.chatLibrary.relativeValueToRecordUiPerformance=e.relativeValueToRecordUiPerformance,d.chatLibrary.isUsingCacheToLoadFriendsInfoEnabled=e.isUsingCacheToLoadFriendsInfoEnabled,d.chatLibrary.cachedDataFromLocalStorageExpirationMS=e.cachedDataFromLocalStorageExpirationMS,d.chatLibrary.isInvalidMessageTypeFallbackEnabled=e.isInvalidMessageTypeFallbackEnabled,d.chatLibrary.isRespectingMessageTypeEnabled=e.isRespectingMessageTypeEnabled,d.chatLibrary.validMessageTypesWhiteList=e.validMessageTypesWhiteList,d.chatLibrary.shouldRespectConversationHasUnreadMessageToMarkAsRead=e.shouldRespectConversationHasUnreadMessageToMarkAsRead,d.initializeLayoutLibrary()},d.initializeChatViewModel=function(){d.chatViewModel=B({},m.chatViewModel),d.chatViewModel.chatDomain=N.EnvironmentUrls.chatApi},d.bootstrapAllInitialization=function(e){d.initializeChatViewModel(),d.initializeChatLibrary(e),d.initializeServices(e),d.initializeRealTimeSubscriptionsForChatPrivacySetting(),d.initializePresetData(),d.initializeChatBar(),d.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes&&d.chatLibrary.chatLayout.isChatEnabledByPrivacySetting===d.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled&&(d.chatLibrary.chatLayout.pageDataLoading=!0,d.initializeChat(),d.initializeRealTimeSubscriptionsForChat()),d.chatLibrary.chatLayout.pageInitializing&&(d.chatLibrary.chatLayout.pageInitializing=!1)},d.initialize=function(){d.setup(),d.initializeEvents(),d.chatLibrary.chatLayout.pageInitializing=!0,o.getMetaData().then(function(e){d.bootstrapAllInitialization(e)}).catch(function(e){g.debug(e)}),S.getContactsMetaData().then(function(){}).catch(function(e){g.debug(e)})},d.initialize()}r.$inject=["$scope","$window","$document","$timeout","$interval","$log","chatService","messageService","chatUtility","chatClientStorageUtilityService","localStorageService","performanceService","messageUtility","googleAnalyticsEventsService","urlService","dialogAttributes","libraryInitialization","gameService","playTogetherService","pinGameService","presenceLayout","resources","storageService","usersService","conversationsUtility","contactsService","thumbnailConstants","usersPresenceService"],t.Z.controller("chatController",r),a.default=r},7097:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e,a){var t=e.dialogData.initiator,i=e.chatLibrary.userId;e.canConversationRemoveMember=function(){return e.dialogData.dialogType!==e.dialogType.CHAT&&(t&&t.id===i)}}i.$inject=["$scope","$log"],t.Z.controller("detailsController",i),a.default=i},7850:function(e,a,t){"use strict";t.r(a);var y=t(792),i=t(5734),h=t.n(i),t=t(5862);function s(a,e){var t,i=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)),i}function m(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var a,t;a=i,e=r[t=e],t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function r(o,l,i,c,t,r,s,d,a,n,g,u){o.removeFromConversation=function(e,a){i.removeFromConversation(o.chatLibrary.userId,e),o.chatLibrary.chatLayoutIds&&-1<o.chatLibrary.chatLayoutIds.indexOf(a)&&(o.chatLibrary.conversationsDict[e].remove=!0,o.closeDialog({layoutId:a}))},o.sendPerformanceData=function(e){Math.random()<o.chatLibrary.relativeValueToRecordUiPerformance&&(e=e.startSendingTime,e=(new Date).getTime()-e,i.sendPerformanceData(a.performanceMeasurements.messageSend,e))};function p(n){i.sendMessage(o.dialogData.id,n.rawContent).then(function(e){var a;!e||(a=e.data)&&(n.sendingMessage=!1,n.canResend=!1,o.sendPerformanceData(n),a.resultType!==c.resultType.SUCCESS?(n.sendMessageHasError=!0,n.error=c.errorMessages.default,a.resultType===c.resultType.MODERATED?(n.error=c.errorMessages.messageContentModerated,n.content=c.hashOutContent(n.content),c.sanitizeMessage(n),n.hasLinkCard&&n.linkCardMessages.forEach(function(e){e.isCard||(e.content=c.hashOutContent(e.content))})):n.canResend=!0):(e=a.content,n.sendMessageHasError=!1,h().isUndefined(o.dialogData.messagesDict)&&(o.dialogData.messagesDict={}),n.id=a.messageId,n.sent=a.sent,n.messageType=a.messageType,t.buildTimeStamp(n,o.dialogData),t.buildDisplayMessage(n),n.resetClusterMessage=!0,c.sanitizeMessage(a),n.content=a.content,n.pieces=a.pieces,n.filteredForReceivers=a.filteredForReceivers,n.messageType=a.messageType,n.senderType=g.senderTypes.user,t.setClusterMaster(o.dialogData,n),n.hasLinkCard&&n.rawContent!==e&&(a.hasLinkCard?(d.fetchDataForLinkCard([a],o.chatLibrary),n.linkCardMessages=a.linkCardMessages):n.hasLinkCard=!1),o.dialogData.messagesDict[a.messageId]=n))},function(e){l.debug(" ------ sendMessage error -------"),n.sendingMessage=!1,n.sendMessageHasError=!0,n.canResend=!0;var a,t,i,r=e.status,s=e.data;s&&(n.sendingMessage=!1,n.sendMessageHasError=!0,n.canResend=!0,t=c.sendMessageErrorCode.textTooLong,e=(i=c.errorMessages).textTooLong,i=i.sendingMessagesTooQuickly,null!=s&&null!==(a=s.errors)&&void 0!==a&&a.length&&(s.errors[0].message===t?n.error=e:r==u.tooManyAttempts&&(n.error=i)))})}o.toggleDetails=function(){o.dialogLayout.details.isEnabled=!o.dialogLayout.details.isEnabled,o.saveIntoDialogsLayout()},o.toggleConversationEditor=function(){o.dialogLayout.details.isConversationTitleEditorEnabled=!o.dialogLayout.details.isConversationTitleEditorEnabled,o.dialogLayout.focusMeEnabled=o.dialogLayout.details.isConversationTitleEditorEnabled,o.saveIntoDialogsLayout()},o.toggleAddFriends=function(){o.dialogLayout.details.isAddFriendsEnabled=!o.dialogLayout.details.isAddFriendsEnabled,o.dialogLayout.details.isAddFriendsEnabled?o.addFriends():o.dialogData.addMoreFriends=!1,o.getLimitLinkNameForMemberList(),o.saveIntoDialogsLayout()},o.getLimitLinkNameForMemberList=function(e){var a=o.dialogData.userIds.length;o.dialogData.selectedUserIds&&(a+=o.dialogData.selectedUserIds.length),e&&(a-=e),o.dialogLayout.memberDisplay.linkName=o.dialogLayout.memberDisplay.isAll?o.dialogLayout.memberDisplay.seeLessLink:"".concat(o.dialogLayout.memberDisplay.seeMoreLink," (").concat(a-o.dialogLayout.memberDisplay.defaultLimit,")")},o.toggleMemberList=function(){o.dialogLayout.memberDisplay.isAll=!o.dialogLayout.memberDisplay.isAll,o.dialogLayout.memberDisplay.limitNumber=o.dialogLayout.memberDisplay.isAll?o.dialogData.userIds.length:o.dialogLayout.memberDisplay.defaultLimit,o.getLimitLinkNameForMemberList()},o.toggleFriendsMenu=function(e,a){a&&o.dialogLayout.details.friendIdForMenuOn===e?(o.dialogLayout.details.friendMenuAction={},o.dialogLayout.details.friendIdForMenuOn=null):e&&!a&&(o.dialogLayout.details.friendMenuAction[e]=!o.dialogLayout.details.friendMenuAction[e],o.dialogLayout.details.friendIdForMenuOn=e)},o.updatePopoverParams=function(){var e=o.dialogData,a=e.id,t=e.playTogetherIds,i=o.dialogLayout.togglePopoverParams,r=i.dialogSelectorPrefix,s=i.popoverTriggerSelectorPrefix,e=i.dialogTriggerClassPrefix,i=o.dialogLayout.togglePopoverParams,t={dialogSelect:r+a,triggerSelector:s+a,dialogTriggerClassSelector:e+a,isOpen:!!t&&0<t.length,isFirstTimeOpen:!0};Object.assign(i,t)},o.dialogParams=m({},c.dialogParams),o.userPresenceTypes=c.userPresenceTypes,o.dialogData.messageForSend="",o.dialogLayout.scrollbarElm=c.getScrollBarSelector(o.dialogData,c.scrollBarType.MESSAGE),o.dialogLayout.listenToScrollInitialized=!1,o.friendsScrollbarElm=c.getScrollBarSelector(o.dialogData,c.scrollBarType.FRIENDSELECTION),o.updatePopoverParams(),o.updateDialog=function(){return l.debug("---- updateDialog callback ---- Scrollbars updated"),o.dialogLayout.IsdialogContainerVisible||(h().element(o.dialogLayout.scrollbarElm).find(".mCustomScrollBox").addClass("dialog-visible"),o.dialogLayout.IsdialogContainerVisible=!0),!1},o.buildNewMessage=function(e){return{read:!0,content:e,rawContent:e,senderTargetId:o.chatLibrary.userId,sendingMessage:!0,sendMessageHasError:!1,startSendingTime:(new Date).getTime(),messageType:"PlainText",senderType:"User"}},o.sendMessage=function(){var e;0<o.dialogData.messageForSend.length&&(e=o.buildNewMessage(o.dialogData.messageForSend),c.sanitizeMessage(e),d.fetchDataForLinkCard([e],o.chatLibrary),o.dialogData.messageForSend="",h().isUndefined(o.dialogData.chatMessages)&&(o.dialogData.chatMessages=[]),t.setClusterMaster(o.dialogData,e),o.dialogData.displayMessage=e,p(e))},o.resendMessage=function(e){p(e)},o.keyPressEnter=function(){o.sendMessage(),o.dialogLayout.typing.isTypingAsSender&&(o.dialogLayout.typing.lastTimeTypingAsSender=null,o.dialogLayout.typing.isTypingAsSender=!1)},o.typing=function(e,a,t){a&&(e.which!==s.enter&&(e=t||(new Date).getTime(),(!(t=o.dialogLayout.typing).lastTimeTypingAsSender||e-t.lastTimeTypingAsSender>o.chatLibrary.typingInChatAsSenderThrottleMs)&&(t.lastTimeTypingAsSender=e,t.isTypingAsSender=!0,i.updateUserTypingStatus(o.dialogData.id,!0))),o.toggleDialogFocusStatus(!0))},o.abuseReport=function(e,a){o.dialogLayout.isConfirmationOn=!0,e&&(o.dialogLayout.userIdForAbuseReport=e),a&&o.dialogLayout.userIdForAbuseReport&&(a=n("formatString")(c.chatLayout.abuseReportUrl,{userId:o.dialogLayout.userIdForAbuseReport,location:escape(window.location),conversationId:o.dialogData.id}),a=y.Endpoints?y.Endpoints.getAbsoluteUrl(a):a,y.AbuseReportDispatcher?y.AbuseReportDispatcher.triggerUrlAction(a):window.location.href=a,o.dialogLayout.userIdForAbuseReport=null,o.dialogLayout.isConfirmationOn=!1),o.saveIntoDialogsLayout()},o.leaveGroupChat=function(e){e?(o.chatLibrary.conversationsDict[o.dialogData.id].remove=!0,o.removeFromConversation(o.dialogData.id,o.dialogData.layoutId),o.resetConfirmDialog()):(o.dialogLayout.confirmDialog.isOpen=!0,e=r.negativeAction.leaveChatGroup,o.dialogLayout.confirmDialog.title=e.title,o.dialogLayout.confirmDialog.headerTitle=e.headerTitle,o.dialogLayout.confirmDialog.btnName=e.btnName,o.dialogLayout.confirmDialog.cancelBtnName=e.cancelBtnName,o.dialogLayout.confirmDialog.type=e.type)},o.addFriends=function(){o.dialogData.addMoreFriends=!0,0<o.chatLibrary.friendIds.length&&o.updateFriends(),o.dialogData.scrollBarType=c.scrollBarType.FRIENDSELECTION},o.viewParticipants=function(){o.dialogLayout.lookUpMembers=!o.dialogLayout.lookUpMembers},o.toggleGroupNameEditor=function(){o.dialogLayout.renameEditor.isEnabled=!o.dialogLayout.renameEditor.isEnabled,o.dialogLayout.renameEditor.hasFocus=!o.dialogLayout.renameEditor.hasFocus,o.updateDialogStyle(),o.dialogLayout.focusMeEnabled=!o.dialogLayout.renameEditor.isEnabled},o.renameTitle=function(){var a=o.dialogData.title;i.renameGroupConversation(o.dialogData.id,o.dialogData.name).then(function(e){if(e){switch(e.resultType){case c.resultType.MODERATED:t.buildSystemMessage(c.notificationType.conversationTitleModerated,o.dialogData,!0),c.updateConversationTitle(o.dialogData,a);break;case c.resultType.SUCCESS:c.updateConversationTitle(o.dialogData,e.conversationTitle)}o.toggleConversationEditor()}})},o.removeMember=function(e,a){a?(o.resetConfirmDialog(),o.getLimitLinkNameForMemberList(1),i.removeFromConversation(e,o.dialogData.id).then(function(){o.isOverLoaded()})):(o.dialogLayout.confirmDialog.isOpen=!0,a=r.negativeAction.removeUser,o.dialogLayout.confirmDialog.title=a.title,o.dialogLayout.confirmDialog.headerTitle=a.headerTitle,o.dialogLayout.confirmDialog.btnName=a.btnName,o.dialogLayout.confirmDialog.cancelBtnName=a.cancelBtnName,o.dialogLayout.confirmDialog.type=a.type,o.dialogLayout.confirmDialog.params={userId:e})},o.resetConfirmDialog=function(){Object.assign(o.dialogLayout.confirmDialog,{isOpen:!1,title:"",btnName:"",type:"",params:{}})},o.confirmCallBack=function(){var e=o.dialogLayout.confirmDialog;switch(e.type){case r.negativeAction.removeUser.type:o.removeMember(e.params.userId,!0);break;case r.negativeAction.leaveChatGroup.type:o.leaveGroupChat(!0)}},o.updateDialogHeader=function(e){o.dialogLayout.collapsed&&(o.dialogLayout.hoverOnCollapsed=e)},o.isDialogMainContainerHidden=function(){return o.dialogData.addMoreFriends||o.dialogLayout.details.isEnabled},i.getMessages(o.dialogData.id,null,o.dialogParams.pageSizeOfGetMessages).then(function(e){e&&0<e.length?(o.dialogData.chatMessages=[],o.dialogData.messagesDict={},t.processMessages(o.chatLibrary,o.dialogData,e,o.chatLibrary.friendsDict),d.fetchDataForLinkCard(e,o.chatLibrary),o.dialogData.scrollBarType=c.scrollBarType.MESSAGE):(o.dialogData.scrollBarType=c.scrollBarType.MESSAGE,o.updateDialog())}),o.$on("elastic:resize",function(e,a,t,i){l.debug("---- oldHeight -----".concat(t,"---- newHeight -----").concat(i)),t!==i&&(e.preventDefault(),e.stopPropagation(),c.setResizeInputLayout(o.chatLibrary,i,o.dialogData,o.dialogLayout))}),o.init=function(){o.getLimitLinkNameForMemberList()},o.init()}r.$inject=["$scope","$log","chatService","chatUtility","messageService","dialogAttributes","keyCode","gameService","resources","$filter","messageHelper","httpStatusCodes"],t.Z.controller("dialogController",r),a.default=r},5002:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(t,e,i,r){t.isGameIconAvailable=function(){return t.isPinOrActiveGameAvailable()||t.isMyRecentGameAvailable()},t.isPinOrActiveGameAvailable=function(){return t.dialogData.placeForShown&&t.dialogData.placeForShown.universeId&&t.dialogData.placeForShown.rootPlaceId},t.isMyRecentGameAvailable=function(){return t.chatLibrary.myRecentPlaceId},t.openGameList=function(){var e=i.eventStreamParams.openGameListInPlayTogether,a={conversationId:t.dialogData.id};r.sendEventWithTarget(e,i.eventStreamParams.actions.click,a)},t.init=function(){t.gamesListTemplateUrl=i.templates.gamesList},t.init()}i.$inject=["$scope","$log","resources","eventStreamService"],t.Z.controller("dialogHeaderController",i),a.default=i},9205:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(a,e,t){a.isSenderTypeAllowed=function(e){return-1<a.chatLibrary.senderTypesForUnknownMessageTypeError.indexOf(e.senderType)},a.canRenderMessage=function(e){return!!e.sendingMessage||(!a.chatLibrary.isRespectingMessageTypeEnabled||(e.isSystemMessage||t.isMessageTypeInWhiteList(a.chatLibrary,e)&&t.isMessageTypeLegal(e)&&t.isSenderTypeLegal(e)))},a.shouldShowInvalidMessageTypePrompt=function(e){return a.chatLibrary.isInvalidMessageTypeFallbackEnabled&&a.isSenderTypeAllowed(e)}}i.$inject=["$scope","$log","messageUtility"],t.Z.controller("dialogMessagesController",i),a.default=i},7542:function(e,a,t){"use strict";t.r(a);var i=t(5734),l=t.n(i),t=t(5862);function s(a,e){var t,i=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)),i}function c(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var a,t;a=i,e=r[t=e],t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function r(s,r,n,o,i){s.isNewGroupChat=function(e){return e.dialogType===n.dialogType.NEWGROUPCHAT||e.addMoreFriends&&!e.isGroupChat},s.canAddFriendInExistedConversation=function(e){return e.addMoreFriends&&e.isGroupChat},s.resetPreviousDialog=function(e,a,t){s.chatUserDict[e].selectedUserIds=[],s.chatUserDict[e].selectedUsersDict={},t.preserved?s.chatUserDict[e].addMoreFriends=!1:delete s.chatUserDict[e];var i=s.chatLibrary.dialogIdList.indexOf(e);-1<i&&!t.preserved?(s.destroyDialogLayout(e),delete s.chatLibrary.dialogDict[e],t.isDuplicatedConversation?s.chatLibrary.dialogIdList.splice(i):(s.chatLibrary.dialogIdList[i]=a,s.chatLibrary.dialogDict[a]=c({},n.dialogInitValue))):s.updateDialogList(a,!0)},s.generateDialog=function(e,a,t){var i=t.layoutId,r=s.getLayoutId(e.id,a);e.dialogType=a,i!==r?(s.getUserInfoForConversation(e),e.layoutId=r,e.isConversation=!0,s.updateChatViewModel(e,!0),s.resetPreviousDialog(i,r,t)):(s.getUserInfoForConversation(e),s.updateChatViewModel(e,!0),s.chatLibrary.dialogDict[i].isUpdated=!0,s.chatLibrary.dialogDict[i].updateStatus=n.dialogStatus.REFRESH)},s.createNewGroupChat=function(e,t){var i,a;s.newGroupChatLocked||(s.newGroupChatLocked=!0,i={layoutId:e},a=t.name,t.addMoreFriends&&!t.isGroupChat&&(e=t.participants,l().forEach(e,function(e){e=e.targetId;e!==s.chatLibrary.userId&&(t.selectedUserIds&&t.selectedUserIds.indexOf(e)<0&&t.selectedUserIds.push(e),t.selectedUsersDict[e]=l().copy(s.chatLibrary.friendsDict[e]),t.selectedUsersDict[e].hiddenFromSelection=!0)}),i.preserved=!0,a=""),r.startGroupConversation(t.selectedUserIds,a).then(function(e){var a;e.resultType===n.resultType.SUCCESS&&(a=e.conversation,(e=s.chatLibrary.allConversationLayoutIdsDict[a.id])?(i.isDuplicatedConversation=!0,s.resetPreviousDialog(t.layoutId,e,i),s.chatLibrary.dialogIdList.indexOf(e)<0&&s.launchDialog(e,!0)):(a.isGroupChat=a.conversationType===n.conversationType.multiUserConversation,o.formatTimestampInConversation(a),s.generateDialog(a,n.dialogType.GROUPCHAT,i))),s.newGroupChatLocked=!1}).catch(function(e){s.newGroupChatLocked=!1}))},s.sendInvite=function(e){i.debug("------------- sendInvite ------------");var a,t=s.chatUserDict[e];t.dialogType!==n.dialogType.CHAT&&t.dialogType!==n.dialogType.GROUPCHAT||t.addMoreFriends?s.canAddFriendInExistedConversation(t)?r.addToConversation(t.selectedUserIds,t.id).then(function(e){e&&e.resultType===n.resultType.SUCCESS&&e.conversationId&&(t.addMoreFriends=!1,t.selectedUserIds.forEach(function(e){t.userIds.indexOf(e)<0&&t.userIds.push(e)}))}).finally(function(){t.selectedUserIds=[],t.selectedUsersDict={}}):s.isNewGroupChat(t)&&s.createNewGroupChat(e,t):(-1<(e=(a=t.userIds).indexOf(s.chatLibrary.userId))&&a.splice(e,1),t.selectedUserIds=a)}}r.$inject=["$scope","chatService","chatUtility","messageService","$log"],t.Z.controller("dialogsController",r),a.default=r},6664:function(e,a,t){"use strict";t.r(a);var n=t(792),i=t(5734),o=t.n(i),t=t(5862);function s(a,e){var t,i=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)),i}function r(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var a,t;a=i,e=r[t=e],t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function l(s,e,a,t,i){s.dialogLayout.scrollToBottom=!1,s.dialogLayout.IsdialogContainerVisible=!1,s.dialogParams=r({},e.dialogParams),s.dialogType=r({},e.dialogType),s.userPresenceTypes=r({},e.userPresenceTypes),s.friendsScrollbarElm=e.getScrollBarSelector(s.dialogData,e.scrollBarType.FRIENDSELECTION),s.dialogData.scrollBarType=e.scrollBarType.FRIENDSELECTION,s.dialogData.isCreated=!0,s.updateFriendsDictData=function(e){var r;null!=e&&e.length&&(r=[],o().forEach(e,function(e){var a=e,t=a.id;a.id=parseInt(t,10);var i=a.name,e=a.displayName;a.nameForDisplay=null!==n.DisplayNames&&void 0!==n.DisplayNames&&n.DisplayNames.Enabled()?e:i,s.chatLibrary.friendsDict[t]||(s.chatLibrary.friendsDict[t]=a,r.push(t))}),s.updateFriends(e),r&&0<r.length&&a.getAvatarHeadshots(r,s.chatLibrary.friendsDict))};0<s.chatLibrary.friendIds.length&&s.updateFriends(),t.getFriendsPresence().then(function(e){null!=e&&e.length&&s.updateFriendsDictData(e)},function(e){console.debug(e)}),s.isOverLoaded()}l.$inject=["$scope","chatUtility","usersService","usersPresenceService","$timeout"],t.Z.controller("friendsController",l),a.default=l},1206:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(i,r,t,s,n,o,l,c,d){i.isLinkCardAvailableAndParsedByClientSide=function(e){return!e.isLinkCard&&e.isCard},i.sendEventStream=function(e,a){a={placeId:a,conversationId:i.dialogData.id};t.sendEventWithTarget(e,i.chatLibrary.eventStreamParams.actions.click,a)},i.sendLoadLinkCardEvent=function(e){e={placeId:e,conversationId:i.dialogData.id};t.sendEventWithTarget(i.chatLibrary.eventStreamParams.loadGameLinkCardInChat,i.chatLibrary.eventStreamParams.actions.render,e)},i.sendGamePlayEnvent=function(e){var a=i.chatLibrary.eventStreamParams.context;t.sendGamePlayEvent(a.gamePlayFromLinkCard,e)},i.playGame=function(e,a,t){i.sendEventStream(a,e),i.sendGamePlayEnvent(e),t&&t.privateServerLinkCode?s.playPrivateServerGame(e,t.privateServerLinkCode):i.chatLibrary.chatLayout.playTogetherGameCardsEnabled?s.playTogetherGame(e,i.dialogData.id):s.playRegularGame(e)},i.buyAccess=function(e,a){var t=i.chatLibrary.placesLibrary[e],e=t.gameIconUrl,t=l("formatString")(a.buyAccess.bodyText(),{placeName:t.placeName,creatorName:t.creatorName,price:t.price}),a={titleText:a.buyAccess.title,bodyText:t,imageUrl:e,actionButtonShow:!0,actionButtonText:a.buyAccess.yesButtonText,actionButtonClass:a.buyAccess.yesButtonClass,neutralButtonText:a.buyAccess.noButtonText,closeButtonShow:!0};i.dialogLayout.playTogetherButton.isPlayButtonDisabled=!0,n.open(a).result.then(function(){r.debug("--- purchase ---"),i.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1},function(){r.debug("--- cancel ---"),i.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1})},i.goToPlaceDetails=function(e,a){i.sendEventStream(a,e),o.location.href=i.chatLibrary.placesLibrary[e].placeUrl},i.play=function(e,a,t){switch(i.chatLibrary.placesLibrary[e].buttonLayoutForLinkCard.type){case d.playButtonTypes.play:i.playGame(e,a,t);break;case d.playButtonTypes.buy:i.buyAccess(e,d);break;case d.playButtonTypes.details:i.goToPlaceDetails(e,a)}},i.pinGame=function(e,a){e=parseInt(e),a=parseInt(a);var t;i.dialogData.pinGame&&i.dialogData.pinGame.rootPlaceId===parseInt(a)||(t=i.chatLibrary.eventStreamParams.pinGameInLinkCard,c.sendPinGameEvent(t,a,i.dialogData),a={rootPlaceId:a,universeId:e,actorUsername:i.chatLibrary.username,userId:i.chatLibrary.userId,placeName:i.chatLibrary.placesLibrary&&i.chatLibrary.placesLibrary[a]?i.chatLibrary.placesLibrary[a].placeName:"",encodedPlaceName:i.chatLibrary.placesLibrary&&i.chatLibrary.placesLibrary[a]?i.chatLibrary.placesLibrary[a].encodedPlaceName:""},c.setPinGameData(i.dialogData,a),c.pinGame(i.dialogData,e),s.buildButtonLayoutPerConversation(i.dialogData,i.chatLibrary.placesLibrary))}}i.$inject=["$scope","$log","eventStreamService","gameService","modalService","$window","$filter","pinGameService","gameLayout"],t.Z.controller("linkCardController",i),a.default=i},9596:function(e,a,t){"use strict";t.r(a);var i=t(5734),r=t.n(i),t=t(5862);function s(e,a){e.pinGameLayout=r().copy(a),e.linkCardMessages=e.message.linkCardMessages}s.$inject=["$scope","pinGameLayout"],t.Z.controller("linkCardMessagesController",s),a.default=s},2335:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(o,i,t,r,s,l,n,c,d,g,u,p,y){o.sendEventStream=function(e,a,t){a={placeId:a,conversationId:o.playTogether.id};t&&(a.gameInstanceId=t),n.sendEventWithTarget(e,o.chatLibrary.eventStreamParams.actions.click,a)},o.sendGamePlayEnvent=function(e){var a=o.chatLibrary.eventStreamParams.context;n.sendGamePlayEvent(a.gamePlayFromPlayTogether,e)},o.buyAccess=function(e,a){var t=o.chatLibrary.eventStreamParams.clickBuyButtonInPlayTogether;o.sendEventStream(t,e),o.dialogLayout.playTogetherButton.isPlayButtonDisabled=!0;t=o.chatLibrary.placesLibrary[e],e=t.gameIconUrl,t=a.buyAccess.bodyText(t.encodedPlaceName,t.encodedCreatorName,t.price),a={titleText:a.buyAccess.title,bodyText:t,imageUrl:e,actionButtonShow:!0,actionButtonText:a.buyAccess.yesButtonText,actionButtonClass:a.buyAccess.yesButtonClass,neutralButtonText:a.buyAccess.noButtonText,closeButtonShow:!0};r.open(a).result.then(function(){i.debug("--- purchase ---"),o.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1},function(){i.debug("--- cancel ---"),o.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1})},o.goToPlaceDetails=function(e){var a=o.chatLibrary.eventStreamParams.clickViewDetailsButtonInPlayTogether;o.sendEventStream(a,e),t.location.href=o.chatLibrary.placesLibrary[e].placeUrl},o.joinGame=function(e){o.chatLibrary.eventStreamParams.clickJoinButtonInPlayTogether;var a=o.playTogether.playTogetherDict[e].placeId,t=o.playTogether.playTogetherDict[e].gameInstanceId,i=o.playTogether.playTogetherDict[e].playerIds?o.playTogether.playTogetherDict[e].playerIds[0]:null,i=y.buildPlayGameProperties(e,a,t,i),e={placeId:e,conversationId:o.playTogether.id};t&&(e.gameInstanceId=t);e={eventName:o.chatLibrary.eventStreamParams.clickJoinButtonInPlayTogether,ctx:o.chatLibrary.eventStreamParams.actions.click,properties:e,gamePlayIntentEventCtx:o.chatLibrary.eventStreamParams.context.gamePlayFromPlayTogether};y.launchGame(i,e)},o.playGame=function(e,a){var t=o.chatLibrary.eventStreamParams.clickPlayButtonInPlayTogether;o.sendEventStream(t,e),o.sendGamePlayEnvent(e),s.playTogetherGame(e,a)},o.joinGameFromPlayTogether=function(e){e=parseInt(e);var a=o.playTogether.placeButtonLayout[e].type,t=o.playTogether.id;switch(a){case u.playButtonTypes.join:o.joinGame(e);break;case u.playButtonTypes.play:o.playGame(e,t);break;case u.playButtonTypes.buy:o.buyAccess(e,u);break;case u.playButtonTypes.details:o.goToPlaceDetails(e)}},o.toggleActiveGameList=function(){o.playTogetherLayout.activeGamesList.isCollapsed=!o.playTogetherLayout.activeGamesList.isCollapsed,o.playTogetherLayout.activeGamesList.isCollapsed?(o.playTogetherLayout.activeGamesList.toggleMenuText=o.playTogetherLayout.activeGamesList.showMoreText,o.playTogetherLayout.activeGamesList.limitNumber=o.playTogetherLayout.activeGamesList.minNumberForFit):(o.playTogetherLayout.activeGamesList.toggleMenuText=o.playTogetherLayout.activeGamesList.showLess,o.playTogetherLayout.activeGamesList.limitNumber=o.playTogetherLayout.numberOfActiveGames)},o.hasPinGameAndActiveGames=function(){return!(!o.hasActiveGames()||!o.playTogether.pinGame)&&(1!==o.playTogether.playTogetherIds.length||o.playTogether.playTogetherIds[0]!==o.playTogether.pinGame.rootPlaceId)},o.hasActiveGames=function(){var e=!1;return o.playTogether.playTogetherIds?(o.playTogether.pinGame&&(e=-1<o.playTogether.playTogetherIds.indexOf(o.playTogether.pinGame.rootPlaceId),o.playTogetherLayout.activeGamesList.pinGameIsInActiveGames=e),e?o.playTogether.playTogetherIds.length-1:o.playTogether.playTogetherIds.length):0},o.hasNoPinGameAndNoActiveGame=function(){return!(o.playTogether.pinGame&&o.playTogether.pinGame.rootPlaceId||o.hasActiveGames())},o.isMyRecentAvaliable=function(){return o.hasNoPinGameAndNoActiveGame()&&o.chatLibrary.myRecentPlaceId},o.unPinGame=function(){var e,a;o.playTogether&&o.playTogether.pinGame&&(e=o.chatLibrary.eventStreamParams.unpinGameInPlayTogether,a=o.playTogether.pinGame.rootPlaceId,c.sendPinGameEvent(e,a,o.playTogether),c.setPinGameData(o.playTogether),c.unpinGame(o.playTogether),s.updateButtonLayoutPerConversation(o.playTogether,a),g.updateScrollbar(l.gameListScrollListSelector))},o.pinGame=function(e,a){e=parseInt(e),a=parseInt(a);var t=o.chatLibrary.eventStreamParams.pinGameInPlayTogether;c.sendPinGameEvent(t,a,o.playTogether);t={rootPlaceId:a,universeId:e,actorUsername:o.chatLibrary.name,userId:o.chatLibrary.userId,placeName:o.chatLibrary.placesLibrary&&o.chatLibrary.placesLibrary[a]?o.chatLibrary.placesLibrary[a].placeName:"",encodedPlaceName:o.chatLibrary.placesLibrary&&o.chatLibrary.placesLibrary[a]?o.chatLibrary.placesLibrary[a].encodedPlaceName:""};c.setPinGameData(o.playTogether,t),c.pinGame(o.playTogether,e),s.updateButtonLayoutPerConversation(o.playTogether,a)},o.initData=function(){var e,a,t,i,r,s,n;o.playTogetherLayout=Object.assign({},l),o.gameParameters=Object.assign({},d),o.gameLayout=Object.assign({},u),o.pinGameLayout=Object.assign({},p),o.dialogData?(o.playTogether=o.dialogData,o.playTogether.inDialog=!0,o.playTogetherLayout.numberOfActiveGames=o.hasActiveGames(),e=o.playTogetherLayout.numberOfActiveGames,a=(i=o.playTogetherLayout.activeGamesList).isCollapsed,t=i.pinGameIsInActiveGames,r=i.limitNumber,n=i.minNumberForFit,s=i.maxNumberForFit,i=i.showLess,t&&(r={limitNumber:r+1,minNumberForFit:n+1,maxNumberForFit:s+1},s=o.playTogetherLayout.activeGamesList,Object.assign(s,r)),n=0<(n=e-n)?n:0,n=o.playTogetherLayout.activeGamesList.showMore(n),o.playTogetherLayout.activeGamesList.showMoreText=n,1<o.playTogetherLayout.numberOfActiveGames&&(o.playTogetherLayout.activeGamesList.toggleMenuText=a?n:i)):(o.playTogether=o.chatUser,o.playTogether.inDialog=!1,o.playTogetherLayout.numberOfActiveGames=o.hasActiveGames(),o.playTogetherLayout.activeGamesList.limitNumber=o.playTogetherLayout.numberOfActiveGames),o.chatLibrary.playTogetherLibrary[o.playTogether.id]={layout:o.playTogetherLayout}},o.initData()}i.$inject=["$scope","$log","$window","modalService","gameService","playTogetherLayout","eventStreamService","pinGameService","gameParameters","chatUtility","gameLayout","pinGameLayout","playGameService"],t.Z.controller("playTogetherController",i),a.default=i},9976:function(e,a,t){"use strict";t.r(a);t=t(5862);function s(a,e){var t,i=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)),i}function n(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var a,t;a=i,e=r[t=e],t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function i(t,e,i,r){t.hasGameAlbum=function(){var e=0,a=null;return t.chatUser.pinGame&&(e++,a=t.chatUser.pinGame.rootPlaceId),t.chatUser.playTogetherIds&&(a&&-1<t.chatUser.playTogetherIds.indexOf(a)?e=e+t.chatUser.playTogetherIds.length-1:e+=t.chatUser.playTogetherIds.length),1<e},t.isGameAvailableInChat=function(){return t.chatUser.placeForShown&&t.chatUser.placeForShown.universeId&&t.chatUser.placeForShown.rootPlaceId},t.openGameList=function(){var e,a;t.hoverPopoverParams&&!t.hoverPopoverParams.isOpen&&(e=i.eventStreamParams.openGameListInPlayTogether,a={conversationId:t.chatUser.id},r.sendEventWithTarget(e,i.eventStreamParams.actions.hover,a))},t.setupHoverPopover=function(){t.hoverPopoverParams=n({},i.hoverPopoverParams),t.hoverPopoverParams.triggerSelector=".chat-friend-".concat(t.chatUser.id),t.hoverPopoverParams.hoverPopoverSelector=".game-list-".concat(t.chatUser.id)},t.init=function(){t.gamesListTemplateUrl=i.templates.gamesList,t.setupHoverPopover()},t.init()}i.$inject=["$scope","$log","resources","eventStreamService"],t.Z.controller("userConversationInfoController",i),a.default=i},8613:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",templateUrl:e.templates.abuseReportTemplate}}i.$inject=["resources"],t.Z.directive("abuseReport",i),a.default=i},2070:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",replace:!0,templateUrl:e.templates.addFriendsTemplate}}i.$inject=["resources"],t.Z.directive("addFriends",i),a.default=i},1803:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,link:function(a,e){e.bind("click touchstart",function(e){e.preventDefault(),a.closeDialog(a.dialogData.layoutId)})}}}i.$inject=["$log"],t.Z.directive("backBtn",i),a.default=i},8395:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:{userId:"@",className:"@",layoutLibrary:"="},templateUrl:e.templates.chatAvatarHeadshot}}i.$inject=["resources"],t.Z.directive("chatAvatarHeadshot",i),a.default=i},6626:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,replace:!0,templateUrl:e.templates.chatBarTemplate}}i.$inject=["resources"],t.Z.directive("chatBar",i),a.default=i},9752:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,replace:!0,templateUrl:e.templates.chatBaseTemplate}}i.$inject=["resources"],t.Z.directive("chatBase",i),a.default=i},1974:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:{universeId:"@",className:"@",layoutLibrary:"="},templateUrl:e.templates.chatGameIcon}}i.$inject=["resources"],t.Z.directive("chatGameIcon",i),a.default=i},4630:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,templateUrl:e.templates.chatPlaceholderTemplate}}i.$inject=["resources"],t.Z.directive("chatPlaceholder",i),a.default=i},4167:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:{chatLibrary:"=",dialogLayout:"=",confirmCallback:"&"},templateUrl:e.templates.confirmNegativeActionTemplate}}i.$inject=["resources"],t.Z.directive("confirmNegativeAction",i),a.default=i},6818:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:{dialogLayout:"=",confirmCallback:"&"},templateUrl:e.templates.confirmNegativeActionTemplate}}i.$inject=["resources"],t.Z.directive("confirmRemoveMember",i),a.default=i},7449:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",replace:!0,templateUrl:e.templates.conversationTitleTemplate}}i.$inject=["resources"],t.Z.directive("conversationTitle",i),a.default=i},7486:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",replace:!0,templateUrl:e.templates.conversationTitleEditorTemplate}}i.$inject=["resources"],t.Z.directive("conversationTitleEditor",i),a.default=i},6715:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.detailsTemplate}}i.$inject=["resources"],t.Z.directive("details",i),a.default=i},6983:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,link:function(e,a){a.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},advanced:{autoScrollOnFocus:!1}})}}}i.$inject=["$log"],t.Z.directive("detailsScrollbar",i),a.default=i},5585:function(e,a,t){"use strict";t.r(a);var i=t(5734),L=t.n(i),t=t(5862);function s(a,e){var t,i=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)),i}function I(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var a,t;a=i,e=r[t=e],t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function r(y,s,n,o,h,m,t,v,l,c,b,f){return{restrict:"A",scope:{dialogData:"=",chatLibrary:"=",chatUser:"=",closeDialog:"&",sendInvite:"&"},link:function(d,g){function u(){d.isOverLoaded(),d.dialogData.currentUserId=d.currentUserId;var a,e=l.templates.dialogTemplate,t=l.templates.groupDialogTemplate,i=l.templates.createChatGroupTemplate;switch(d.dialogData.dialogType){case h.dialogType.CHAT:L().forEach(d.dialogData.userIds,function(e){e!==d.chatLibrary.userId&&(a=e)}),d.dialogLayout.title=d.dialogData.title,d.dialogLayout.templateUrl=e,d.dialogLayout.scrollbarElm=h.getScrollBarSelector(d.dialogData,h.scrollBarType.MESSAGE),d.dialogData.name=d.chatLibrary.friendsDict[a]?d.chatLibrary.friendsDict[a].nameForDisplay:d.dialogData.title,d.dialogData.nameLink=d.chatLibrary.friendsDict[a]?d.chatLibrary.friendsDict[a].profileUrl:"";break;case h.dialogType.GROUPCHAT:d.dialogLayout.templateUrl=t,d.dialogLayout.limitMemberDisplay=r,d.dialogLayout.scrollbarElm=h.getScrollBarSelector(d.dialogData,h.scrollBarType.MESSAGE),d.dialogData.name=d.dialogData.title;break;case h.dialogType.NEWGROUPCHAT:d.dialogLayout.title=d.dialogData.title,d.dialogLayout.templateUrl=i}d.updateDialogStyle()}function p(){(d.dialogLayout.IsdialogContainerVisible||g.find(".dialog-container"))&&(d.dialogLayout.IsdialogContainerVisible=!1,g.empty());var e=L().element(n.get(d.dialogLayout.templateUrl));d.chatLibrary&&d.chatLibrary.dialogScopeLib[d.dialogData.id]&&(t=d.chatLibrary.dialogScopeLib[d.dialogData.id]),d.$$childHead&&null!=d.$$childHead&&d.$$childHead.timeStamp===t&&d.$$childHead.$destroy();var a=d.$new(),t=Date.now();d.chatLibrary&&(d.chatLibrary.dialogScopeLib[d.dialogData.id]=t),a.timeStamp=t,t=s(e),g.append(e),t(a)}var r=h.dialogLayout.limitMemberDisplay,e=0;d.saveIntoDialogsLayout=function(){var e=d.dialogData.layoutId;d.dialogLayout&&d.dialogLayout.layoutId===e&&(d.chatLibrary.dialogsLayout[e]=d.dialogLayout,m.updateStorage(m.storageDictionary.dialogsLayout,d.chatLibrary.dialogsLayout,d.chatLibrary.cookieOption))};function i(e){var a=L().isDefined(d.dialogData.userIds)?d.dialogData.userIds.indexOf(e):-1,e=L().isDefined(d.dialogData.selectedUserIds)?d.dialogData.selectedUserIds.indexOf(e):-1;return a<0&&e<0}function a(){d.dialogLibrary=t.getLocalStorage(d.chatLibrary.dialogLocalStorageName)?t.getLocalStorage(d.chatLibrary.dialogLocalStorageName):{}}d.updateDialogStyle=function(){h.updateDialogStyle(d.dialogData,d.dialogLayout,d.chatLibrary)},d.updateFriends=function(e){var a,t=[];e?(a=h.sortFriendList(d.chatLibrary,e))&&(a.forEach(function(e){i(e.id)&&t.push(e.id),d.chatLibrary.friendsDict[e.id]||(d.chatLibrary.friendsDict[e.id]=e)}),d.dialogData.friendIds=t):(a=d.chatLibrary.friendIds.slice(),L().forEach(a,function(e){i(e)&&t.push(e)}),d.dialogData.friendIds=t)},d.isOverLoaded=function(){L().isUndefined(d.dialogData.selectedUserIds)&&(d.dialogData.selectedUserIds=[],d.dialogData.selectedUsersDict={}),d.dialogData.dialogType!==h.dialogType.FRIEND&&(d.dialogData.dialogType===h.dialogType.NEWGROUPCHAT?d.dialogData.numberOfSelected=d.dialogData.selectedUserIds.length:d.dialogData.dialogType===h.dialogType.CHAT?d.dialogData.numberOfSelected=d.dialogData.userIds.length+d.dialogData.selectedUserIds.length:d.dialogData.numberOfSelected=d.dialogData.userIds.length+d.dialogData.selectedUserIds.length-1,d.dialogLayout.isMembersOverloaded=d.dialogData.numberOfSelected>=d.chatLibrary.quotaOfGroupChatMembers)},d.dialogData.selectedUserIds=[],d.dialogData.selectedUsersDict={},d.selectFriends=function(e){var a=d.dialogData.selectedUserIds.indexOf(e);a<0&&!d.dialogLayout.isMembersOverloaded?(d.dialogData.selectedUserIds.push(e),d.dialogData.selectedUsersDict[e]=L().copy(d.chatLibrary.friendsDict[e])):-1<a&&(d.dialogData.selectedUserIds.splice(a,1),delete d.dialogData.selectedUsersDict[e]),d.dialogData.searchTerm="",d.isOverLoaded()},d.isNumberOfMemberOverloaded=function(){var e=d.dialogData.selectedUserIds?d.dialogData.selectedUserIds.length:0,a=0;return d.dialogData.userIds&&(a=d.dialogData.dialogType===h.dialogType.CHAT?d.dialogData.userIds.length:d.dialogData.userIds.length-1),e+a>=d.chatLibrary.quotaOfGroupChatMembers&&(d.dialogLayout.isMembersOverloaded=!0,!d.dialogLayout.details.isEnabled&&d.dialogData.dialogType!==h.dialogType.NEWGROUPCHAT||(d.toastLayout.isNeeded=!0,d.toastLayout.text||(d.toastLayout.text=d.dialogLayout.memberDisplay.toastText(d.chatLibrary.quotaOfGroupChatMembers))),!0)},d.toggleFriendSelection=function(e,a){a&&a.preventDefault();a=d.dialogData.selectedUserIds.indexOf(e);a<0&&!d.isNumberOfMemberOverloaded()?(d.dialogData.selectedUserIds.push(e),d.dialogData.selectedUsersDict[e]=L().copy(d.chatLibrary.friendsDict[e]),d.dialogData.selectedUsersDict[e].isSelected=!0):-1<a&&(d.dialogData.selectedUserIds.splice(a,1),delete d.dialogData.selectedUsersDict[e]),d.dialogData.searchTerm="",d.isOverLoaded()},d.toggleDialogContainer=function(){d.dialogLayout.collapsed=!d.dialogLayout.collapsed,d.toggleDialogFocusStatus(!d.dialogLayout.collapsed),d.saveIntoDialogsLayout(),h.updateDialogsPosition(d.chatLibrary)},d.toggleDialogFocusStatus=function(e){e&&(h.updateFocusedDialog(d.chatLibrary,d.dialogData.layoutId),v.markMessagesAsRead(d.dialogData,d.chatLibrary.shouldRespectConversationHasUnreadMessageToMarkAsRead)),(d.dialogLayout.hasFocus=e)&&d.dialogLayout.active&&d.markInactive();var a,a=e&&(a="",L().isDefined(window.getSelection)?a=window.getSelection().toString():L().isDefined(window.document.selection)&&"Text"===window.document.selection.type&&(a=window.document.selection.createRange().text),!(0<a.length))&&!d.dialogLayout.collapsed&&!d.dialogLayout.renameEditor.isEnabled;return d.dialogLayout.focusMeEnabled=a,d.saveIntoDialogsLayout(),!1},d.getTitle=function(e){var a=d.dialogData.chatMessages;if(a&&0<a.length){var t=a[0].senderTargetId;if(!t)return!1;t=d.chatLibrary.friendsDict[t].name}else t=d.dialogData.initiator.name;t=o("formatString")(h.chatLayout.defaultTitleForMessage,{userName:t}),d.title=t},d.changeTitle=function(){y.document.title=e%2==0?d.title:d.chatLibrary.currentTabTitle,e++},d.markInactive=function(){d.dialogLayout.active&&(d.dialogLayout.active=!1,a(),d.dialogLibrary&&d.dialogLibrary[d.dialogData.layoutId]&&d.dialogLibrary[d.dialogData.layoutId].active&&(f.debug(" --------------- markInactive -------------- set into local storage"),L().isUndefined(d.dialogLibrary[d.dialogData.layoutId])&&(d.dialogLibrary[d.dialogData.layoutId]={}),d.dialogLibrary[d.dialogData.layoutId].active=!1,d.dialogLibrary[d.dialogData.layoutId].played=!1,t.setLocalStorage(d.chatLibrary.dialogLocalStorageName,d.dialogLibrary)))},d.markActive=function(e){a(),L().isUndefined(d.dialogLibrary[d.dialogData.layoutId])&&(d.dialogLibrary[d.dialogData.layoutId]={}),d.dialogLibrary[d.dialogData.layoutId].active=!0,d.dialogLibrary[d.dialogData.layoutId].played=!1,t.setLocalStorage(d.chatLibrary.dialogLocalStorageName,d.dialogLibrary),d.dialogLayout.collapsed||d.chatLibrary.chatLayout.focusedLayoutId!==d.dialogData.layoutId?(d.dialogLayout.active=!0,d.dialogLayout.focusMeEnabled&&(d.dialogLayout.focusMeEnabled=!1)):v.markMessagesAsRead(d.dialogData)},d.handleLocalStorage=function(e){e.key===d.chatLibrary.dialogLocalStorageName&&(a(),d.dialogLayout.active&&d.dialogLibrary&&d.dialogLibrary[d.dialogData.layoutId]&&!d.dialogLibrary[d.dialogData.layoutId].active&&d.markInactive())},d.checkNewGenerationDialogStatus=function(){d.dialogData.isRenameEditorNeeded&&(d.dialogLayout.focusMeEnabled&&(d.dialogLayout.focusMeEnabled=!1),d.dialogData.isRenameEditorNeeded=!1,d.dialogLayout.renameEditor.isEnabled=!0,d.dialogLayout.renameEditor.hasFocus=!0)},d.getRecentGames=function(){d.chatLibrary.isGetRecentGamesCalled||(d.chatLibrary.isGetRecentGamesCalled||(d.chatLibrary.isGetRecentGamesCalled=!0),c.getRecentGame().then(function(e){var a,t;e&&0<e.length&&((t={})[e=(a=e[0]).placeId]=a,c.buildPlacesLibrary(d.chatLibrary,t),d.chatLibrary.placesLibrary[a.placeId].buttonLayoutForMe=I({},b.playButtons.play),d.chatLibrary.myRecentPlaceId=e,a.universeId)}))},d.search=function(e){var a=d.dialogData.searchTerm;if(!a)return!0;var t=e.name,i=e.contact,e=e.displayName,a=a.toLowerCase();return-1!==t.toLowerCase().indexOf(a)||e&&-1!==e.toLowerCase().indexOf(a)||i&&-1!==i.toLowerCase().indexOf(a)},d.dialogData.friendIds=d.chatLibrary.friendIds?d.chatLibrary.friendIds.slice():[],d.dialogMessages=[],d.dialogType=I({},h.dialogType),d.memberStatus=I({},h.memberStatus),d.dialogBannerTypes=I({},h.dialogBannerTypes),d.dialogLayout=L().isDefined(d.chatLibrary.dialogsLayout[d.dialogData.layoutId])?d.chatLibrary.dialogsLayout[d.dialogData.layoutId]:L().copy(h.dialogLayout),d.dialogLayout.layoutId=d.dialogData.layoutId,d.toastLayout={isEnabled:d.dialogLayout.isMembersOverloaded,timeout:d.dialogLayout.memberDisplay.timeoutToast},d.dialogLayout.defaultStyle={},d.isOverLoaded(),d.$watch(function(){return d.chatLibrary.dialogDict},function(e,a){if(L().isDefined(e)&&L().isDefined(e[d.dialogData.layoutId])){var t=d.dialogData.layoutId,i=d.chatLibrary,r=i.dialogIdList.indexOf(t),s=e[t];if(!a[t]||s.isUpdated){switch(L().isDefined(d.chatLibrary.dialogsLayout[d.dialogData.layoutId])?d.dialogLayout=d.chatLibrary.dialogsLayout[d.dialogData.layoutId]:L().isUndefined(d.dialogLayout)?d.dialogLayout=L().copy(h.dialogLayout):s.updateStatus===h.dialogStatus.INIT&&d.dialogLayout&&(d.dialogLayout.renameEditor=I({},h.dialogLayout.renameEditor)),s.isUpdated=!1,s.updateStatus){case h.dialogStatus.REPLACE:-1<r&&(d.dialogLayout.collapsed&&(d.dialogLayout.collapsed=!1),s.updateStatus=h.dialogStatus.INIT,d.toggleDialogFocusStatus(!0));case h.dialogStatus.INIT:-1<r&&(d.dialogLayout.focusMeEnabled===s.autoOpen&&(d.dialogLayout.focusMeEnabled=!s.autoOpen,s.autoOpen||v.markMessagesAsRead(d.dialogData)),d.checkNewGenerationDialogStatus(),u(),p());break;case h.dialogStatus.MINIMIZE:u(),d.chatLibrary.minimizedDialogIdList.indexOf(t)<0&&(d.chatLibrary.minimizedDialogIdList.push(t),d.chatLibrary.minimizedDialogData[t]=d.dialogData),g.empty();break;case h.dialogStatus.REFRESH:u(),s.updateStatus=h.dialogStatus.INIT}0===r&&d.getRecentGames()}m.updateStorage(m.storageDictionary.dialogIdList,d.chatLibrary.dialogIdList,d.chatLibrary.cookieOption),m.updateStorage(m.storageDictionary.dialogDict,d.chatLibrary.dialogDict,d.chatLibrary.cookieOption),d.saveIntoDialogsLayout(),-1<r&&(n=i.dialogIdList,l=d.dialogData.layoutId,c="#".concat(l),e=d.chatLibrary.chatLayout,a=L().element(document.querySelector(c)).find(".dialog-container"),i=e.widthOfChat,c=e.widthOfDialog+e.spaceOfDialog,n=n.indexOf(l),l=d.chatLibrary,i=+i+h.calculateRightPosition(l,n)+e.spaceOfDialog,y.innerWidth<i+c?o=+e.defaultChatZIndex+1:(o=+e.defaultChatZIndex+n,h.updateDialogsPosition(l)),a.css("z-index",o),a.addClass("dialog-visible"),s.markAsActive&&(d.markActive(s.activeType),s.markAsActive=!1))}var n,o,l,c},!0),d.$on("Roblox.Chat.MarkDialogInactive",function(e,a){a.layoutId===d.dialogData.layoutId&&d.markInactive()}),t.listenLocalStorage(d.handleLocalStorage)}}}r.$inject=["$window","$compile","$templateCache","$filter","chatUtility","chatClientStorageUtilityService","localStorageService","messageService","resources","gameService","gameLayout","$log"],t.Z.directive("dialog",r),a.default=r},2359:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.dialogHeader}}i.$inject=["resources"],t.Z.directive("dialogHeader",i),a.default=i},4835:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(a,e,i,r,s){return{restrict:"A",scope:!0,link:function(t,e){t.callbackScrollToBottom=function(){t.updateDialog()},t.callbackLazyLoad=function(){if(!t.dialogParams.loadMoreMessages||!t.dialogLayout.IsdialogContainerVisible)return!1;t.dialogLayout.isChatLoading=!0;var e=t.dialogData.chatMessages.length;a.getMessages(t.dialogData.id,t.dialogData.chatMessages[e-1].id,t.dialogParams.pageSizeOfGetMessages).then(function(e){if(t.dialogLayout.isChatLoading=!1,e){if(0<e.length){t.dialogLayout.scrollToBottom=!1,i.preProcessMessages(t.chatLibrary,t.dialogData,e);for(var a=0;a<e.length;a++)i.buildFallbackTimeStamp(e[a],t.dialogData),i.setFallbackClusterMaster(t.dialogData,e[a]);r.fetchDataForLinkCard(e,t.chatLibrary)}e.length<t.dialogParams.pageSizeOfGetMessages&&(t.dialogParams.loadMoreMessages=!1)}else t.dialogParams.loadMoreMessages=!1,i.processMessages(t.chatLibrary,t.dialogData,e,t.chatLibrary.friendsDict),r.fetchDataForLinkCard(e,t.chatLibrary)},function(){t.dialogLayout.isChatLoading=!1,s.debug("---error from get getMessages in dialogLazyLoadDirective.js---")})};e.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onInit:function(){s.debug("---- onInit callback ---- Scrollbars updated"),t.dialogLayout.scrollToBottom=!0},onUpdate:function(){s.debug("---- onUpdate callback ---- Scrollbars updated"+t.dialogLayout.scrollToBottom),t.dialogLayout.scrollToBottom?e.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}):t.dialogLayout.scrollToBottom=!0,e.hasClass("mCS_no_scrollbar")&&t.updateDialog()},onTotalScroll:t.callbackScrollToBottom,onTotalScrollOffset:60,onTotalScrollBack:t.callbackLazyLoad}})}}}i.$inject=["chatService","chatUtility","messageService","gameService","$log"],t.Z.directive("dialogLazyLoad",i),a.default=i},9300:function(e,a,t){"use strict";t.r(a);var i=t(792),i=t(5734),o=t.n(i),t=t(5862);function r(s,e,n){return{restrict:"A",scope:{chatLibrary:"="},templateUrl:e.templates.dialogMinimizeTemplate,link:function(t,i){function r(){var e=t.chatLibrary.chatLayout,a=t.chatLibrary.dialogIdList.length,e=+e.widthOfChat+s.calculateRightPosition(t.chatLibrary,a)+e.spaceOfDialog;i.css("right",e)}t.dialogType=s.dialogType,t.hasMinimizedDialogs=!1,t.layoutIdHasClicked=!1,t.openDialog=function(e){n.debug(" -------------------openDialog------------------ "+e);var a=t.chatLibrary.dialogIdList.pop();t.chatLibrary.dialogDict[a].isUpdated=!0,t.chatLibrary.dialogDict[a].updateStatus=s.dialogStatus.MINIMIZE,t.chatLibrary.dialogIdList.push(e),t.chatLibrary.dialogDict[e].isUpdated=!0,t.chatLibrary.dialogDict[e].updateStatus=s.dialogStatus.REPLACE;a=t.chatLibrary.minimizedDialogIdList.indexOf(e);-1<a&&(t.chatLibrary.minimizedDialogIdList.splice(a,1),delete t.chatLibrary.minimizedDialogData[e])},t.remove=function(e){var a=t.chatLibrary.minimizedDialogIdList.indexOf(e);-1<a&&(t.chatLibrary.minimizedDialogIdList.splice(a,1),delete t.chatLibrary.minimizedDialogData[e],delete t.chatLibrary.dialogDict[e])},Roblox.BootstrapWidgets.SetupPopover("top",{selector:"#dialogs-minimize"},"#dialogs-minimize-container"),t.$watch(function(){return t.chatLibrary.minimizedDialogIdList},function(e,a){o().isUndefined(e)||e==a||(n.debug("------ watch minimizedDialogIdList ----- "),0<e.length?(t.hasMinimizedDialogs||(t.hasMinimizedDialogs=!0),r()):0===e.length&&(t.hasMinimizedDialogs=!1))},!0),t.$watch(function(){return t.chatLibrary.chatLayout.areDialogsUpdated},function(e,a){e&&e!==a&&(t.$evalAsync(function(){t.chatLibrary.chatLayout.areDialogsUpdated=!1}),r())},!0)}}}r.$inject=["chatUtility","resources","$log"],t.Z.directive("dialogMinimize",r),a.default=r},7730:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e,a){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.displayMessage,link:function(e){e.initializeDisplayMessage=function(){e.messageHelper=a,e.displayMessage=e.chatUser.displayMessage},e.initializeDisplayMessage()}}}i.$inject=["resources","messageHelper"],t.Z.directive("displayMessage",i),a.default=i},31:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,link:function(e,a){function t(){if(!e.dialogParams.loadMoreFriends)return!1;e.dialogLayout.isChatLoading=!0}a.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onTotalScroll:t,onOverflowYNone:t}})}}}i.$inject=["$log"],t.Z.directive("friendsLazyLoad",i),a.default=i},9458:function(e,a,t){"use strict";t.r(a);var i=t(5734),s=t.n(i),t=t(5862);function r(e){return{restrict:"A",link:function(i,e){var r=i.chatLibrary.layout.topBarHeight;i.$watch(function(){return e.innerHeight()},function(e,a){var t;e&&e!==a&&(t="#".concat(i.dialogData.layoutId," .dialog-container"),a="#".concat(i.dialogData.layoutId," ").concat(i.friendsScrollbarElm),t=s().element(t),a=s().element(a),e=r+e,e=t.height()-e,a.css("height",e),a.mCustomScrollbar("update"))},!0)}}}r.$inject=["$log"],t.Z.directive("groupSelect",r),a.default=r},4684:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(a,s,t,n,o,l,c,d){return{restrict:"A",scope:!0,link:function(i,e){function r(){d.getFriendsPresence().then(function(e){null!=e&&e.length&&i.getFriendsInfo(e)},function(e){console.debug(e)}),i.chatLibrary.chatLayout.isChatLoading=!1,i.chatApiParams.loadMoreFriends=!1}i.callbackLazyLoad=function(){if(!i.chatApiParams||i.chatLibrary.chatLayout.errorMaskEnable||!i.chatApiParams.loadMoreConversations&&!i.chatApiParams.loadMoreFriends)return!1;i.chatLibrary.chatLayout.isChatLoading=!0,i.chatApiParams.loadMoreConversations&&a.getUserConversations(i.chatApiParams.pageNumberOfConversations,i.chatApiParams.pageSizeOfConversations,i.chatLibrary.friendsDict).then(function(e){var a=i.chatLibrary.friendsDict,t=o.getUserIdsNotInFriendsDict(e,a);return i.chatLibrary.chatLayout.isChatLoading=!1,e&&0<e.length?(i.buildChatUserListByConversations(e),i.chatApiParams.pageNumberOfConversations++,s.updateScrollbar(s.chatLayout.scrollbarClassName),e.length<i.chatApiParams.pageSizeOfConversations&&(i.chatApiParams.loadMoreConversations=!1,i.chatApiParams.loadMoreFriends=!0,i.chatApiParams.pageNumberOfConversations=1,r())):(i.chatApiParams.loadMoreConversations=!1,i.chatApiParams.loadMoreFriends=!0,i.chatApiParams.pageNumberOfConversations=1,r()),c.getUserContacts(t,a),l.getUserInfo(t,a)},function(){i.chatLibrary.chatLayout.isChatLoading=!1,t.debug("---error from get Conversations in lazyLoadDirective.js---")}),i.chatApiParams.loadMoreFriends&&r()},i.callbackScrollStart=function(){i.$broadcast("Roblox.Chat.ConversationListScroll"),n.triggerHandler("HoverPopover.EnableClose")},e.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onTotalScrollOffset:100,onTotalScroll:i.callbackLazyLoad,onOverflowYNone:i.callbackLazyLoad,onScrollStart:i.callbackScrollStart}})}}}i.$inject=["chatService","chatUtility","$log","$document","conversationsUtility","usersService","contactsService","usersPresenceService"],t.Z.directive("lazyLoad",i),a.default=i},3657:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,replace:!0,templateUrl:e.templates.linkCard}}i.$inject=["resources"],t.Z.directive("linkCard",i),a.default=i},3889:function(e,a,t){"use strict";t.r(a);var i=t(5734),r=t.n(i),t=t(5862);function s(e){return{restrict:"A",scope:!0,link:function(e){r().element("#dialogs-minimize").on("click touchstart",".popover-content #"+e.dialogLayoutId+" .minimize-title",function(){e.$apply(e.openDialog(e.dialogLayoutId))});r().element("#dialogs-minimize").on("click touchstart",".popover-content #"+e.dialogLayoutId+" .minimize-close",function(){e.$apply(e.remove(e.dialogLayoutId))})}}}s.$inject=["$log"],t.Z.directive("minimizeItem",s),a.default=s},8828:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",scope:!0,link:function(a,e){e.bind("click touchstart",function(e){e.preventDefault(),a.sendMessage()})}}}i.$inject=["$log"],t.Z.directive("removeFocus",i),a.default=i},3717:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e,a){return{link:function(){e.buildScrollbar(a.gameListScrollListSelector)}}}i.$inject=["chatUtility","playTogetherLayout"],t.Z.directive("repeatDone",i),a.default=i},9775:function(e,a,t){"use strict";t.r(a);var i=t(5734),r=t.n(i),t=t(5862);function s(t,e){return{restrict:"A",replace:!0,templateUrl:e.templates.selectFriendsTemplate,link:function(e){function a(){r().isUndefined(e.dialogData)||r().isUndefined(e.dialogData.selectedUserIds)||(e.dialogData.dialogType===t.dialogType.NEWGROUPCHAT?e.dialogLayout.inviteBtnDisabled=e.dialogData.selectedUserIds.length<2:e.dialogLayout.inviteBtnDisabled=0===e.dialogData.selectedUserIds.length)}a(),e.$watch(function(){return e.dialogData&&e.dialogData.selectedUserIds},function(){a()},!0)}}}s.$inject=["chatUtility","resources"],t.Z.directive("selectFriends",s),a.default=s},3252:function(e,a,t){"use strict";t.r(a);var i=t(5734),n=t.n(i),t=t(5862);function r(s,e){return{restrict:"A",link:function(i,e){var r=i.chatLibrary.layout.topBarHeight;i.$watch(function(){return e.innerHeight()},function(e,a){var t;e&&e!==a&&(t="#"+i.dialogData.layoutId+" .dialog-container",a="#"+i.dialogData.layoutId+" "+i.friendsScrollbarElm,t=n().element(t),a=n().element(a),e=r+i.chatLibrary.layout.detailsActionHeight+e,i.dialogData.dialogType===s.dialogType.NEWGROUPCHAT&&(e+=i.chatLibrary.layout.detailsInputHeight),e=t.height()-e,a.css("height",e),a.mCustomScrollbar("update"))},!0)}}}r.$inject=["chatUtility","$log"],t.Z.directive("selectFriendsResize",r),a.default=r},2287:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e,a){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.systemMessage,link:function(e){e.messageHelper=a}}}i.$inject=["resources","messageHelper"],t.Z.directive("systemMessage",i),a.default=i},9262:function(e,a,t){"use strict";t.r(a);var i=t(5734),p=t.n(i),t=t(5862);function r(e,u){return{restrict:"A",replace:!0,scope:!0,link:function(i,e){var a=i.dialogLayout.togglePopoverParams,r=a.dialogSelector,t=a.triggerSelector,s=a.pinIconClassName,n=a.dialogTriggerClassSelector,o=a.isExclusiveClickSelector||"is-exclusive-click";function l(){u.on("click",function(e){e.stopPropagation();var a,t=p().element(e.target);c(t)||(a=t,(e=p().element(r)).find(a)&&0<e.find(a).length)||function(e){var a=!1;!function(e){return e.hasClass(s)}(e)||(a=i.dialogData.playTogetherIds&&0<i.dialogData.playTogetherIds.length||i.dialogData.pinGame);!function(e){var a=p().element(n);return a.is(e)||a.find(e)&&0<a.find(e).length}(e)||(a=!0);e.hasClass(o)&&(a=!0);return a}(t)||(i.dialogLayout.togglePopoverParams.isOpen=!1)})}function c(e){var a=p().element(t);return a.is(e)||a.find(e)&&0<a.find(e).length}e.on("click",function(e){c(p().element(e.target))&&(i.dialogLayout.togglePopoverParams.isOpen=!i.dialogLayout.togglePopoverParams.isOpen)});var d=i.$watch(function(){return i.dialogData.playTogetherIds},function(e,a){e!==a&&e&&0<e.length&&(i.dialogLayout.togglePopoverParams.isOpen||(i.dialogLayout.togglePopoverParams.isOpen=!0))},!0),g=i.$watch(function(){return i.dialogLayout.togglePopoverParams.isFirstTimeOpen},function(e,a){e&&l()},!0);i.$on("$destroy",function(){d(),g()})}}}r.$inject=["$log","$document"],t.Z.directive("togglePopover",r),a.default=r},189:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.userConversationInfoTemplate}}i.$inject=["resources"],t.Z.directive("userConversationInfo",i),a.default=i},235:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e,i,r){return{storageDictionary:{dialogIdList:"dialogIdList",dialogDict:"dialogDict",dialogsLayout:"dialogsLayout",chatBarLayout:"chatBarLayout",chatFriendsListReloadTime:"chatFriendsListReloadTime"},isStorageDefined:function(e){return void 0!==window.Storage?this.getFromStorage(e):r.isCookieDefined(e)},getFromStorage:function(e){return void 0!==window.Storage?i.getLocalStorage(e):r.retrieveCookie(e)},updateStorage:function(e,a,t){void 0!==window.Storage?i.setLocalStorage(e,a):r.updateCookie(e,a,t)},removeFromStorage:function(e,a){void 0!==window.Storage?i.removeLocalStorage(e):r.destroyCookie(e,a)},updateChatFriendsListReloadTime:function(e){this.updateStorage(this.storageDictionary.chatFriendsListReloadTime,e)}}}i.$inject=["chatUtility","localStorageService","cookieService"],t.Z.factory("chatClientStorageUtilityService",i),a.default=i},7417:function(e,a,t){"use strict";t.r(a);var o=t(792),t=(t(5734),t(5862));function i(r,l,s,e,t,i,n){return{apiSets:{},setParams:function(){var e=o.EnvironmentUrls.chatApi;this.apiSets.markAsReadApi={url:"".concat(e,"/v2/mark-as-read"),retryable:!1,withCredentials:!0},this.apiSets.markAsSeenApi={url:"".concat(e,"/v2/mark-as-seen"),retryable:!1,withCredentials:!0},this.apiSets.sendMessageApi={url:"".concat(e,"/v2/send-message"),retryable:!1,withCredentials:!0},this.apiSets.conversationsApi={url:"".concat(e,"/v2/get-conversations"),retryable:!0,withCredentials:!0},this.apiSets.userConversationsApi={url:"".concat(e,"/v2/get-user-conversations"),retryable:!0,withCredentials:!0},this.apiSets.getMessagesApi={url:"".concat(e,"/v2/get-messages"),retryable:!0,withCredentials:!0},this.apiSets.multiGetLatestMessagesApi={url:"".concat(e,"/v2/multi-get-latest-messages"),retryable:!0,withCredentials:!0},this.apiSets.getUnreadConversationCountApi={url:"".concat(e,"/v2/get-unread-conversation-count"),retryable:!0,withCredentials:!0},this.apiSets.startOneToOneConversationApi={url:"".concat(e,"/v2/start-one-to-one-conversation"),retryable:!0,withCredentials:!0},this.apiSets.startGroupConversationApi={url:"".concat(e,"/v2/start-group-conversation"),retryable:!1,withCredentials:!0},this.apiSets.addToConversationApi={url:"".concat(e,"/v2/add-to-conversation"),retryable:!0,withCredentials:!0},this.apiSets.removeFromConversationApi={url:"".concat(e,"/v2/remove-from-conversation"),retryable:!0,withCredentials:!0},this.apiSets.renameGroupConversationApi={url:"".concat(e,"/v2/rename-group-conversation"),retryable:!1,withCredentials:!0},this.apiSets.updateUserTypingStatusApi={url:"".concat(e,"/v2/update-user-typing-status"),retryable:!1,withCredentials:!0},this.apiSets.uiPerformanceTrackingApi={url:"".concat(o.EnvironmentUrls.metricsApi,"/v1/performance/send-measurement"),retryable:!1,withCredentials:!0}},getMetaData:function(){return s.httpGet(t.apiSets.getMetaData,{})},getUnreadConversationCount:function(){return s.httpGet(this.apiSets.getUnreadConversationCountApi,null)},getUserConversations:function(e,a){var t={pageNumber:e,pageSize:a},i=n.getStorageName(n.chatDataName.getUserConversations,t),e=n.getChatDataFromLocalStorage(i);return e?(a=e,(e=r.defer()).resolve(a.data),e.promise):s.httpGet(this.apiSets.userConversationsApi,t).then(function(e){return n.saveChatDataToLocalStorage(i,e),e})},getConversations:function(e){var a={conversationIds:e},e={url:o.EnvironmentUrls.chatApi+t.chatUrls.getConversations,withCredentials:!0,retryable:!0};return s.httpGet(e,a).then(function(e){return e.forEach(function(e){i.buildPinGameInConversation(e)}),e})},addToConversation:function(e,a){a={participantUserIds:e,conversationId:a};return s.httpPost(this.apiSets.addToConversationApi,a)},removeFromConversation:function(e,a){a={participantUserId:e,conversationId:a};return s.httpPost(this.apiSets.removeFromConversationApi,a)},startOneToOneConversation:function(e){e={participantUserId:e};return s.httpPost(this.apiSets.startOneToOneConversationApi,e).then(function(e){if(e){e=e.conversation;return i.buildPinGameInConversation(e),e}})},startGroupConversation:function(e,a){a={participantUserIds:e,title:a};return s.httpPost(this.apiSets.startGroupConversationApi,a)},getMessages:function(e,a,t){t={conversationId:e,exclusiveStartMessageId:a,pageSize:t};return s.httpGet(this.apiSets.getMessagesApi,t)},getMessagesByPageSize:function(t,e,i,r,s,n){var o=this;this.getMessages(t.id,e,i).then(function(e){var a;e&&0<e.length?(a=2*i,e.forEach(function(e){r.push(e)}),function(e,a){if(!e||!e.chatMessages||e.chatMessages.length<=0)return!1;for(var t=0;t<a.length;t++)if(a[t].id===e.chatMessages[0].id)return!1;return!0}(t,e)&&a<=l.dialogParams.pageSizeOfGetMessages&&e.length===i?o.getMessagesByPageSize(t,e[e.length-1].id,a,r,s,n):s(n)):e&&0===e.length&&s(n)})},multiGetLatestMessages:function(e,a){a={conversationIds:e,pageSize:a};return s.httpGet(this.apiSets.multiGetLatestMessagesApi,a)},markAsRead:function(e,a){a={conversationId:e,endMessageId:a};return s.httpPost(this.apiSets.markAsReadApi,a)},markAsSeen:function(e){e={conversationsToMarkSeen:e};return s.httpPost(this.apiSets.markAsSeenApi,e)},sendMessage:function(e,a){a={conversationId:e,message:a};return s.httpPost(this.apiSets.sendMessageApi,a,!0)},renameGroupConversation:function(e,a){a={conversationId:e,newTitle:a};return s.httpPost(this.apiSets.renameGroupConversationApi,a)},updateUserTypingStatus:function(e,a){a={conversationId:e,isTyping:a};return s.httpPost(this.apiSets.updateUserTypingStatusApi,a)},sendPerformanceData:function(e,a){a={featureName:"Chat",measureName:e,value:a};return s.httpPost(this.apiSets.uiPerformanceTrackingApi,a)}}}i.$inject=["$q","chatUtility","httpService","$log","apiParamsInitialization","conversationsUtility","storageService"],t.Z.factory("chatService",i),a.default=i},4031:function(e,a,t){"use strict";t.r(a);var b=t(792),i=t(5734),f=t.n(i),t=t(5862);function r(n,t,o,e,a,i,r,s,l,c,d,g,u,p){function y(e){return f().isDefined(b.Linkify)&&"function"==typeof b.Linkify.String?b.Linkify.String(e.escapeHTML()):e}function h(e){return e.replace(/\n/g,"<br>")}function m(e){e=e.match(u.gameCardRegexs.privateServerLinkCode);if(e&&2==e.length)return{privateServerLinkCode:e[1]}}function v(e,a){return{content:e,isEmoji:a}}return{linksLibrary:f().copy(d.linksLibrary),chatLayout:f().copy(d.chatLayout),chatApiParams:f().copy(g.chatApiParams),dialogParams:f().copy(g.dialogParams),dialogLayoutResetConstant:f().copy(o.dialogLayoutResetConstant),dialogLayout:f().copy(o.dialogLayout),dialogBannerTypes:f().copy(o.dialogBannerTypes),userPresenceTypes:f().copy(i.userPresenceTypes),dialogType:f().copy(o.dialogTypes),newGroup:f().copy(o.newGroup),scrollBarType:f().copy(o.scrollBarTypes),errorMessages:f().copy(d.errors),memberStatus:f().copy(o.memberStatus),dialogInitValue:f().copy(o.dialogInitValue),dialogStatus:f().copy(o.dialogStatus),conversationInitStatus:f().copy(o.conversationInitStatus),conversationType:f().copy(o.conversationType),participantType:f().copy(o.participantType),notificationsName:e,notificationType:a,activeType:f().copy(o.activeType),performanceMarkLabels:l.chat,resultType:r,sendMessageErrorCode:s.sendMessageErrorCode,linkCardTypes:f().copy(u.linkCardTypes),eventStreamParams:f().copy(c.eventStreamParams),urlParamNames:f().copy(c.urlParamNames),chatEnabledByPrivacySettingTypes:{disabled:0,enabled:1,unavailable:2},hashOutContent:function(e){return e&&e.replace(/\S/g,"#")},buildScrollbar:function(e){f().element(document.querySelector(e)).mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:1,contentTouchScroll:1,mouseWheel:{preventDefault:!0}})},updateScrollbar:function(e){f().element(document.querySelector(e)).mCustomScrollbar("update")},escapeNewline:h,htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getAssetDetails:m,buildLinkCard:function(e){var a,t,i=y(e),r={content:i,isCard:!1},s=u.messageRegexs;for(a in s)s.hasOwnProperty(a)&&(t=s[a],(t=e.match(t))&&2===t.length&&(r={id:t[1],type:a,isCard:!0,content:i,assetDetails:m(e)}));return this.buildEmojiPieces(r),r},buildEmojiPieces:function(e){e.pieces=[];for(var a=e.content,t=u.emojiRegex,i=u.zwjRegex,r=u.emojiRepRegex,s="",n=!1,o=0;null!==(c=t.exec(a));){var l=c.index,c=c[0];o!==l?(s&&e.pieces.push(v(s,!0)),e.pieces.push(v(a.slice(o,l),!1)),s=c):null!=c.match(i)?(s+="&zwj;",n=!0):n||null!=c.match(r)?(s+=c,n=!1):(s&&e.pieces.push(v(s,!0)),s=c),o=t.lastIndex}s&&e.pieces.push(v(s,!0)),o<a.length&&e.pieces.push(v(a.slice(o),!1))},buildLinkCardMessages:function(e){var a=e.parsedContent;if(a&&0<a.length){var t=a.split(u.urlRegex);if(!t)return e.hasLinkCard=!1;e.linkCardMessages=[];for(var i=0;i<t.length;i++){var r=t[i],s=null;r.match(u.urlRegex)?s=this.buildLinkCard(r):r&&0<r.length&&!r.match(u.onlyNewLineRegex)&&(s={content:r=y(r=h(r=r.replace(u.removeNewLineRegex,""))),isCard:!1},this.buildEmojiPieces(s)),s&&e.linkCardMessages.push(s)}}return!0},sortFriendList:function(t,e){var a=n("orderBy"),i=[],r=[],s=[];return t.friendIds.forEach(function(e){var a=t.friendsDict[e];(0<(a&&a.presence?a.presence:a).userPresenceType?i:r).push(a),s.push(e)}),f().forEach(e,function(e){s.indexOf(e.id)<0&&(0<(e&&e.presence?e.presence:e).userPresenceType?i:r).push(e),t.friendIds.indexOf(e.id)<0&&t.friendIds.push(e.id)}),i=a(i,"+name"),r=a(r,"+name"),e=i.concat(r)},getScrollBarSelector:function(e,a){var t=e.layoutId;switch(f().isUndefined(a)&&(a=e.scrollBarType),a){case o.scrollBarTypes.FRIENDSELECTION:return"#scrollbar_friend_"+e.dialogType+"_"+t;case o.scrollBarTypes.MESSAGE:default:return"#scrollbar_"+e.dialogType+"_"+t}},hasLinkifyContent:function(e){return f().isString(e)&&0<=e.search("<a")&&0<=e.search("href=")&&0<=e.search("text-link")},sanitizeMessage:function(e){var a,t;e&&e.content&&(a=e.content,t=e.content=h(e.content),e.content=y(e.content),t!==e.content?(e.parsedContent=a,e.hasLinkCard=!0,e.hasLinkifyMessage=this.hasLinkifyContent(e.content),this.buildLinkCardMessages(e)):this.buildEmojiPieces(e))},sanitizeMessages:function(e){if(e&&0<e.length)for(var a=0;a<e.length;a++){var t=e[a];this.sanitizeMessage(t)}},getDataForMarkingSeen:function(e){var a=[];return t.document.hasFocus&&t.document.hasFocus()&&f().forEach(e,function(e){e.isConversation&&a.push(e.id)}),a},updateConversationTitle:function(e,a){e.title=a,e.name=a},updateDialogStyle:function(e,a,t){var i=a.defaultStyle;i&&i.inputStyle&&this.setResizeInputLayout(t,i.inputStyle.height,e,a)},setResizeInputLayout:function(e,a,t,i){var r=e.layout,s=r.topBarHeight,e=(e=a,(a=i).maxHeightOfTextInput<e?a.maxHeightOfInput:e),s=(r.bannerHeight,i.renameEditor.isEnabled?(r.renameEditorHeight,s+e+r.renameEditorHeight):s+e),r=r.dialogHeight-s+"px",s=o.dialogLayoutResetConstant.paddingOfInput/2;i.defaultStyle.dialogStyle={height:r},i.defaultStyle.inputStyle={height:e},i.defaultStyle.inputTextStyle={"padding-top":s}},calculateRightPosition:function(e,a){for(var t=this.chatLayout.widthOfDialog+this.chatLayout.spaceOfDialog,i=this.chatLayout.widthOfCollapsedDialog+this.chatLayout.spaceOfDialog,r=0,s=0;s<a;s++){var n=e.dialogIdList[s];r+=e.dialogsLayout[n].collapsed?i:t}return r},updateDialogsPosition:function(e){for(var a=e.chatLayout,t=a.widthOfChat,i=0;i<e.dialogIdList.length;i++){var r="#"+e.dialogIdList[i],s=f().element(document.querySelector(r)).find(this.dialogLayout.dialogContainerClass),r=+t+this.calculateRightPosition(e,i)+a.spaceOfDialog;s.css("right",r)}0<e.minimizedDialogIdList.length&&(e.chatLayout.areDialogsUpdated=!0)},updateFocusedDialog:function(e,a){p.debug(" ------ focused layoutId ------ "+a),e.chatLayout.focusedLayoutId=a},invalidateLinkCardsInMessageDict:function(e,t){e.forEach(function(e){var a;t[a=e].linkCardMessages.forEach(function(e){a===e.id&&(e.isCard=!1)})})},invalidatePlaceDetails:function(a,e){e.forEach(function(e){a.placesLibrary[e]||(a.placesLibrary[e]={}),a.placesLibrary[e]={isInvalid:!0}})},isPlaceDetailQualifiedInLibrary:function(e,a){return e[a]&&e[a].reasonProhibited}}}r.$inject=["$filter","$window","dialogAttributes","notificationsName","notificationType","presenceLayout","callBackTypes","httpResponse","performanceMarkLabels","resources","libraryInitialization","apiParamsInitialization","messageHelper","$log"],t.Z.factory("chatUtility",r),a.default=r},5767:function(e,a,t){"use strict";t.r(a);var l=t(792),i=t(5734),c=t.n(i),t=t(5862);function r(e,t,s){function n(e,a){return(i=a)[t=e]&&c().isDefined(i[t].avatarHeadshot)&&((a=a)[e=e]&&c().isDefined(a[e].userPresenceType));var t,i}function o(e){var a;return e.conversationUniverse&&(a={rootPlaceId:e.conversationUniverse.rootPlaceId,universeId:e.conversationUniverse.universeId,actorUsername:l.CurrentUser.name,userId:parseInt(l.CurrentUser.userId)},t.setPinGameData(e,a)),e}return{buildPinGameInConversation:o,getUserIdsNotInFriendsDict:function(e,i){var a,t,r=[];return e&&0<e.length&&(a=s.conversationType,t=s.dialogTypes,e.forEach(function(e){e.isGroupChat=e.conversationType===a.multiUserConversation,c().forEach(e.participants,function(e){e.userId=e.targetId;var a,t=e.targetId;r.indexOf(t)<0&&!n(t,i)&&r.push(t),i[t]||(a=e.name,e=e.displayName,i[t]={id:t,name:a,displayName:e,nameForDisplay:null!==l.DisplayNames&&void 0!==l.DisplayNames&&l.DisplayNames.Enabled()?e:a})}),e.dialogType||(e.dialogType=e.isGroupChat?t.GROUPCHAT:t.CHAT),o(e)})),r}}}r.$inject=["$log","pinGameService","dialogAttributes"],t.Z.factory("conversationsUtility",r),a.default=r},2768:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return n}});var a=jQuery,i=t.n(a),a=t(5734),r=t.n(a),t=t(5862);function s(e){return{isCookieDefined:function(e){return r().isDefined(i().cookie(e))&&i().cookie(e)},updateCookie:function(e,a,t){i().cookie(e,JSON.stringify(a),t)},retrieveCookie:function(e){return this.isCookieDefined(e)?JSON.parse(i().cookie(e)):[]},destroyCookie:function(e,a){i().cookie(e,null,a)}}}s.$inject=["$log"],t.Z.factory("cookieService",s);var n=s},512:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){var a=e,t={default:-1,member:0,game:1},i={INIT:0,OPEN:1,REPLACE:2,MINIMIZE:3,COLLAPSE:4,REMOVE:5,REFRESH:6},r={maxHeightOfTextInput:64,maxHeightOfInput:80,paddingOfInput:16,typing:{isTypingAsSender:!1,lastTimeTypingAsSender:null,isTypingFromSender:!1,lastTimeReceiveTypingEvent:null,lastTimeReceiveTimer:null,userIds:[],userTypingDict:{}},hoverOnCollapsed:!1,memberDisplay:{limitNumber:3,defaultLimit:3,isAll:!1,linkName:a.get("Label.SeeMore"),seeMoreLink:a.get("Label.SeeMore"),seeLessLink:a.get("Label.SeeLess"),toastText:function(e){return a.get("Message.ToastText",{friendNum:e})},timeoutToast:5e3},playTogetherButton:{buttonType:null,isPlayButtonDisabled:!1},togglePopoverParams:{isOpen:!1,dialogSelector:"",triggerSelector:"",dialogSelectorPrefix:"#dialog-container-",popoverTriggerSelectorPrefix:"#play-together-",pinIconClassName:"pin-icon",dialogTriggerClassSelector:"",dialogTriggerClassPrefix:".chat-friend-",isFirstTimeOpen:!1},layoutId:null},e={FRIEND:-1,CHAT:0,GROUPCHAT:1,NEWGROUPCHAT:2,ADDFRIENDS:6};return{activeType:{NEWMESSAGE:"New message"},conversationInitStatus:{remove:!1},conversationType:{oneToOneConversation:"OneToOneConversation",multiUserConversation:"MultiUserConversation",cloudEditConversation:"CloudEditConversation"},dialogBannerTypes:t,dialogInitValue:{isUpdated:!0,updateStatus:i.INIT,markAsActive:!1,activeType:null,autoOpen:!1},dialogLayout:{lookUpMembers:!1,focusMeEnabled:!0,hasFocus:!1,isFocused:!1,active:!1,isChatLoading:!1,collapsed:!1,isConfirmationOn:!1,isMembersOverloaded:!1,scrollToBottom:!1,IsdialogContainerVisible:!1,inviteBtnDisabled:!0,limitMemberDisplay:6,heightOfInput:32,maxHeightOfTextInput:r.maxHeightOfTextInput,maxHeightOfInput:r.maxHeightOfInput,paddingOfInput:r.paddingOfInput,limitCharacterCount:160,heightOfBanner:40,templateUrl:"chat-dialog",scrollbarElm:null,listenToScrollInitialized:!1,isBannerEnabled:!1,renameEditor:{isEnabled:!1,hasFocus:!1},bannerType:t.default,confirmDialog:{isOpen:!1,title:"",btnName:"",type:""},typing:r.typing,dialogContainerClass:".dialog-container",hoverOnCollapsed:!1,details:{isEnabled:!1,isConversationTitleEditorEnabled:!1,isAddFriendsEnabled:!1,isNegativeConfirmationEnabled:!1,friendMenuAction:{},friendIdForMenuOn:null},memberDisplay:r.memberDisplay,playTogetherButton:r.playTogetherButton,togglePopoverParams:r.togglePopoverParams},dialogLayoutResetConstant:r,dialogStatus:i,dialogTypes:e,memberStatus:{PENDING:0,MEMBER:1,LEADER:2},negativeAction:{removeUser:{title:a.get("Heading.RemoveUser"),headerTitle:a.get("Heading.RemoveUser"),btnName:a.get("Action.Remove"),cancelBtnName:a.get("Action.Cancel"),type:"removeUser"},leaveChatGroup:{title:a.get("Heading.ConfirmLeaving"),headerTitle:a.get("Heading.LeaveChatGroup"),btnName:a.get("Action.Leave"),cancelBtnName:a.get("Action.Stay"),type:"leaveChatGroup"}},newGroup:{dialogType:e.NEWGROUPCHAT,layoutId:"newGroup",title:a.get("Heading.NewChatGroup")},participantType:{user:"User"},scrollBarTypes:{MESSAGE:0,FRIENDSELECTION:1},systemMessage:{isSystemMessage:!0,isErrorMsg:!1}}}i.$inject=["languageResource"],t.Z.factory("dialogAttributes",i),a.default=i},6796:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){var i=e;return{playButtonTypes:{play:"play",join:"join",buy:"buy",details:"details",notAvailable:"notAvailable"},playButtons:{play:{type:"play",text:i.get("Label.PlayButton"),className:"btn-primary-xs btn-growth-xs",isPlayable:!0},join:{type:"join",text:i.get("Label.JoinButton"),className:"btn-primary-xs btn-growth-xs",isPlayable:!0},buy:{type:"buy",text:i.get("Label.BuyButton"),className:"btn-control-xs",isPlayable:!1},details:{type:"details",text:i.get("Label.ViewDetailsButton"),className:"btn-control-xs",isPlayable:!1},notAvailable:{type:"notAvailable",text:i.get("Label.GameNotAvailableButton"),isPlayable:!1}},buyAccess:{title:i.get("Heading.BuyItem"),yesButtonText:i.get("Action.BuyAccess"),yesButtonClass:"btn-primary-xs btn-growth-xs",noButtonText:i.get("Action.Cancel"),bodyText:function(e,a,t){e="<span class='font-bold'>".concat(e,"</span>"),t="<span class='icon-robux-16x16'></span><span class='text-robux'>".concat(t,"</span>");return i.get("Label.BuyAccessToGameForModal",{placeName:e,creatorName:a,robux:t})}}}}i.$inject=["languageResource"],t.Z.factory("gameLayout",i),a.default=i},2436:function(e,a,t){"use strict";t.r(a);var s=t(792),i=t(5734),y=t.n(i),t=t(5862);function r(o,t,e,i,r,l,n,c,d){var g={};function a(i,r){var e={placeIds:i};return t.httpGet(g.multiGetPlaceDetails,e).then(function(e){if(e&&0<e.length){var a={};e.forEach(function(e){a[e.placeId]=e});var t=[];return i.forEach(function(e){a[e]||(a[e]=null,t.push(e))}),r.forEach(function(e){e&&e.linkCardMessages&&e.linkCardMessages.forEach(function(e){e.isCard&&-1<t.indexOf(e.id)&&(e.isCard=!1)})}),a}})}function u(r,e,s){y().forEach(e,function(e,t){if(e){var a;r.placesLibrary[t]&&(a=r.placesLibrary[t]);var i=e.creatorName||e.builder;if(r.placesLibrary[t]={universeId:e.universeId,placeId:t,rootPlaceId:e.universeRootPlaceId||e.placeId||e.rootPlaceId,placeName:e.name,encodedPlaceName:o.htmlEntities(e.name),creatorName:i,encodedCreatorName:o.htmlEntities(i),creatorId:e.creatorId||e.builderId,gameIconUrl:e.gameIconUrl,placeUrl:e.url||e.placeUrl,reasonProhibited:e.reasonProhibited,description:e.description,price:e.price,isPlayable:e.isPlayable,gameReferralUrl:e.gameReferralUrl},a&&y().forEach(a,function(e,a){r.placesLibrary[t][a]||(r.placesLibrary[t][a]=e)}),e.reasonProhibited)switch(e.reasonProhibited){case l.reasonProhibitedMessage.None:case l.reasonProhibitedMessage.Playable:r.placesLibrary[t].buttonLayoutForLinkCard=y().copy(n.playButtons.play);break;case l.reasonProhibitedMessage.PurchaseRequired:default:r.placesLibrary[t].buttonLayoutForLinkCard=y().copy(n.playButtons.details)}r.universeLibrary[e.universeId]=r.placesLibrary[t]}else!e&&r.placesLibrary[t]&&(r.placesLibrary[t]={isInvalid:!0},s&&o.invalidateLinkCardInPieceOfMessage(t,s))})}function p(a,e){e.forEach(function(e){a.placesLibrary[e]||(a.placesLibrary[e]={}),a.placesLibrary[e]={isInvalid:!0}})}return{apiSets:g,setParams:function(e,a){g.setConversationUniverse={url:e+r.chatUrls.setConversationUniverse,retryable:!1,withCredentials:!0},g.resetConversationUniverse={url:e+r.chatUrls.resetConversationUniverse,retryable:!1,withCredentials:!0},g.multiGetPlaceDetails={url:a+r.gameUrls.multiGetPlaceDetails,retryable:!0,withCredentials:!0},g.GetGamesSorts={url:a+r.gameUrls.GetGamesSorts,retryable:!0,withCredentials:!0},g.GetGamesList={url:a+r.gameUrls.GetGamesList,retryable:!0,withCredentials:!0},g.getGamesByUniverseIds={url:r.gameUrls.getGamesByUniverseIds,retryable:!0,withCredentials:!0},g.multiGetPlayabilityStatus={url:r.gameUrls.multiGetPlayabilityStatus,retryable:!0,withCredentials:!0}},setConversationUniverse:function(e,a){a={conversationId:e,universeId:a};return t.httpPost(g.setConversationUniverse,a)},resetConversationUniverse:function(e){e={conversationId:e};return t.httpPost(g.resetConversationUniverse,e)},multiGetPlaceDetailsForLinkCard:a,multiGetPlaceDetails:function(e){return e={placeIds:e},t.httpGet(g.multiGetPlaceDetails,e).then(function(e){var a={};return y().forEach(e,function(e){a[e.placeId]=e}),a})},playRegularGame:function(e,a){a=!0===a,s.GameLauncher.joinMultiplayerGame(e,!0,a)},playTogetherGame:function(e,a){s.GameLauncher.playTogetherGame(e,a)},joinGame:function(e,a){s.GameLauncher.joinGameInstance(e,a,!0,!0)},playPrivateServerGame:function(e,a){s.GameLauncher.joinPrivateGame(e,null,a)},fetchDataForLinkCard:function(e,i){if(!e)return!1;var r=[],s={},n=[];e.forEach(function(t){t.hasLinkCard&&t.linkCardMessages.forEach(function(e){var a;e.isCard&&e.type===o.linkCardTypes.gameCard&&(a=e.id,o.isPlaceDetailQualifiedInLibrary(i.placesLibrary,a)?i.placesLibrary[a]&&i.placesLibrary[a].isInvalid&&(e.isCard=!1):(n.push(t),r.indexOf(a)<0&&(r.push(a),s[a]=t)))})}),0<r.length&&a(r,n).then(function(e){return e?void u(i,e,s):(p(i,r),o.invalidateLinkCardsInMessageDict(r,s),!1)},function(){p(i,r),o.invalidateLinkCardsInMessageDict(r,s)})},updateButtonLayoutPerConversation:function(e,a){if(!e.placeButtonLayout||e.placeButtonLayout&&!e.placeButtonLayout[a].isPlayable)return!1;e.pinGame&&e.playTogetherIds&&-1<e.playTogetherIds.indexOf(a)?e.placeButtonLayout[a]=y().copy(n.playButtons.join):e.placeButtonLayout[a]=y().copy(n.playButtons.play)},buildButtonLayoutPerConversation:function(t,i){var e=[],r=null,s=!0;t.playTogetherIds&&0<t.playTogetherIds.length&&(e=y().copy(t.playTogetherIds)),t.pinGame&&(r=t.pinGame.rootPlaceId,e.indexOf(r)<0&&(s=!1,e.push(r))),t.placeButtonLayout||(t.placeButtonLayout={}),y().forEach(e,function(e){var a=i[e];if(a)switch(a.reasonProhibited){case l.reasonProhibitedMessage.None:case l.reasonProhibitedMessage.Playable:t.placeButtonLayout[e]=s||e!==r?y().copy(n.playButtons.join):y().copy(n.playButtons.play);break;case l.reasonProhibitedMessage.PurchaseRequired:t.placeButtonLayout[e]=y().copy(n.playButtons.details);break;default:t.placeButtonLayout[e]=y().copy(n.playButtons.notAvailable)}})},buildPlacesLibrary:u,getRecentGame:function(){return t.httpGet(g.GetGamesSorts).then(function(e){var a,s;if(e&&e.sorts&&(e.sorts.forEach(function(e){if(e.name===l.sortNames.myRecent)return a=e.token,s=e.name,!1}),a)){e={sortToken:a,maxRows:l.maxRowsOfMyRecentGames};return t.httpGet(g.GetGamesList,e).then(function(e){if(e&&e.games&&0<e.games.length){var e=e.games,r=[];return y().forEach(e,function(e){var a,t,i;e.gameReferralUrl=(a=e,t=s,i=c.getGameDetailReferralUrls().chat,d("formatString")(i,{sortName:t,placeId:a.placeId})),r.push(e.universeId)}),e}})}})},getGames:function(e){var a={universeIds:e},e={};return e.getGamesInfo=t.httpGet(g.getGamesByUniverseIds,a),e.getPlayabilityStatus=t.httpGet(g.multiGetPlayabilityStatus,a),i.all(e).then(function(e){if(e&&e.getGamesInfo&&e.getPlayabilityStatus){var a=e.getGamesInfo.data,r=e.getPlayabilityStatus,s={},n={};return y().forEach(a,function(e,a){var t=e.rootPlaceId,i=r[a].universeId;s[t]=e,s[t].universeId=i,s[t].placeId=t,s[t].isPlayable=r[a].isPlayable,s[t].reasonProhibited=r[a].playabilityStatus,s[t].placeUrl=(e=s[t],a=c.getAbsoluteUrl(l.gameUrl),d("formatString")(a,{placeId:e.placeId})),n[i]=s[t]}),s}})}}}r.$inject=["chatUtility","httpService","$log","$q","apiParamsInitialization","gameParameters","gameLayout","urlService","$filter"],t.Z.factory("gameService",r),a.default=r},9816:function(e,a,t){"use strict";t.r(a);var i=t(5734),r=t.n(i),t=t(5862);function s(e){return{isGameExistedInPlacesLibrary:function(e,a){var t=null;return r().forEach(e,function(e){if(e.universeId===a)return t=e.placeId,!1}),t}}}s.$inject=["$log"],t.Z.factory("gameUtility",s),a.default=s},2731:function(e,a,t){"use strict";t.r(a);var i=t(792),t=t(5862);function r(e){var a=e,e={scrollbarClassName:"#chat-friend-list",chatContentSelector:"#chat-main",collapsed:!0,pageInitializing:!1,pageDataLoading:!1,chatBarInitialized:!1,isChatLoading:!1,widthOfChatCollapsed:112,widthOfChat:286,widthOfDialog:260,widthOfCollapsedDialog:160,spaceOfDialog:6,widthOfDialogMinimize:200,numberOfDialogOpen:0,defaultChatZIndex:1060,errorMaskEnable:!1,isFriendListEmpty:!1,isUserConversationEmpty:!1,chatLandingEnabled:!1,thresholdMobile:543,thresholdChatBarOpen:1748,resizing:!1,defaultTitleForMessage:a.get("Message.DefaultTitleForMsg"),urlParseInitialized:!1,noConnectionMsg:a.get("Message.NoConnectionMsg"),isChatEnabledByPrivacySetting:1,focusedDialogId:null,areDialogsUpdated:!1,maxOpenDialogs:12,conversationTitleChangedText:a.get("Message.conversationTitleChangedText"),abuseReportUrl:"/abusereport/chat?id={userId}&redirectUrl={location}&conversationId={conversationId}"},a={default:a.get("Message.DefaultErrorMsg"),conversationTitleModerated:a.get("Message.ConversationTitleModerated"),messageContentModerated:a.get("Message.MessageContentModerated"),messageFilterForReceivers:a.get("Message.MessageFilterForReceivers"),textTooLong:a.get("Message.TextTooLong"),sendingMessagesTooQuickly:a.get("Message.SendingMessagesTooQuickly"),unknownMessageType:a.get("Message.UnknownMessageType")};return{chatLayout:e,chatLibrary:{chatLayout:e,chatLayoutIds:[],conversationsDict:{},currentTabTitle:null,dialogIdList:[],dialogDict:{},dialogScopeLib:{},dialogsLayout:{},dialogRequestedToOpenParams:{layoutId:null,autoPop:!1},errors:a,friendIds:[],friendLayoutIds:[],friendsDict:{},isTakeOverOn:angular.element(document.querySelector("#wrap")).data("gutter-ads-enabled"),layout:{bannerHeight:40,playTogetherBannerHeight:102,dialogHeight:360,inputHeight:32,renameEditorHeight:32,searchHeight:32,topBarHeight:32,detailsActionHeight:48,detailsInputHeight:32},layoutIdList:[],minimizedDialogIdList:[],minimizedDialogData:{},userConversationsDict:{},allConversationLayoutIdsDict:{},placesLibrary:{},playTogetherLibrary:{},layoutIdsDictPerUserId:{},gamesPageLink:"".concat(i.EnvironmentUrls.websiteUrl,"/discover"),senderTypesForUnknownMessageTypeError:[],isInvalidMessageTypeFallbackEnabled:!1,isMetaDataLoaded:!1,universeLibrary:{},voiceChannelMapToConversation:{}},chatViewModel:{chatDomain:null,friendsDict:{},friendsHasConversation:[],chatUserDict:{}},dialogLocalStorageNamePrefix:"dialogLibrary_",errors:a,linksLibrary:{settingTabName:"Settings",settingLink:"/my/account#!/privacy"}}}r.$inject=["languageResource"],t.Z.factory("libraryInitialization",r),a.default=r},7523:function(e,a,t){"use strict";t.r(a);var i=t(5734),T=t.n(i),t=t(5862);function r(t,c,d,g,u,s,i,p,l,y,h,n,m){var r=3e4;function v(e){e.sent&&!e.parsedTimestamp&&(e.parsedTimestamp=new Date(e.sent).getTime())}function o(e,a,t){var i=e.parsedTimestamp,r=T().isDefined(t)?t:new Date,s=new Date(r-864e5),n=new Date(i),o=n.toDateString(),l=Math.round(Math.abs(r.getTime()-n.getTime())/864e5),c=n.getDay(),d=r.getFullYear(),t=n.getFullYear(),n="h:mm a";r.toDateString()===o?(r=g("date")(i,n),a?e.briefTimeStamp=r:e.displayTimeStamp=r):s.toDateString()===o?a?e.briefTimeStamp="Yesterday":e.displayTimeStamp="Yesterday | ".concat(g("date")(i,n)):l<=c?a?(n="EEE",e.briefTimeStamp=g("date")(i,n)):(n="EEE | ".concat(n),e.displayTimeStamp=g("date")(i,n)):d===t?a?(n="MMM d",e.briefTimeStamp=g("date")(i,n)):(n="MMM d | ".concat(n),e.displayTimeStamp=g("date")(i,n)):a?(n="MMM d, yyyy",e.briefTimeStamp=g("date")(i,n)):(n="MMM d, yyyy | "+n,e.displayTimeStamp=g("date")(i,n))}function b(a,e,t){if(e&&0<e.length){for(var i=[],r=e.length-1;0<=r;r--){var s=e[r];s.linkCardMessages=[];var n=p.messageTypes;switch(s.messageType){case n.link.name:s.hasLinkCard=!0;var o=s.link.game.universeId;l.isGameExistedInPlacesLibrary(a.placesLibrary,o)||i.push(o);o={universeId:o,isLinkCard:!0};s.linkCardMessages.push(o);break;case n.eventBased.name:s.isSystemMessageFromApi=!0,h.setSystemMessage(s);break;case n.plainText.name:c.sanitizeMessage(s)}}a.isRespectingMessageTypeEnabled&&0<i.length&&y.getGames(i).then(function(e){y.buildPlacesLibrary(a,e);e=a.placesLibrary;y.buildButtonLayoutPerConversation(t,e)})}}var f,L,I=(L=!(f={}),{queueMessageToMarkRead:function(e,a){!(f[e.id]={conversation:e,latestMessageId:a})===L&&(L=!0,i(D,1e3))}});function D(){for(var e in f){var a=f[e];t.markAsRead(e,a.latestMessageId).then(function(e){e&&((e=a.conversation).hasUnreadMessages=!1,e.unreadMessageIds=[],e.unreadMessageTimestamps=[],null!==a.latestMessageId&&e.pendingUnreadMessageId.splice(a.latestMessageId,1),d.$broadcast("Roblox.Chat.LoadUnreadConversationCount"))},function(){u.debug("----- markAsRead request is failed ! ------")})}L=!(f={})}return{setParams:function(e){r=parseInt(e.partyChromeDisplayTimeStampInterval)},setFallbackClusterMaster:function(e,a){T().isUndefined(e.chatMessages)&&(e.chatMessages=[]);var t=e.chatMessages.length-1;a.displayTimeStamp&&(a.isClusterMaster=!0),0<e.chatMessages.length&&e.chatMessages[t].senderTargetId!==a.senderTargetId&&(e.chatMessages[t].isClusterMaster=!0),e.chatMessages.push(a)},setClusterMaster:function(e,a){T().isUndefined(e.chatMessages)&&(e.chatMessages=[]),(0<e.chatMessages.length&&e.chatMessages[0].senderTargetId!==a.senderTargetId||a.displayTimeStamp)&&(a.isClusterMaster=!0),a.resetClusterMessage||e.chatMessages.unshift(a)},buildFallbackTimeStamp:function(e,a,t){if(!e.sent)return!1;v(e);var i=e.parsedTimestamp;(!a.startTimeStamp||i+r<a.startTimeStamp)&&(o(e,!1,t),a.startTimeStamp=i)},buildTimeStamp:function(e,a,t){if(!e.sent)return!1;v(e);var i=e.parsedTimestamp;return a.previousTimeStamp||(a.startTimeStamp=i),(!a.previousTimeStamp||i-r>a.previousTimeStamp)&&(o(e,!1,t),a.previousTimeStamp=i),!0},updateContentForInvalidMessageType:function(a,e){T().forEach(e,function(e){h.isMessageTypeInWhiteList(a,e)||(e.content=a.errors.unknownMessageType)})},preProcessMessages:function(e,a,t){this.updateContentForInvalidMessageType(e,t),e.isRespectingMessageTypeEnabled?b(e,t,a):c.sanitizeMessages(t)},processMessages:function(e,a,t,i){this.preProcessMessages(e,a,t),this.manipulateMessages(a,t,i)},manipulateMessages:function(e,a,t){if(a||(e.messagesDict={},e.unreadMessageIds=[],e.unreadMessageTimestamps=[]),T().isUndefined(e.messagesDict)&&(e.messagesDict={}),T().isUndefined(e.unreadMessageIds)&&(e.unreadMessageIds=[],e.unreadMessageTimestamps=[]),a&&0<a.length){var i=a.length,r=[];e.previousTimeStamp=null;for(var s=i-1;0<=s;s--){var n=a[s];this.buildTimeStamp(n,e),e.messagesDict[n.id]||(e.messagesDict[n.id]=n,this.setClusterMaster(e,n),n.read||(e.unreadMessageIds.push(n.id),e.unreadMessageTimestamps.push(n.parsedTimestamp))),l=t,c=r,(o=n).senderType===p.senderTypes.user&&(l&&!l[o.senderTargetId]&&c.indexOf(o.senderTargetId)<0)&&(o=n.senderTargetId,u.debug(" ----- new friend information for this message, trying to get now -----"+o),n=[o],r.push(o),m.getUserInfo(n,t))}0<e.unreadMessageIds.length&&d.$broadcast("Roblox.Chat.LoadUnreadConversationCount")}var o,l,c},formatTimestampInConversation:function(e){e.briefTimeStamp||(e.parsedTimestamp=new Date(e.lastUpdated).getTime(),o(e,!0))},appendMessages:function(e,a,t){if(!t)return!1;if(T().isUndefined(a.unreadMessageIds)&&(a.unreadMessageIds=[],a.unreadMessageTimestamps=[]),this.updateContentForInvalidMessageType(e,t),e.isRespectingMessageTypeEnabled?b(e,t,a):c.sanitizeMessages(t),a.chatMessages&&0!==a.chatMessages.length){if(a.chatMessages){for(var i={},r=0;r<a.chatMessages.length;r++){var s=a.chatMessages[r];if(!s.isSystemMessage&&!s.sendMessageHasError&&!s.resetClusterMessage){v(i=a.chatMessages[r]);break}}for(r=t.length-1;0<=r;r--){v(l=t[r]);var n=l.id===i.id||i.id&&"string"!=typeof i.id&&i.id.toString()===l.id,o=!T().isUndefined(a.messagesDict)&&!T().isUndefined(l.id)&&!T().isUndefined(a.messagesDict[l.id]);!(T().equals({},i)||l.parsedTimestamp>i.parsedTimestamp)||n||o||(this.buildTimeStamp(l,a),this.setClusterMaster(a,l),a.messagesDict[l.id]=l),l.read||(a.hasUnreadMessages=!0,a.unreadMessageIds.push(l.id),a.unreadMessageTimestamps.push(l.parsedTimestamp))}}}else{for(var r=t.length-1;0<=r;r--){var l=t[r];this.buildTimeStamp(l,a),this.setClusterMaster(a,l)}a.chatMessages=t}a.displayMessage=this.getDisplayMessageForUser(t),0<a.unreadMessageIds.length&&d.$broadcast("Roblox.Chat.LoadUnreadConversationCount")},markMessagesAsRead:function(e,a){var t,i;e.chatMessages&&e.unreadMessageIds?(i=(t=e.chatMessages).length,0<e.unreadMessageTimestamps.length&&e.unreadMessageTimestamps[0]>=t[i-1].parsedTimestamp&&(i=e.unreadMessageIds.length,i=e.unreadMessageIds[i-1],T().isUndefined(e.pendingUnreadMessageId)&&(e.pendingUnreadMessageId=[]),e.pendingUnreadMessageId.indexOf(i)<0&&(e.pendingUnreadMessageId.push(i),I.queueMessageToMarkRead(e,i)))):e.unreadMessageIds&&0===e.unreadMessageIds.length&&a&&e.hasUnreadMessages&&I.queueMessageToMarkRead(e,null)},buildSystemMessage:function(e,a,t){var i=T().copy(n.systemMessage);switch(h.setSystemMessage(i,t),e){case c.notificationType.conversationTitleModerated:i.content=c.errorMessages.conversationTitleModerated;break;case c.notificationType.conversationTitleChanged:var r=c.htmlEntities(a.title);i.content=g("formatString")(c.chatLayout.conversationTitleChangedText,{userName:a.actorUsername,groupName:r});break;case c.notificationType.conversationUniverseChanged:i.content=s.playTogether.pinGameUpdate(a.pinGame.actorUsername,a.pinGame.encodedPlaceName);break;case c.notificationType.presenceOnline:i.content=s.playTogether.playGameUpdate,i.hasParams=!0}T().isUndefined(a.chatMessages)&&(a.chatMessages=[]),v(i),this.setClusterMaster(a,i)},resetConversationUnreadStatus:function(e,a){0===a.length&&e.hasUnreadMessages&&I.queueMessageToMarkRead(e,null)},getDisplayMessageForUser:function(e){var a={};if(e)for(var t=e.length,i=0;i<t;i++)if(e[i].senderType===p.senderTypes.user)return a=e[i],a=this.buildDisplayMessage(a);return a},buildDisplayMessage:function(e,a){return v(e),o(e,!0,a),e},refreshTypingStatus:function(e,a,t,i){if(e&&t&&e.conversationType===c.conversationType.multiUserConversation){var r=e.chatMessages;if(r&&0<r.length)for(var s=i.typing.userTypingDict[a],n={},o=0;o<r.length;o++){var l=r[o];if(l.isClusterMaster&&l.senderTargetId===a&&(!n[a]||n[a].messageId!==l.id)){s.messageId=l.id;break}}}},categorizeMessageType:b}}r.$inject=["chatService","chatUtility","$rootScope","$filter","$log","systemMessages","$timeout","messageHelper","gameUtility","gameService","messageUtility","dialogAttributes","usersService"],t.Z.factory("messageService",r),a.default=r},3355:function(e,a,t){"use strict";t.r(a);var i=t(5734),r=t.n(i),t=t(5862);function s(e,i,a){return{isMessageTypeInWhiteList:function(e,a){return-1<e.validMessageTypesWhiteList.indexOf(a.messageType)},isMessageTypeLegal:function(a){var t=!1;return r().forEach(i.messageTypes,function(e){if(e.name===a.messageType)return!(t=!0)}),t},isSenderTypeLegal:function(a){var t=!1;return r().forEach(i.senderTypes,function(e){if(e===a.senderType)return!(t=!0)}),t},setSystemMessage:function(t,e){t?r().forEach(a.systemMessage,function(e,a){t[a]=e}):t=r().copy(a.systemMessage),e&&(t.isErrorMsg=!0);e=new Date;t.sent=e.toISOString()},hasUnreadMessages:function(e,a){return e.hasUnreadMessages||a.some(function(e){return!e.read}),e.hasUnreadMessages}}}s.$inject=["$log","messageHelper","dialogAttributes"],t.Z.factory("messageUtility",s),a.default=s},6737:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{tooltipForPinGame:e.get("Label.PinGameTooltip"),tooltipForUnPinGame:e.get("Label.UnpinGameTooltip"),titleForPinGame:e.get("Label.PinnedGame")}}i.$inject=["languageResource"],t.Z.factory("pinGameLayout",i),a.default=i},8034:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e,i,t,r,s){return{sendPinGameEvent:function(e,a,t){t={placeId:a,conversationId:t.id};r.sendEventWithTarget(e,s.eventStreamParams.actions.click,t)},setPinGameData:function(e,a){var t;a&&a.universeId?(t=a.rootPlaceId,e.pinGame={universeId:a.universeId,rootPlaceId:t,placeName:a.placeName,encodedPlaceName:a.encodedPlaceName,actorUsername:a.actorUsername,userId:a.userId}):e.pinGame=null,i.setPlaceForShown(e)},pinGame:function(e,a){e&&a&&t.setConversationUniverse(e.id,a)},unpinGame:function(e){e&&t.resetConversationUniverse(e.id)}}}i.$inject=["$log","playTogetherService","gameService","eventStreamService","resources"],t.Z.factory("pinGameService",i),a.default=i},3254:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){var a=e;return{numberOfMembers:{inPinnedGame:3,inActiveGame:4},gameListScrollListSelector:"#active-game-list",activeGamesList:{maxNumberForFit:4,minNumberForFit:1,limitNumber:1,showMore:function(e){return a.get("Label.ShowMoreGames",{count:e})},showMoreText:"",showLess:a.get("Label.ShowLessGames"),toggleMenuText:"",isCollapsed:!0,pinGameIsInActiveGames:!1},recommendedLabel:a.get("Label.RecommendedGames")}}i.$inject=["languageResource"],t.Z.factory("playTogetherLayout",i),a.default=i},1062:function(e,a,t){"use strict";t.r(a);var i=t(792),r=t(5734),c=t.n(r),t=t(5862);function s(e){return{isPlacePlayersOnlyMe:function(e,a){if(e.playTogetherDict&&e.playTogetherDict[a]){a=e.playTogetherDict[a].playerIds;if(a&&1===a.length&&a[0]===parseInt(i.CurrentUser.userId))return!0}return!1},setPlaceForShown:function(e){var a,t;e.playTogetherIds&&0<e.playTogetherIds.length?(t=e.playTogetherIds[0],this.isPlacePlayersOnlyMe(e,t)||(a=e.playTogetherDict[t].universeId,e.placeForShown={rootPlaceId:t,universeId:a})):e.pinGame?(a=(t=e.pinGame).rootPlaceId,t=t.universeId,e.placeForShown={rootPlaceId:a,universeId:t}):e.placeForShown=null},sortPlayTogetherIds:function(i,e){if(!i||!e||!e.rootPlaceId)return!1;var r,s=parseInt(e.rootPlaceId),a=parseInt(e.placeId),t=e.gameId,n=parseInt(e.userId),o=parseInt(e.universeId),l=(l=e.lastOnline)&&new Date(l).getTime();if(!i.playTogetherIds){i.playTogetherIds=[s],i.playTogetherDict={};return!(i.playTogetherDict[s]={playerIds:[n],gameInstanceId:t,lastSeen:l,placeId:a,universeId:o})}i.playTogetherDict[s]?i.playTogetherDict[s].placeId!==a&&(i.playTogetherDict[s].placeId=a):i.playTogetherDict[s]={playerIds:[n],gameInstanceId:t,lastSeen:l,placeId:a,universeId:o},i.playTogetherDict[s].playerIds.indexOf(n)<0&&i.playTogetherDict[s].playerIds.push(n),i.playTogetherDict[s]&&(r=i.playTogetherDict[s].playerIds.length,c().forEach(i.playTogetherIds,function(e,a){var t=i.playTogetherDict[e].playerIds;if(-1<t.indexOf(n)&&s!==e&&(t=t.indexOf(n),i.playTogetherDict[e].playerIds.splice(t,1)),i.playTogetherDict[e].playerIds.length<r)return i.playTogetherIds.splice(a,0,s),!1}),i.playTogetherIds.indexOf(s)<0&&i.playTogetherIds.push(s)),i.playTogetherDict[s].lastSeen<l&&(i.playTogetherDict[s].gameInstanceId=t,i.playTogetherDict[s].lastSeen=l),i.recentPlaceIdFromPresence=e.rootPlaceId,i.recentUserIdFromPresence=e.userId}}}s.$inject=["$log"],t.Z.factory("playTogetherService",s),a.default=s},4411:function(e,a,t){"use strict";t.r(a);t=t(5862);function i(e){return{userPresenceTypes:[{className:"",title:e.get("Label.Offline")},{className:"online",title:e.get("Label.Online")},{className:"game",title:e.get("Label.InGame")},{className:"studio",title:e.get("Label.InStudio")}],status:{offline:0,online:1,inGame:2,inStudio:3}}}i.$inject=["languageResource"],t.Z.factory("presenceLayout",i),a.default=i},5404:function(e,a,t){"use strict";t.r(a);var i=t(5734),s=t.n(i),t=t(5862);function r(i,e,t){var r=!1,a=1e4;return{chatDataName:{getUserConversations:"getUserConversations",getConversations:"getConversations",getMessages:"getMessages"},setStorageParams:function(e){r=e.IsChatDataFromLocalStorageEnabled,a=1e3*e.ChatDataFromLocalStorageExpirationSeconds},getStorageName:function(e,a){var t=i.chatDataLSNamePrefix+"."+e;return s().forEach(a,function(e){t=t+"."+e}),t},saveChatDataToLocalStorage:function(e,a){r&&t.saveDataByTimeStamp(e,a)},getChatDataFromLocalStorage:function(e){return r&&t.fetchNonExpiredCachedData(e,a),null},clearLocalStorage:function(){var e=t.storage();if(e)for(var a in e)a&&-1<a.search(i.chatDataLSNamePrefix)&&t.removeLocalStorage(a)}}}r.$inject=["resources","$log","localStorageService"],t.Z.factory("storageService",r),a.default=r},5898:function(e,a,t){"use strict";t.r(a);t(5734);t=t(5862);function i(e){var t=e;return{playTogether:{pinGameUpdate:function(e,a){return t.get("Message.PinGameUpdate",{userName:e,gameName:a})},playGameUpdate:t.get("Message.PlayGameUpdate")}}}i.$inject=["languageResource"],t.Z.factory("systemMessages",i),a.default=i},7482:function(e,a,t){"use strict";t.r(a);var s=t(792),i=t(5734),n=t.n(i),t=t(5862);function r(t,i,r){return{getAvatarHeadshots:function(e,t){var a=i.apiSets.multiGetAvatarHeadshots;return r.buildBatchPromises(a,e,50,"userIds").then(function(e){if(e&&0<e.length){var a=[];return n().forEach(e,function(e){a=a.concat(e.data)}),n().forEach(a,function(e){var a=e.targetId;t[a]||(t[a]={}),t[a].avatarHeadshot=e}),a}return null})},getUserPresence:function(e,t){var a=i.apiSets.multiGetPresence;return r.buildBatchPromises(a,e,100,"userIds","POST").then(function(e){if(e&&0<e.length){var a=[];return n().forEach(e,function(e){e=e.userPresences;a=a.concat(e)}),a.forEach(function(e){var a=e.userId;t[a]||(t[a]={}),t[a].presence=e,s.Endpoints&&(t[a].profileUrl=s.Endpoints.generateAbsoluteUrl("/users/{id}/profile",{id:a},!0))}),a}return null})},getUserInfo:function(e,a){a={avatarHeadshots:this.getAvatarHeadshots(e,a),presences:this.getUserPresence(e,a)};return t.all(a).then(function(e){return e})}}}r.$inject=["$q","apiParamsInitialization","httpService"],t.Z.factory("usersService",r),a.default=r},4742:function(e){e.exports='<div class="details-container add-friends-container" ng-class="{\'collapsed\': dialogLayout.collapsed}" ng-show="dialogLayout.details.isAddFriendsEnabled" ng-controller="friendsController"> <div class="chat-windows-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-back" ng-click="toggleAddFriends()"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label chat-header-create-group" ng-click="toggleDialogContainer()"> <span class="font-bold font-caption-header" ng-bind="\'Label.AddFriends\' | translate"></span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div select-friends></div> <div class="details-btns-fixed select-friends-btns"> <button id="select-friends-cancel" ng-click="toggleAddFriends()" ng-bind="\'Action.Cancel\' | translate" class="btn-fixed-width btn-control-sm details-btn-cancel select-friends-cancel"></button> <button id="select-friends-save" class="btn-fixed-width btn-secondary-sm btn-cta-sm details-btn-save select-friends-save" ng-bind="\'Action.Add\' | translate" ng-disabled="dialogLayout.inviteBtnDisabled" ng-click="sendInvite(); toggleAddFriends()"></button> </div> </div>'},5707:function(e){e.exports='<div class="details-confirmation-container" ng-show="dialogLayout.isConfirmationOn"> <div class="dialog-report-content"> <div class="chat-windows-header"> <div class="chat-header-back" ng-click="dialogLayout.isConfirmationOn = false"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span ng-bind="\'Action.Report\'|translate" class="font-caption-header">Report</span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div class="details-negative-confirmation-body"> <span ng-bind="\'Heading.ContinueToReport\'|translate" class="small text details-negative-confirmation-text">Continue to report?</span> <div class="details-btns-fixed select-friends-btns"> <button class="btn-control-sm details-btn-cancel" ng-bind="\'Action.Cancel\'|translate" ng-click="dialogLayout.isConfirmationOn = false"></button> <button id="chat-abuse-report-btn" class="btn-alert-sm details-btn-save" ng-bind="\'Action.Report\'|translate" ng-click="abuseReport(null, true)"></button> </div> </div> </div> </div>'},6492:function(e){e.exports='<thumbnail-2d thumbnail-target-id="userId" thumbnail-type="layoutLibrary.thumbnailTypes.avatarHeadshot" thumbnail-options="{size: layoutLibrary.avatarHeadshotSize.size48}" class="{{className}}" alt-name="userId" title="{{userId}}"> </thumbnail-2d>'},5307:function(e){e.exports='<div id="chat-main" class="chat-main" ng-controller="chatBarController" ng-class="{\'chat-main-empty\': isChatEmpty() }" ng-cloak> <div id="chat-header" class="chat-windows-header chat-header"> <div class="chat-header-label" ng-click="toggleChatContainer()"> <span class="font-caption-header chat-header-title" ng-bind="\'Heading.Chat\' | translate"></span> </div> <div class="chat-header-action"> <span class="xsmall notification-red notification" ng-show="chatLibrary.chatLayout.collapsed && chatViewModel.unreadConversationCount > 0" ng-cloak>{{chatViewModel.unreadConversationCount}}</span> <span> <span id="chat-group-create" class="icon-chat-group-create" ng-hide="chatLibrary.chatLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.chatLandingEnabled || chatLibrary.chatLayout.pageDataLoading || chatLibrary.chatLayout.isChatDisabledByPrivacySetting" ng-click="launchDialog(newGroup.layoutId)" uib-tooltip="{{\'Label.SpanTitle.CreateGroupNeeds2More\' | translate}}" tooltip-placement="bottom-right" ng-cloak></span> </span> </div> </div> <div id="chat-body" class="chat-body" ng-show="!chatLibrary.chatLayout.errorMaskEnable && !chatLibrary.chatLayout.pageDataLoading && !chatLibrary.chatLayout.pageInitializing" ng-if="!(chatLibrary.chatLayout.chatLandingEnabled || chatLibrary.chatLayout.isChatEnabledByPrivacySetting !== chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled)"> <div class="border-bottom chat-search" ng-class="{\'chat-search-focus\': chatLibrary.chatLayout.searchFocus}"> <span> <input type="text" placeholder="{{\'Label.InputPlaceHolder.SearchForFriends\' | translate }}" class="input-field chat-search-input font-caption-body" ng-model="chatViewModel.searchTerm" ng-focus="chatLibrary.chatLayout.searchFocus = true"/> </span> <span class="icon-chat-search"></span> <span class="icon-chat-search-cancel" ng-click="cancelSearch()"></span> </div> <div id="chat-friend-list" class="rbx-scrollbar chat-friend-list" lazy-load> <ul id="chat-friends" class="chat-friends"> <li ng-repeat="chatUser in chatUserDict | orderList: chatLibrary.chatLayoutIds | filter : search" class="chat-friend chat-friend-{{chatUser.id}}"> <div ng-if="chatUser.dialogType === dialogType.CHAT && chatUser.isConversation" class="chat-friend-container" ng-click="launchDialog(chatUser.layoutId)"> <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar" ng-click="launchDialog(chatUser.layoutId)"> <span class="chat-avatar-headshot" class-name="avatar-card-image chat-avatar" chat-avatar-headshot user-id="{{chatUser.displayUserId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[chatUser.displayUserId].presence.userPresenceType][\'className\']"> </div> </div> <div user-conversation-info></div> </div> <div ng-if="chatUser.dialogType === dialogType.GROUPCHAT && chatUser.isConversation" class="chat-friend-container chat-friend-groups" ng-click="launchDialog(chatUser.layoutId)"> <div class="chat-friend-avatar" ng-click="launchDialog(chatUser.layoutId)"> <ul class="avatar-group card-plain chat-avatar-groups" ng-class="{\'avatar-double\': chatUser.userIds.length === 2,\'avatar-triple\' : chatUser.userIds.length === 3,\'avatar-all\' : chatUser.userIds.length>= 4}"> <li ng-repeat="userId in chatUser.userIds | limitTo : 4" class="avatar-item chat-avatar"> <span class="chat-avatar-headshot" class-name="avatar-card-image" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> </li> </ul> </div> <div user-conversation-info></div> </div> <div ng-if="!chatUser.isConversation" class="chat-friend-container" ng-click="launchDialog(chatUser.layoutId)"> <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar"> <span class="chat-avatar-headshot" class-name="avatar-card-image chat-avatar" chat-avatar-headshot user-id="{{chatUser.id}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[chatUser.id].presence.userPresenceType][\'className\']"> </div> </div> <div user-conversation-info></div> </div> </li> </ul> <div class="chat-loading loading-bottom" ng-show="chatLibrary.chatLayout.isChatLoading"> <span class="spinner spinner-sm" title="{{\'Label.SpanTitle.Loading\' | translate}}"></span> </div> </div> </div> <div id="chat-disconnect" class="chat-disconnect" ng-show="isChatDisconnected()" ng-cloak> <p class="text-info" ng-show="chatLibrary.chatLayout.errorMaskEnable">{{chatLibrary.chatLayout.noConnectionMsg}} </p> <span><span class="spinner spinner-default" title="{{\'Label.SpanTitle.Loading\' | translate}}"></span></span> </div> <div id="chat-empty-list" class="chat-disconnect" ng-hide="chatLibrary.chatLayout.errorMaskEnable" ng-if="isChatEmpty()"> <span class="icon-chat-friends"></span> <p ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled" class="text-info small font-caption-body text-default" ng-bind="\'Message.MakeFriendsToChatNPlay\' | translate"></p> <a id="find-game" ng-bind="\'Label.PlayGames\' | translate" class="btn-primary-sm btn-cta-sm" ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled" ng-href="{{chatLibrary.gamesPageLink}}"></a> <p ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.disabled" class="text-info small" ng-click="openSettingsPage()"> <span ng-bind-html="\'Message.ChatPrivacySetting\' | translate:{frontLink: \'<span class=text-link>\', endLink: \'</span>\'}"></span> </p> <p ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.unavailable" class="text-info small">{{chatLibrary.chatLayout.languageForPrivacySettingUnavailable}}</p> <span class="icon-logo-tagline logo-tagline-chat"></span> </div> </div>'},1254:function(e){e.exports='<div ng-controller="chatController" ng-class="{\'collapsed\': chatLibrary.chatLayout.collapsed}" ng-cloak> <div chat-bar></div> <div id="dialogs" class="dialogs" ng-controller="dialogsController" ng-hide="chatLibrary.chatLayout.isChatEnabledByPrivacySetting !== chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled"> <div dialog id="{{chatLayoutId}}" dialog-data="chatUserDict[chatLayoutId]" chat-library="chatLibrary" close-dialog="closeDialog(chatLayoutId)" send-invite="sendInvite(chatLayoutId)" ng-repeat="chatLayoutId in chatLibrary.layoutIdList"></div> <div dialog id="{{newGroup.layoutId}}" dialog-data="newGroup" chat-library="chatLibrary" close-dialog="closeDialog(\'newGroup\')" send-invite="sendInvite(newGroup.layoutId)" ng-if="newGroup"></div> <div id="dialogs-minimize" class="dialogs-minimize" dialog-minimize chat-library="chatLibrary"> </div> <div class="chat-placeholder" chat-placeholder> </div> </div> </div>'},5244:function(e){e.exports='<div id="dialog-container-{{dialogData.id}}" class="dialog-container" ng-class="{\'collapsed\': dialogLayout.collapsed,\'active\': dialogLayout.active && dialogData.layoutId !== chatLibrary.chatLayout.focusedLayoutId,\'focused\': !dialogLayout.collapsed && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}" ng-controller="dialogController"> <div class="dialog-main" ng-hide="isDialogMainContainerHidden()"> <div class="chat-windows-header dialog-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-label" ng-click="toggleDialogContainer()"> <span class="font-caption-header text-overflow chat-header-title dialog-header-title"> {{dialogData.name}} </span> </div> <div dialog-header></div> </div> <div id="scrollbar_{{dialogData.dialogType}}_{{dialogData.layoutId}}" class="rbx-scrollbar dialog-body" ng-style="dialogLayout.defaultStyle.dialogStyle" focus-model="toggleDialogFocusStatus(true)" dialog-lazy-load> <ul class="dialog-messages" ng-controller="dialogMessagesController"> <li class="dialog-message-container" ng-repeat="message in dialogData.chatMessages | reverse" ng-class="{\'message-inbound\': message.senderTargetId != chatLibrary.userId && !message.isSystemMessage,\'system-message\': message.isSystemMessage,\'message-cluster-master\': message.isClusterMaster}" ng-if="canRenderMessage(message) || shouldShowInvalidMessageTypePrompt(message)" on-finish-render="ngRepeatFinished"> <div class="indicated-message" ng-hide="!message.displayTimeStamp"> <span class="font-footer text-muted indicated-message-bubble">{{message.displayTimeStamp}}</span> </div> <a ng-href="{{chatLibrary.friendsDict[message.senderTargetId].profileUrl}}" ng-hide="message.isSystemMessage" class="avatar avatar-headshot-sm dialog-message-avatar-link"> <span ng-if="message.senderTargetId != chatLibrary.userId" class="chat-avatar-headshot" class-name="avatar-card-image dialog-message-avatar" chat-avatar-headshot user-id="{{message.senderTargetId}}" layout-library="chatLibrary.layoutLibrary"></span> </a> <div class="dialog-message-body"> <div class="dialog-message dialog-message-content dialog-triangle" ng-class="{\'message-is-sending\': message.sendingMessage}" ng-hide="message.isSystemMessage" ng-if="!message.hasLinkCard && canRenderMessage(message)"> <span class="message-piece font-caption-body text-emphasis" ng-repeat="piece in message.pieces" ng-bind-html="piece.content"></span> <span ng-show="message.canResend" ng-click="resendMessage(message)" class="icon-chat-resend"></span> </div> <div ng-if="message.hasLinkCard" link-card></div> <div class="xsmall text-date-hint dialog-sending" ng-show="message.filteredForReceivers" ng-bind="chatLibrary.errors.messageFilterForReceivers"></div> <div class="xsmall text-error dialog-sending" ng-show="message.sendMessageHasError" ng-bind="message.error || (\'Message.Error\' | translate)"></div> </div> <div class="indicated-message" system-message></div> </li> <li class="dialog-message-container message-inbound typing-indicator" ng-show="dialogLayout.typing.isTypingFromSender"> <a ng-href="{{chatLibrary.friendsDict[dialogLayout.typing.userIds[0]].profileUrl}}" class="avatar avatar-headshot-sm dialog-message-avatar-link"> <span class="chat-avatar-headshot" class-name="avatar-card-image dialog-message-avatar" chat-avatar-headshot user-id="{{dialogLayout.typing.userIds[0]}}" layout-library="chatLibrary.layoutLibrary"></span> </a> <div class="small dialog-message dialog-triangle"> <span class="typing"></span> </div> </li> </ul> </div> <div class="chat-loading loading-top" ng-show="dialogLayout.isChatLoading"> <span class="spinner spinner-sm" title="{{\'Label.SpanTitle.Loading\' | translate}} ..."></span> </div> <div class="border-top dialog-input-container" ng-class="{\'disabled\': chatLibrary.chatLayout.errorMaskEnable}" ng-style="dialogLayout.defaultStyle.inputStyle"> <textarea id="dialog-input" msd-elastic dialog-input rows="1" focus-me="{{dialogLayout.focusMeEnabled && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}}" placeholder="{{\'Label.InputPlaceHolder.SendMessage\' | translate}}" ng-model="dialogData.messageForSend" enter-escape-shift="keyPressEnter($event)" ng-keypress="typing($event, true)" ng-blur="typing($event, false)" class="dialog-input" input-max-length="{{dialogLayout.limitCharacterCount}}" ng-disabled="chatLibrary.chatLayout.errorMaskEnable" ng-style="dialogLayout.defaultStyle.inputTextStyle" hinteractive hinteractive-domain="chat"></textarea> </div> </div> <div abuse-report></div> <div details></div> <div places></div> </div>'},5016:function(e){e.exports='<thumbnail-2d class="{{className}}" thumbnail-target-id="universeId" thumbnail-type="layoutLibrary.thumbnailTypes.gameIcon"> </thumbnail-2d>'},3578:function(e){e.exports='<div id="dialog-container-{{dialogData.id}}" class="dialog-container group-dialog" ng-class="{\'group-has-banner\': dialogLayout.renameEditor.isEnabled,\'collapsed\': dialogLayout.collapsed,\'active\': dialogLayout.active && dialogData.layoutId !== chatLibrary.chatLayout.focusedLayoutId,\'focused\': !dialogLayout.collapsed && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}" ng-controller="dialogController"> <div class="dialog-main" ng-hide="dialogLayout.isConfirmationOn || isDialogMainContainerHidden()"> <div class="chat-windows-header dialog-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-label" ng-click="toggleDialogContainer()"> <span id="group-chat-title" class="font-caption-header text-overflow dialog-header-title max-width" title="{{dialogData.title}}">{{dialogData.title}}</span> </div> <div dialog-header></div> </div> <div id="scrollbar_{{dialogData.dialogType}}_{{dialogData.layoutId}}" ng-style="dialogLayout.defaultStyle.dialogStyle" class="rbx-scrollbar dialog-body" dialog-lazy-load focus-model="toggleDialogFocusStatus(true)"> <ul class="dialog-messages" ng-controller="dialogMessagesController"> <li class="dialog-message-container" ng-repeat="message in dialogData.chatMessages | reverse" ng-class="{\'message-inbound\': message.senderTargetId != chatLibrary.userId && !message.isSystemMessage,\'system-message\': message.isSystemMessage,\'message-cluster-master\': message.isClusterMaster}" ng-if="canRenderMessage(message) || shouldShowInvalidMessageTypePrompt(message)" on-finish-render="ngRepeatFinished"> <div class="indicated-message" ng-hide="!message.displayTimeStamp"> <span class="font-footer text-muted indicated-message-bubble"> {{message.displayTimeStamp}} </span> </div> <a ng-href="{{chatLibrary.friendsDict[message.senderTargetId].profileUrl}}" ng-hide="message.isSystemMessage" class="avatar avatar-headshot-sm dialog-message-avatar-link"> <span ng-if="message.senderTargetId != chatLibrary.userId" class="chat-avatar-headshot" class-name="avatar-card-image dialog-message-avatar" chat-avatar-headshot user-id="{{message.senderTargetId}}" layout-library="chatLibrary.layoutLibrary"> </span> </a> <div class="dialog-message-body" ng-if="canRenderMessage(message)"> <div ng-if="chatLibrary.friendsDict[message.senderTargetId]" ng-show="message.isClusterMaster && message.senderTargetId != chatLibrary.userId" class="xxsmall dialog-message-author"> <span class="font-footer text-muted" ng-bind="chatLibrary.friendsDict[message.senderTargetId].nameForDisplay"></span> <span class="font-footer text-muted text-overflow" alias="chatLibrary.friendsDict[message.senderTargetId].contact"></span> <span class="typing" ng-show="message.id == dialogLayout.typing.userTypingDict[message.senderTargetId].messageId"></span> </div> <div class="dialog-message dialog-triangle" ng-class="{\'message-is-sending\': message.sendingMessage}" ng-hide="message.isSystemMessage" ng-if="!message.hasLinkCard"> <span class="dialog-message-content"> <span class="message-piece" ng-repeat="piece in message.pieces" ng-bind-html="piece.content"></span> </span> <span ng-show="message.canResend" ng-click="resendMessage(message)" class="icon-chat-resend"></span> </div> <div ng-if="message.hasLinkCard" link-card></div> <div class="xsmall text-date-hint dialog-sending" ng-show="message.filteredForReceivers" ng-bind="chatLibrary.errors.messageFilterForReceivers"></div> <div class="text-error dialog-sending" ng-show="message.sendMessageHasError" ng-bind="message.error || (\'Message.Error\'|translate)"></div> </div> <div class="indicated-message" system-message></div> </li> </ul> </div> <div class="chat-loading loading-top" ng-show="dialogLayout.isChatLoading"> <span class="spinner spinner-sm" title="{{\'Label.SpanTitle.Loading\'|translate}}"></span> </div> <div class="border-top dialog-input-container" ng-class="{\'disabled\': chatLibrary.chatLayout.errorMaskEnable}" ng-style="dialogLayout.defaultStyle.inputStyle"> <textarea msd-elastic focus-me="{{dialogLayout.focusMeEnabled && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}}" placeholder="{{\'Label.InputPlaceHolder.SendMessage\'|translate}}" ng-model="dialogData.messageForSend" enter-escape-shift="keyPressEnter($event)" ng-keypress="typing($event, true)" ng-blur="typing($event, false)" class="dialog-input" rows="1" input-max-length="{{dialogLayout.limitCharacterCount}}" ng-disabled="chatLibrary.chatLayout.errorMaskEnable" ng-style="dialogLayout.defaultStyle.inputTextStyle" hinteractive hinteractive-domain="chat"></textarea> </div> </div> <div abuse-report></div> <div confirm-negative-action chat-library="chatLibrary" dialog-layout="dialogLayout" confirm-callback="confirmCallBack()"></div> <div details></div> </div>'},7999:function(e){e.exports='<div class="chat-placeholder-container" ng-show="chatLibrary.chatPlaceholderEnabled"> <div class="chat-placeholder-header"></div> <span class="icon-chat-placeholder"></span> </div>'},5430:function(e){e.exports='<div class="confirm-negative-action details-confirmation-container" ng-show="dialogLayout.confirmDialog.isOpen"> <div class="confirm-negative-action-container"> <div class="chat-windows-header"> <div class="chat-header-back" ng-click="dialogLayout.confirmDialog.isOpen = false"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span class="font-caption-header">{{dialogLayout.confirmDialog.headerTitle}}</span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})" data-toggle="tooltip" title="{{\'Label.Close\'|translate}}"></span> </div> </div> <div class="details-negative-confirmation-body"> <span class="small text details-negative-confirmation-text">{{dialogLayout.confirmDialog.title}}</span> <div class="details-btns-fixed select-friends-btns"> <button class="btn-control-sm details-btn-cancel" ng-click="dialogLayout.confirmDialog.isOpen = false"> {{dialogLayout.confirmDialog.cancelBtnName}} </button> <button id="negative-action-confirm-btn" class="btn-alert-sm details-btn-save" ng-click="confirmCallback()"> {{dialogLayout.confirmDialog.btnName}} </button> </div> </div> </div> </div>'},6125:function(e){e.exports='<div class="details-header-container conversation-title-container"> <div class="details-label conversation-title-icon"> <span class="icon-chat-group-name" ng-show="dialogData.dialogType === dialogType.NEWGROUPCHAT"></span> <ul class="avatar-group card-plain chat-avatar-groups" ng-show="dialogData.dialogType != dialogType.NEWGROUPCHAT" ng-class="{\'avatar-double\': dialogData.userIds.length === 2,\'avatar-triple\' : dialogData.userIds.length === 3,\'avatar-all\' : dialogData.userIds.length >= 4}"> <li ng-repeat="userId in dialogData.userIds | limitTo : 4" class="avatar-item chat-avatar"> <span class="chat-avatar-headshot" class-name="avatar-card-image" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> </li> </ul> </div> <div class="border-bottom small details-input-container" ng-show="dialogData.dialogType == dialogType.NEWGROUPCHAT"> <input type="text" focus-me="{{dialogLayout.focusMeEnabled}}" class="small details-input conversation-title-input" placeholder="{{\'Label.NameYourChatGroup\'|translate}}" ng-model="dialogData.name" maxlength="{{chatLibrary.maxConversationTitleLengthInput}}"> </div> <div class="details-title conversation-title-content" ng-click="toggleConversationEditor()" ng-show="dialogData.dialogType != dialogType.NEWGROUPCHAT"> <span class="small text conversation-title-label text-overflow" ng-bind="dialogData.title"></span> <span class="icon-chat-arrow-right"></span> </div> </div>'},1108:function(e){e.exports='<div class="details-container conversation-title-editor-container" ng-show="dialogLayout.details.isConversationTitleEditorEnabled"> <div class="chat-windows-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-back" ng-click="toggleConversationEditor()"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span class="font-caption-header" ng-bind="\'Label.ChatGroupName\' | translate"></span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div class="details-container conversation-title-editor-body"> <div ng-bind="\'Label.ChangeChatGroupName\' | translate" class="font-caption-body text conversation-title-editor-title"> </div> <div class="conversation-title-editor-content"> <textarea auto-resize rows="1" maxlength="{{chatLibrary.maxConversationTitleLengthInput}}" focus-me="{{dialogLayout.focusMeEnabled}}" class="font-caption-body input-field details-input conversation-title-editor-textarea" key-press-enter="renameTitle()" ng-model="dialogData.name">\r\n            </textarea> <span class="font-footer text-subheader conversation-title-editor-count">{{dialogData.name.length}}/{{chatLibrary.maxConversationTitleLengthInput}}</span> </div> <div class="details-btns-fixed select-friends-btns"> <button id="select-friends-cancel" ng-bind="\'Action.Cancel\'|translate" ng-click="toggleConversationEditor()" class="btn-fixed-width btn-control-sm details-btn-cancel"></button> <button id="select-friends-save" ng-bind="\'Action.Save\'|translate" class="btn-fixed-width btn-secondary-sm details-btn-save" ng-click="renameTitle()"></button> </div> </div> </div>'},8061:function(e){e.exports='<div class="dialog-container create-chat-container" ng-class="{\'collapsed\': dialogLayout.collapsed}" ng-controller="friendsController"> <div class="chat-windows-header"> <div class="chat-header-label chat-header-create-group" ng-click="toggleDialogContainer()"> <span class="font-caption-header">{{dialogLayout.title}}</span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div conversation-title></div> <div select-friends></div> <div class="details-btns-fixed select-friends-btns"> <button id="select-friends-cancel" ng-bind="\'Action.Cancel\'|translate" ng-click="closeDialog({layoutId: dialogData.layoutId})" class="btn-fixed-width btn-control-sm details-btn-cancel select-friends-cancel"> </button> <button id="select-friends-save" ng-bind="\'Action.Create\'|translate" class="btn-fixed-width btn-secondary-sm btn-cta-sm details-btn-save select-friends-save" ng-disabled="dialogLayout.inviteBtnDisabled" ng-click="sendInvite()"> </button> </div> </div>'},6203:function(e){e.exports='<div class="details-dialog-container" ng-show="dialogLayout.details.isEnabled" ng-controller="detailsController"> <div class="details-dialog" ng-class="{\'collapsed\': dialogLayout.collapsed}" ng-hide="dialogLayout.details.isAddFriendsEnabled || dialogLayout.details.isConversationTitleEditorEnabled"> <div class="chat-windows-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-back" ng-click="toggleDetails()"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span ng-bind="\'Label.ChatDetails\'| translate" class="font-caption-header"></span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div id="scrollbar_details_{{dialogData.layoutId}}" class="rbx-scrollbar details-container details-scrollbar" details-scrollbar> <div class="xsmall border-bottom text-secondary details-general-label" ng-if="dialogData.isGroupChat" ng-bind="\'Label.General\'|translate"> </div> <div conversation-title ng-if="dialogData.isGroupChat"></div> <div class="xsmall border-top border-bottom text-secondary details-members-label font-footer text-muted" ng-bind="\'Label.Members\' | translate"></div> <div class="details-members-container"> <div class="add-friends-option"> <div class="add-friends-icon" ng-click="toggleAddFriends()"> <div class="add-friends-cirle-container"> <span class="icon-chat-add-friends"></span> </div> </div> <div class="small border-bottom text-sec add-friends-label" ng-bind="\'Label.AddFriends\' | translate" ng-click="toggleAddFriends()"> </div> </div> <div id="group-members" class="participant-list"> <ul class="friends-list-container participant-list-container"> <li ng-repeat="userId in dialogData.userIds | limitTo: dialogLayout.memberDisplay.limitNumber" class="friend-item" id="member-list-{{userId}}"> <div class="friend-container"> <a ng-href="{{chatLibrary.friendsDict[userId].profileUrl}}" class="avatar avatar-headshot-sm friend-avatar"> <span class="chat-avatar-headshot" class-name="avatar-card-image avatar" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status avatar-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType][\'className\']"> </div> </a> <div class="border-bottom friend-info-action"> <div class="friend-info"> <div class="friend-username dynamic-overflow-container no-wrap"> <div class="small text-overflow text-sec friend-name dynamic-ellipsis-item"> {{chatLibrary.friendsDict[userId].nameForDisplay}}</div> <div class="small text-overflow text-sec friend-alias dynamic-ellipsis-item" alias="chatLibrary.friendsDict[userId].contact"></div> </div> <div class="xsmall text-overflow friend-status"> {{userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType].title}} </div> </div> <div class="friend-action" ng-show="userId !== chatLibrary.userId"> <div class="friend-action-more-option more-options-{{dialogData.layoutId}}" click-outside="toggleFriendsMenu(userId, true)" ng-click="toggleFriendsMenu(userId)"> <span class="icon-chat-more-options"></span> </div> <div class="friend-menu" ng-class="{\'three-items\': canConversationRemoveMember() }" ng-show="dialogLayout.details.friendIdForMenuOn == userId && dialogLayout.details.friendMenuAction[userId]"> <ul class="dropdown-menu" role="menu" ng-show="dialogLayout.details.friendIdForMenuOn == userId && dialogLayout.details.friendMenuAction[userId]"> <li> <a id="add-friends-{{userId}}" ng-href="{{chatLibrary.friendsDict[userId].profileUrl}}" ng-click="toggleFriendsMenu(userId)" ng-bind="\'Label.ViewProfile\' | translate" class="font-caption-header"></a> </li> <li> <a id="abuse-report-{{userId}}" ng-click="abuseReport(userId, false); toggleFriendsMenu(userId)" class="font-caption-header" ng-bind="\'Action.Report\' | translate"></a> </li> <li ng-if="canConversationRemoveMember()"> <a id="remove-member-{{userId}}" ng-click="removeMember(userId, false); toggleFriendsMenu(userId)" class="font-caption-header" ng-bind="\'Action.Remove\' | translate"></a> </li> </ul> </div> </div> </div> </div> </li> <li class="participant-list-action" ng-show="dialogData.userIds.length > dialogLayout.memberDisplay.defaultLimit"> <a class="small text-link" ng-click="toggleMemberList()">{{dialogLayout.memberDisplay.linkName}}</a> </li> </ul> </div> </div> <div class="details-btns"> <button id="leave-group" ng-click="leaveGroupChat(false)" class="btn-full-width btn-alert-sm select-friends-cancel" ng-if="dialogData.dialogType !== dialogType.CHAT && dialogData.isGroupChat" ng-bind="\'Label.LeaveChatGroup\' | translate"></button> </div> </div> </div> <div add-friends></div> <div conversation-title-editor></div> </div>'},185:function(e){e.exports='<div class="chat-header-action" ng-controller="dialogHeaderController"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> <span class="icon-chat-info-white" id="dialog-info" uib-tooltip="{{\'Label.ChatDetails\'| translate}}" tooltip-placement="bottom" ng-click="toggleDetails()" ng-hide="dialogLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable"></span> <span id="play-together-{{dialogData.id}}" class="cursor-pointer dialog-header-active-game" ng-if="isPinOrActiveGameAvailable()" ng-hide="dialogLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable" ng-click="openGameList()" popover-trigger=" \'none\' " popover-class="game-list-in-dialog" popover-placement="bottom-right" popover-append-to-body="false" popover-is-open="dialogLayout.togglePopoverParams.isOpen" uib-popover-template="\'{{gamesListTemplateUrl}}\'" toggle-popover> <span chat-game-icon class-name="dialog-header-active-game-image" ng-if="dialogData.placeForShown.universeId" universe-id="{{dialogData.placeForShown.universeId}}" layout-library="chatLibrary.layoutLibrary"></span> </span> <span id="play-together-{{dialogData.id}}" class="cursor-pointer dialog-header-active-game" ng-if="!isPinOrActiveGameAvailable() && isMyRecentGameAvailable()" ng-hide="dialogLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable" ng-click="openGameList()" popover-trigger=" \'none\' " popover-class="game-list-in-dialog" popover-placement="bottom-right" popover-append-to-body="false" popover-is-open="dialogLayout.togglePopoverParams.isOpen" uib-popover-template="\'{{gamesListTemplateUrl}}\'" toggle-popover> <span chat-game-icon class-name="dialog-header-active-game-image" ng-if="chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId" universe-id="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId}}" layout-library="chatLibrary.layoutLibrary"></span> </span> </div>'},2553:function(e){e.exports='<div id="dialogs-minimize-container" class="dialogs-minimize-container" ng-show="hasMinimizedDialogs" data-toggle="popover" data-bind="dialogs"> <span class="icon-chat-more-dialogs"></span> <span class="font-header-2 minimize-count">{{chatLibrary.minimizedDialogIdList.length}}</span> <div class="rbx-popover-content" data-toggle="dialogs"> <ul class="dropdown-menu minimize-list" role="menu"> <li ng-repeat="dialogLayoutId in chatLibrary.minimizedDialogIdList" class="minimize-item" id="{{dialogLayoutId}}" minimize-item> <a class="text-overflow minimize-title"> <span> {{chatLibrary.minimizedDialogData[dialogLayoutId].name}} </span> </a> <span class="icon-chat-close-black minimize-close"></span> </li> </ul> </div> </div>'},4040:function(e){e.exports='<div> <span ng-show="chatUser.displayMessage.messageType === messageHelper.messageTypes.link.name" ng-bind="chatLibrary.universeLibrary[chatUser.displayMessage.link.game.universeId].placeUrl"> </span> <span ng-show="chatUser.displayMessage.messageType === messageHelper.messageTypes.plainText.name && !chatUser.displayMessage.hasLinkifyMessage" title="{{chatUser.displayMessage.messageType}}" ng-bind-html="chatUser.displayMessage.content"></span> <span ng-show="chatUser.displayMessage.messageType === messageHelper.messageTypes.plainText.name && chatUser.displayMessage.hasLinkifyMessage" title="{{chatUser.displayMessage.messageType}}" ng-bind="chatUser.displayMessage.parsedContent"></span> </div>'},3400:function(e){e.exports='<div ng-controller="playTogetherController"> <div class="game-item-container pinned-game-container" ng-class="{\'has-active-game\': hasPinGameAndActiveGames()}" ng-show="playTogether.pinGame && playTogether.pinGame.rootPlaceId"> <a ng-href="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeUrl}}" class="text-title game-link"> <span chat-game-icon class-name="game-icon" layout-library="chatLibrary.layoutLibrary" ng-if="chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].universeId" universe-id="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].universeId}}" title="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeName}}"></span> </a> <div class="game-details pinned-game-details"> <div class="pinned-game-header"> <span class="pin-icon icon-chat-unpin" ng-click="unPinGame()" uib-tooltip="{{pinGameLayout.tooltipForUnPinGame}}" tooltip-placement="bottom-right"></span> </div> <div class="text-overflow small text-title game-name"> <a ng-href="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeUrl}}" class="text-title game-link"> {{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeName}} </a> </div> <div class="game-info pinned-game-info"> <ul class="game-players"> <li ng-repeat="userId in playTogether.playTogetherDict[playTogether.pinGame.rootPlaceId].playerIds | limitTo: playTogetherLayout.numberOfMembers.inPinnedGame" class="avatar avatar-headshot-sm card-plain game-player" title="{{chatLibrary.friendsDict[userId].nameForDisplay}}"> <span uib-tooltip="{{chatLibrary.friendsDict[userId].nameForDisplay}}" tooltip-placement="bottom" tooltip-append-to-body="true" class="avatar-card-image game-player-avatar" class="chat-avatar-headshot" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status game-player-presence" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType][\'className\']"> </div> </li> <li ng-show="playTogether.playTogetherDict[playTogether.pinGame.rootPlaceId].playerIds.length > playTogetherLayout.numberOfMembers.inPinnedGame" class="font-caption-body text-secondary game-player-plus" ng-cloak> +{{playTogether.playTogetherDict[playTogether.pinGame.rootPlaceId].playerIds.length - playTogetherLayout.numberOfMembers.inPinnedGame}} </li> </ul> <button type="button" class="{{playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].className}} game-btn" ng-class="{\'invisible\' : !playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId]}" ng-click="joinGameFromPlayTogether(playTogether.pinGame.rootPlaceId)" ng-if="playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].type != gameLayout.playButtonTypes.notAvailable"> {{playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].text}} </button> <span class="xsmall text-label game-non-available" ng-if="playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].type == gameLayout.playButtonTypes.notAvailable"> {{playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].text}} </span> </div> </div> </div> <div class="game-list-container" ng-class="{\'has-pin-game-above\': hasPinGameAndActiveGames(),\'overflow\': (playTogetherLayout.activeGamesList.limitNumber >= playTogetherLayout.activeGamesList.maxNumberForFit)}" ng-show="hasActiveGames()"> <ul id="active-game-list" ng-class="{\'rbx-scrollbar\': playTogether.inDialog}" class="active-game-list"> <li ng-repeat="placeId in playTogether.playTogetherIds | limitTo: playTogetherLayout.activeGamesList.limitNumber" ng-if="placeId != playTogether.pinGame.rootPlaceId" repeat-done class="game-item-container active-game-container"> <a ng-href="{{chatLibrary.placesLibrary[placeId].placeUrl}}" class="text-title game-link"> <div chat-game-icon class="chat-game-icon" class-name="game-icon" layout-library="chatLibrary.layoutLibrary" ng-if="chatLibrary.placesLibrary[placeId].universeId" universe-id="{{chatLibrary.placesLibrary[placeId].universeId}}" title="{{chatLibrary.placesLibrary[placeId].placeName}}"></div> </a> <div class="border-bottom game-details active-game-details"> <div class="game-title-container"> <div class="text-overflow small text-title game-name"> <a ng-href="{{chatLibrary.placesLibrary[placeId].placeUrl}}"> {{chatLibrary.placesLibrary[placeId].placeName}} </a> </div> <span class="pin-icon active-game-pin-icon icon-chat-pin" ng-click="pinGame(chatLibrary.placesLibrary[placeId].universeId, chatLibrary.placesLibrary[placeId].rootPlaceId)" uib-tooltip="Pin Game" tooltip-placement="bottom-right"></span> </div> <div class="game-info active-game-info"> <ul class="game-players"> <li ng-repeat="userId in playTogether.playTogetherDict[placeId].playerIds | limitTo: playTogetherLayout.numberOfMembers.inActiveGame" class="avatar avatar-headshot-sm card-plain game-player" title="{{chatLibrary.friendsDict[userId].nameForDisplay}}"> <div uib-tooltip="{{chatLibrary.friendsDict[userId].nameForDisplay}}" tooltip-placement="bottom" tooltip-append-to-body="true" class="chat-avatar-headshot" class-name="avatar-card-image game-player-avatar" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </div> <div class="avatar-status game-player-presence" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType][\'className\']"> </div> </li> <li ng-show="playTogether.playTogetherDict[placeId].playerIds.length > playTogetherLayout.numberOfMembers.inActiveGame" class="font-caption-body text-secondary game-player-plus" ng-cloak> +{{playTogether.playTogetherDict[placeId].playerIds.length - playTogetherLayout.numberOfMembers.inActiveGame}} </li> </ul> <button type="button" class="{{playTogether.placeButtonLayout[placeId].className}} game-btn" ng-class="{\'invisible\' : !playTogether.placeButtonLayout[placeId]}" ng-if="playTogether.placeButtonLayout[placeId].type != gameLayout.playButtonTypes.notAvailable" ng-click="joinGameFromPlayTogether(placeId)"> {{playTogether.placeButtonLayout[placeId].text}} </button> <span class="xsmall text-label game-non-available" ng-if="playTogether.placeButtonLayout[placeId].type == gameLayout.playButtonTypes.notAvailable"> {{playTogether.placeButtonLayout[placeId].text}} </span> </div> </div> </li> </ul> <div class="cursor-pointer border-top is-exclusive-click active-game-toggle-menu" ng-click="toggleActiveGameList()" ng-if="playTogetherLayout.numberOfActiveGames > 1" ng-class="{\'collapsed\': playTogetherLayout.activeGamesList.isCollapsed}"> <span class="xsmall text is-exclusive-click toggle-menu-text">{{playTogetherLayout.activeGamesList.toggleMenuText}}</span> </div> </div> <div class="game-list-container" ng-show="isMyRecentAvaliable()"> <div class="game-item-container recommended-game-container"> <a ng-href="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].gameReferralUrl}}" class="text-title game-link"> <span chat-game-icon class-name="game-icon" layout-library="chatLibrary.layoutLibrary" ng-if="chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId" universe-id="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId}}" title="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].placeName}}"></span> </a> <div class="game-details recommended-game-details"> <div class="game-title-container"> <a class="text-overflow small text-title game-name" ng-href="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].gameReferralUrl}}"> {{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].placeName}} </a> <span class="small text-label font-caption-body">{{playTogetherLayout.recommendedLabel}}</span> </div> <div class="game-info recommended-game-info"> <button type="button" class="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].buttonLayoutForMe.className}} game-btn" ng-class="{\'invisible\' : !chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].buttonLayoutForMe}" ng-click="playGame(chatLibrary.myRecentPlaceId, playTogether.id)"> {{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].buttonLayoutForMe.text}} </button> </div> </div> </div> </div> </div> '},4148:function(e){e.exports='<div id="link-card" ng-controller="linkCardMessagesController"> <div class="link-card-msg-wrap" ng-repeat="pieceOfMessage in linkCardMessages" ng-controller="linkCardController" ng-init="sendLoadLinkCardEvent(pieceOfMessage.id)"> <div class="dialog-message dialog-message-content dialog-triangle" ng-class="{\'message-is-sending\': message.sendingMessage}" ng-hide="pieceOfMessage.isLinkCard" ng-if="!pieceOfMessage.isCard || (pieceOfMessage.isCard && chatLibrary.placesLibrary[pieceOfMessage.id].isInvalid)"> <span class="message-piece font-caption-body text-emphasis" ng-repeat="piece in pieceOfMessage.pieces" ng-bind-html="piece.content"></span> </div> <div class="cursor-pointer border dialog-triangle link-card-container" ng-if="isLinkCardAvailableAndParsedByClientSide(pieceOfMessage) && (chatLibrary.placesLibrary[pieceOfMessage.id] || !chatLibrary.placesLibrary[pieceOfMessage.id].isInvalid)"> <div class="link-card-top-container"> <div class="small font-caption-header text-title text-overflow link-card-title" title="{{chatLibrary.placesLibrary[pieceOfMessage.id].placeName}}" ng-bind="chatLibrary.placesLibrary[pieceOfMessage.id].placeName" ng-click="goToPlaceDetails(pieceOfMessage.id, chatLibrary.eventStreamParams.clickLinkCardInChat)"> </div> <span class="link-card-pin-icon icon-chat-pin" ng-class="{\'on\': pieceOfMessage.id == dialogData.pinGame.rootPlaceId}" ng-click="pinGame(chatLibrary.placesLibrary[pieceOfMessage.id].universeId, pieceOfMessage.id)" uib-tooltip="{{pinGameLayout.tooltipForPinGame}}" tooltip-placement="bottom-right"></span> </div> <div class="link-card-details" ng-click="goToPlaceDetails(pieceOfMessage.id, chatLibrary.eventStreamParams.clickLinkCardInChat)"> <span chat-game-icon class="chat-game-icon link-card-thumb" layout-library="chatLibrary.layoutLibrary" universe-id="{{chatLibrary.placesLibrary[pieceOfMessage.id].universeId}}" ng-if="chatLibrary.placesLibrary[pieceOfMessage.id].universeId"></span> <p class="xsmall text-secondary link-card-description" ng-bind="chatLibrary.placesLibrary[pieceOfMessage.id].description"></p> </div> <button class="{{chatLibrary.placesLibrary[pieceOfMessage.id].buttonLayoutForLinkCard.className}} btn-full-width link-card-btn" ng-class="{\'invisible\' : !chatLibrary.placesLibrary[pieceOfMessage.id].buttonLayoutForLinkCard}" ng-click="play(pieceOfMessage.id, chatLibrary.eventStreamParams.clickPlayFromLinkCardInChat, pieceOfMessage.assetDetails)" ng-disabled="dialogLayout.playTogetherButton.isPlayButtonDisabled"> {{chatLibrary.placesLibrary[pieceOfMessage.id].buttonLayoutForLinkCard.text}} </button> </div> <div class="cursor-pointer border dialog-triangle link-card-container" ng-if="pieceOfMessage.isLinkCard && chatLibrary.universeLibrary[pieceOfMessage.universeId]"> <div class="link-card-top-container"> <div class="small font-caption-header text-title text-overflow link-card-title" title="{{chatLibrary.universeLibrary[pieceOfMessage.universeId].placeName}}" ng-bind="chatLibrary.universeLibrary[pieceOfMessage.universeId].placeName" ng-click="goToPlaceDetails(chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId, chatLibrary.eventStreamParams.clickLinkCardInChat)"> </div> <span class="link-card-pin-icon icon-chat-pin" ng-class="{\'on\': chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId == dialogData.pinGame.rootPlaceId}" ng-click="pinGame(pieceOfMessage.universeId, chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId)" uib-tooltip="{{pinGameLayout.tooltipForPinGame}}" tooltip-placement="bottom-right"></span> </div> <div class="link-card-details" ng-click="goToPlaceDetails(chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId, chatLibrary.eventStreamParams.clickLinkCardInChat)"> <span chat-game-icon class="chat-game-icon link-card-thumb" ng-if="pieceOfMessage.universeId" layout-library="chatLibrary.layoutLibrary" universe-id="{{pieceOfMessage.universeId}}"></span> <p class="xsmall text-secondary link-card-description" ng-bind="chatLibrary.universeLibrary[pieceOfMessage.universeId].description"></p> </div> <button class="{{chatLibrary.universeLibrary[pieceOfMessage.universeId].buttonLayoutForLinkCard.className}} btn-full-width link-card-btn" ng-class="{\'invisible\' : !chatLibrary.universeLibrary[pieceOfMessage.universeId].buttonLayoutForLinkCard}" ng-click="play(chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId, chatLibrary.eventStreamParams.clickPlayFromLinkCardInChat)" ng-disabled="dialogLayout.playTogetherButton.isPlayButtonDisabled"> {{chatLibrary.universeLibrary[pieceOfMessage.universeId].buttonLayoutForLinkCard.text}} </button> </div> </div> </div>'},5015:function(e){e.exports='<div class="select-friends-container"> <div class="border-bottom details-header-container select-friends-header"> <div class="details-label select-friends-label"> <span class="icon-chat-group-label"></span> </div> <div class="small details-input-container select-friends-search" ng-class="{\'group-select-container\' : dialogData.selectedUserIds.length > 0}" select-friends-resize> <ul class="friends-selected-list" ng-show="dialogData.selectedUserIds.length > 0"> <li class="friends-selected-item friends-selected-placeholder invisible"> </li> <li class="avatar avatar-headshot-sm card-plain friends-selected-item" ng-repeat="userId in dialogData.selectedUserIds" ng-click="selectFriends(userId)" ng-hide="dialogData.selectedUsersDict[userId].hiddenFromSelection" title="{{dialogData.selectedUsersDict[userId].nameForDisplay}}"> <span class="chat-avatar-headshot" class-name="avatar-card-image avatar" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="friends-selected-mask"> <span class="icon-chat-close-white"></span> </div> </li> </ul> <input type="text" placeholder="{{\'Label.InputPlaceHolder.SearchForFriends\'|translate}}" class="small details-input select-friends-input" ng-model="dialogData.searchTerm"/> <span class="xsmall text-secondary select-friends-count" ng-if="dialogData.dialogType === dialogType.GROUPCHAT"> ({{(dialogData.selectedUserIds.length)}}/{{chatLibrary.quotaOfGroupChatMembers - dialogData.userIds.length + 1}}) </span> <span class="xsmall text-secondary select-friends-count" ng-if="dialogData.dialogType === dialogType.NEWGROUPCHAT || dialogData.dialogType === dialogType.CHAT"> ({{(dialogData.selectedUserIds.length)}}/{{chatLibrary.quotaOfGroupChatMembers - dialogData.userIds.length}}) </span> </div> </div> <div> <div id="scrollbar_friend_{{dialogData.dialogType}}_{{dialogData.layoutId}}" class="rbx-scrollbar select-friends-list" friends-lazy-load> <ul class="friends-list-container"> <li ng-repeat="friend in chatLibrary.friendsDict | orderList: dialogData.friendIds  | filter: search" class="friend-item" id="friend-{{friend.id}}"> <div class="friend-container chat-friend-select"> <div class="avatar avatar-headshot-sm card-plain friend-avatar" ng-click="toggleFriendSelection(friend.id)"> <span class="chat-avatar-headshot" class-name="avatar-card-image avatar" chat-avatar-headshot user-id="{{friend.id}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status avatar-status" ng-class="userPresenceTypes[friend.presence.userPresenceType][\'className\']"></div> </div> <div class="border-bottom friend-info-action" ng-click="toggleFriendSelection(friend.id)"> <div class="text-overflow friend-info"> <div class="dynamic-overflow-container no-wrap"> <div class="small text-overflow text-sec friend-name dynamic-ellipsis-item"> {{friend.nameForDisplay}}</div> <div class="small text-overflow text-sec friend-alias dynamic-ellipsis-item" alias="friend.contact"></div> </div> <div class="xsmall text-overflow text-secondary friend-status"> {{userPresenceTypes[friend.presence.userPresenceType].title}}</div> </div> <div class="checkbox friend-action"> <input id="checkbox-select-{{dialogData.layoutId}}-{{friend.id}}" type="checkbox" ng-click="toggleFriendSelection(friend.id, $event)" ng-checked="dialogData.selectedUsersDict[friend.id]"> <label for="checkbox-select-{{dialogData.layoutId}}-{{friend.id}}"> </label> </div> </div> </div> </li> </ul> </div> <div toast toast-layout="toastLayout"></div> </div> </div>'},2674:function(e){e.exports='<div> <span class="indicated-message-bubble system-message-content" ng-show="message.isSystemMessageFromApi"> <div class="font-footer text-muted" ng-if="message.eventBased.type === messageHelper.messageTypes.eventBased.setConversationUniverse" ng-bind="\'Message.PinGameUpdate\' | translate:{userName: chatLibrary.friendsDict[message.eventBased.setConversationUniverse.actorUserId].nameForDisplay, \r\n                                                                    gameName: chatLibrary.universeLibrary[message.eventBased.setConversationUniverse.universeId].placeName}"> </div> </span> <div ng-hide="message.isSystemMessageFromApi"> <span class="font-footer text-muted indicated-message-bubble system-message-content" ng-show="message.isSystemMessage && !message.hasParams" ng-bind-html="message.content"></span> <span class="font-footer text-muted indicated-message-bubble system-message-content" ng-show="message.isSystemMessage && message.hasParams">{{chatLibrary.friendsDict[dialogData.recentUserIdFromPresence].name}}{{message.content}}{{chatLibrary.placesLibrary[dialogData.recentPlaceIdFromPresence].placeName}}</span> </div> </div>'},4174:function(e){e.exports='<div ng-controller="userConversationInfoController"> <div class="border-bottom chat-friend-info" ng-class="{\'has-universe\': isGameAvailableInChat()}"> <div class="chat-friend-info-top dynamic-overflow-container"> <span class="small text-title text-overflow font-caption-header chat-friend-name dynamic-ellipsis-item" ng-class="{\'unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" ng-bind="chatUser.title  || chatUser.name "></span> <span class="text-overflow chat-alias-name dynamic-ellipsis-item" ng-class="{\'unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" alias="chatLibrary.friendsDict[chatUser.displayUserId].contact"></span> </div> <span class="xsmall text-info chat-brief-timestamp" ng-class="{\'font-bold secondary unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" ng-if="!isGameAvailableInChat()" ng-bind="chatUser.displayMessage.briefTimeStamp || chatUser.briefTimeStamp"></span> <span class="xsmall text-overflow text-info font-caption-body chat-friend-message" ng-class="{\'unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" display-message ng-if="chatUser.isConversation && chatUser.displayMessage"></span> <span class="xsmall text-overflow text-info font-caption-body chat-friend-message" ng-if="!chatUser.isConversation">{{userPresenceTypes[chatUser.presence.userPresenceType].title}}</span> </div> <div class="border-bottom chat-conversation-universe" ng-if="isGameAvailableInChat()" title="{{chatLibrary.placesLibrary[chatUser.placeForShown.rootPlaceId].placeName}}" ng-class="{\'album\': hasGameAlbum()}" ng-mouseover="openGameList()" popover-trigger=" \'none\' " popover-class="game-list-per-conversation game-list-{{chatUser.id}}" popover-placement="left-bottom" popover-append-to-body="true" popover-is-open="hoverPopoverParams.isOpen" hover-popover-params="hoverPopoverParams" hover-popover uib-popover-template="\'{{gamesListTemplateUrl}}\'"> <span chat-game-icon class-name="universe-image" layout-library="chatLibrary.layoutLibrary" ng-if="chatUser.placeForShown.universeId" universe-id="{{chatUser.placeForShown.universeId}}"></span> </div> </div>'},792:function(e){"use strict";e.exports=Roblox},5734:function(e){"use strict";e.exports=angular}},i={};function s(e){if(i[e])return i[e].exports;var a=i[e]={exports:{}};return t[e](a,a.exports,s),a.exports}s.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(a,{a:a}),a},s.d=function(e,a){for(var t in a)s.o(a,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},s.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";var e=s(5734),a=s.n(e),t=s(726),i=s(5862);(0,t.importFilesUnderPath)(s(4940)),(0,t.importFilesUnderPath)(s(9083)),(0,t.importFilesUnderPath)(s(9084)),(0,t.importFilesUnderPath)(s(2883));var e=s(4850),r=(0,t.templateCacheGenerator)(a(),"chatAppTemplates",e);a().element(function(){a().bootstrap("#chat-container",[i.Z.name,r.name])})}()}();
//# sourceMappingURL=https://js.rbxcdn.com/c65c20f548800795139d-chat.js.map

/* Bundle detector */
window.Roblox && window.Roblox.BundleDetector && window.Roblox.BundleDetector.bundleDetected("Chat");